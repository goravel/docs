# ä» v1.9 å‡çº§åˆ° v1.10

[[toc]]

## ä»¤äººå…´å¥‹çš„æ–°åŠŸèƒ½ ğŸ‰

- [æ·»åŠ  facades.Crypt(1.10.0)](#encryption)
- [æ·»åŠ  facades.Hash(1.10.0)](#hashing)
- [ä¸ºè·¯ç”±æ·»åŠ é€Ÿç‡é™åˆ¶(1.10.0)](#add-rate-limiting-for-routing)

## å¢å¼ºåŠŸèƒ½ ğŸš€

- [ä¼˜åŒ– HTTP å¯åŠ¨æ¨¡å¼](#optimize-http-startup-mode)
- [ä¼˜åŒ– GRPC å¯åŠ¨æ¨¡å¼](#optimize-grpc-startup-mode)
- [æ·»åŠ é…ç½®æ§åˆ¶æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°](#add-configuration-to-control-log-output-to-console)
- [Request ä¿®æ”¹å’Œæ·»åŠ æ–¹æ³•](#request-modify-and-add-methods)
- [é˜Ÿåˆ—æ”¯æŒå»¶è¿Ÿè°ƒåº¦](#queue-support-delayed-dispatching)
- [ORM ä¸­çš„ Connection æ”¯æŒè®¾ç½®è¡¨å‰ç¼€å’Œå•æ•°](#the-connection-in-orm-supports-set-table-prefix-and-singular)
- [æ·»åŠ  docker-compose.yml æ–‡ä»¶](#add-docker-composeyml-file)
- [ä¼˜åŒ– Orm](#optimize-orm)
- [åœ¨è¿ç§»æ–‡ä»¶ä¸­æ”¯æŒå¤šæ¡SQLè¯­å¥](#support-multiple-sql-in-migration-file)
- [ä¸ºæ–‡ä»¶å­˜å‚¨æ·»åŠ Minioé©±åŠ¨](#add-minio-driver-for-file-storage)
- [contracts/httpæ·»åŠ net/httpçš„çŠ¶æ€æ˜ å°„](#contractshttp-add-status-mapping-of-nethttp)

## é‡å¤§å˜æ›´ ğŸ› 

- [APP_KEY å¿…å¡«(1.10.0)](#app-key-required)
- [åœ¨ Form Request ä¸‹çš„æ–¹æ³•æ·»åŠ  ctx å‚æ•°(1.10.0)](#add-ctx-parameter-to-the-methods-under-form-request)
- [facades.Auth.Parse æ·»åŠ  payload è¿”å›(1.10.0)](#facades-auth-parse-add-payload-returns)
- [Orm çš„ä¸€äº›æ–¹æ³•æ·»åŠ æ–°çš„è¿”å›å€¼(1.10.0)](#some-methods-of-orm-add-new-return-values)

## å‡çº§æŒ‡å—

**é¢„è®¡å‡çº§æ—¶é—´ï¼š20 åˆ†é’Ÿ**

### æ›´æ–°ä¾èµ–

æ›´æ–° `go.mod` æ–‡ä»¶ä¸­çš„ä¾èµ–ï¼š

```
go get -u github.com/goravel/framework@v1.10.1 && go mod tidy
```

### åŠ å¯†

ç‰ˆæœ¬ï¼šv1.10.0

æ·»åŠ  `facades.Crypt`ï¼š

1. åœ¨ [config/app.go](https://github.com/goravel/goravel/blob/v1.10.x/config/app.go) æ–‡ä»¶çš„ `providers` é¡¹ä¸­æ·»åŠ  `&crypt.ServiceProvider{}`ï¼›

[è¯¦ç»†ä¿¡æ¯](../security/encryption)

### å“ˆå¸Œ

ç‰ˆæœ¬ï¼šv1.10.0

æ·»åŠ  `facades.Hash`ï¼š

1. åœ¨ [config/app.go](https://github.com/goravel/goravel/blob/v1.10.x/config/app.go) æ–‡ä»¶çš„ `providers` é¡¹ä¸­æ·»åŠ  `&hash.ServiceProvider{}`ï¼›

2. æ·»åŠ  [config/hashing.go](https://github.com/goravel/goravel/blob/v1.10.x/config/hashing.go) æ–‡ä»¶ï¼›

[è¯¦ç»†ä¿¡æ¯](../security/hashing)

### [ä¸ºè·¯ç”±æ·»åŠ é™æµ](#add-rate-limiting-for-routing)

ç‰ˆæœ¬ï¼šv1.10.0

[è¯¦ç»†ä¿¡æ¯](../basic/routing#Rate-Limiting)

### ä¼˜åŒ– HTTP å¯åŠ¨æ¨¡å¼

ç‰ˆæœ¬ï¼šv1.10.0

1. æ·»åŠ  `config/http.go` é…ç½®ï¼Œ[è¯¦ç»†ä¿¡æ¯](https://github.com/goravel/goravel/blob/v1.10.x/config/http.go)ï¼›
2. `facades.Route.Run` æ–¹æ³•ä¸å†éœ€è¦ä¼ é€’å‚æ•°ï¼Œé»˜è®¤ä½¿ç”¨ `http.host` å’Œ `http.port`ï¼ˆæ‚¨ä¸éœ€è¦ä¿®æ”¹ä»£ç ï¼Œå®ƒå‘åå…¼å®¹ï¼‰ï¼›
3. ç°åœ¨ `facades.Route.RunTLS` æ–¹æ³•ä¸å†éœ€è¦ä¼ é€’å‚æ•°ï¼Œé»˜è®¤ä½¿ç”¨ `http.tls.host`ã€
  `http.tls.port`ã€`http.tls.ssl.cert` å’Œ `http.tls.ssl.key`ï¼Œå¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨å®ƒï¼Œéœ€è¦ä¿®æ”¹ä»£ç ï¼›
4. æ·»åŠ  `facades.Route.RunTLSWithCert` æ–¹æ³•ï¼Œ[è¯¦æƒ…](../basic/routing#start-server)ï¼›
5. å°† `app.url`ã€`app.host` ç§»åŠ¨åˆ° `http.url`ã€`http.host`ï¼›

### ä¼˜åŒ– GRPC å¯åŠ¨æ¨¡å¼

ç‰ˆæœ¬ï¼šv1.10.0

ç°åœ¨ `facades.Grpc.Run` æ–¹æ³•ä¸å†éœ€è¦ä¼ é€’å‚æ•°ï¼Œé»˜è®¤ä½¿ç”¨ `grpc.host` å’Œ `grpc.port`ï¼ˆæ‚¨ä¸éœ€è¦
ä¿®æ”¹ä»£ç ï¼Œå®ƒå‘åå…¼å®¹ï¼‰ï¼›

### æ·»åŠ é…ç½®æ§åˆ¶æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°

ç‰ˆæœ¬ï¼šv1.10.0

åœ¨ `config/logging.go` æ–‡ä»¶ä¸­ä¸º `single`ã€`daily` é€šé“æ·»åŠ  `print` é…ç½®ï¼Œå¯ä»¥æ§åˆ¶æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œ[è¯¦æƒ…](https://github.com/goravel/goravel/blob/v1.10.x/config/logging.go)ï¼›

### è¯·æ±‚ä¿®æ”¹å’Œæ·»åŠ æ–¹æ³•

ç‰ˆæœ¬ï¼šv1.10.0

1. `Input` æ–¹æ³•ä»ä»…è·å–è·¯ç”±å‚æ•°æ”¹ä¸ºæŒ‰ä»¥ä¸‹é¡ºåºè·å–æ•°æ®ï¼š
  `json`ã€`form`ã€`query`ã€`route`ã€‚æ³¨æ„ï¼š`json` åªèƒ½è·å–ä¸€ç»´æ•°æ®ï¼Œå¦åˆ™å°†è¿”å›ç©ºï¼›
2. æ·»åŠ  `Route` æ–¹æ³•ä»¥æ›¿ä»£åŸæœ‰çš„ `Input` æ–¹æ³•ï¼›
3. `Query` å’Œ `Form` æ–¹æ³•çš„é»˜è®¤å€¼ä¿®æ”¹ä¸ºéå¿…éœ€ï¼›
4. æ·»åŠ å¦‚ä¸‹æ‰€ç¤ºçš„æ–¹æ³•ï¼š

| æ–¹æ³•         | æ“ä½œ                                                                      |
| ---------- | ----------------------------------------------------------------------- |
| Route      | [è·å–è·¯ç”±å€¼](../basic/requests#Retrieving-An-Input-Value)                    |
| RouteInt   | [è·å–è·¯ç”±å€¼](../basic/requests#Retrieving-An-Input-Value)                    |
| RouteInt64 | [è·å–è·¯ç”±å€¼](../basic/requests#Retrieving-An-Input-Value)                    |
| QueryInt   | [ä»æŸ¥è¯¢å­—ç¬¦ä¸²è·å–è¾“å…¥](../basic/requests#Retrieving-Input-From-The-Query-String)  |
| QueryInt64 | [ä»æŸ¥è¯¢å­—ç¬¦ä¸²è·å–è¾“å…¥](../basic/requests#Retrieving-Input-From-The-Query-String)  |
| QueryBool  | [ä»æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­æ£€ç´¢è¾“å…¥](../basic/requests#Retrieving-Input-From-The-Query-String) |
| InputInt   | [æ£€ç´¢è¾“å…¥å€¼](../basic/requests#Retrieving-An-Input-Value)                    |
| InputInt64 | [æ£€ç´¢è¾“å…¥å€¼](../basic/requests#Retrieving-An-Input-Value)                    |
| InputBool  | [æ£€ç´¢è¾“å…¥å€¼](../basic/requests#Retrieving-An-Input-Value)                    |
| Json       | [æ£€ç´¢Json](../basic/requests#Retrieving-Json)                             |

### é˜Ÿåˆ—æ”¯æŒå»¶è¿Ÿè°ƒåº¦

ç‰ˆæœ¬ï¼šv1.10.0

æ·»åŠ  `Delay` æ–¹æ³•ï¼Œ[è¯¦æƒ…](../advanced/queues#Delayed-Dispatching)

### ORM ä¸­çš„è¿æ¥æ”¯æŒè®¾ç½®è¡¨å‰ç¼€å’Œå•æ•°å½¢å¼

ç‰ˆæœ¬ï¼šv1.10.0

1. `Model` æ”¯æŒæŒ‡å®šè¡¨åï¼Œ[è¯¦æƒ…](../orm/getting-started)ï¼›
2. åœ¨ `config/database.go` çš„ `connection` ä¸­æ·»åŠ æ–°çš„é”®ï¼š

`prefix`ï¼šè®¾ç½®è¡¨åå‰ç¼€ï¼›
`singular`ï¼šè®¾ç½®ä½¿ç”¨å•æ•°æˆ–å¤æ•°å½¢å¼çš„è¡¨åï¼›

[è¯¦ç»†ä¿¡æ¯](https://github.com/goravel/goravel/blob/v1.10.x/config/database.go)

### æ·»åŠ  docker-compose.yml æ–‡ä»¶

ç‰ˆæœ¬ï¼šv1.10.0

æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¿«é€Ÿå¯åŠ¨æœåŠ¡ï¼š

```
docker-compose build
docker-compose up
```

### ä¼˜åŒ– Orm

ç‰ˆæœ¬ï¼šv1.10.0

1. æ·»åŠ ä»¥ä¸‹æ–¹æ³•ï¼š

| å‡½æ•°             | æ“ä½œ                                         |
| -------------- | ------------------------------------------ |
| FirstOr        | [é€šè¿‡å›è°ƒæŸ¥è¯¢æˆ–è¿”å›æ•°æ®](#Query-one-line)             |
| FirstOrNew     | [æ£€ç´¢æˆ–åˆ›å»ºæ–°æ¨¡å‹](#Retrieving-Or-Creating-Models) |
| FirstOrFail    | [æœªæ‰¾åˆ°é”™è¯¯](#Not-Found-Error)                  |
| UpdateOrCreate | [æ›´æ–°æˆ–åˆ›å»º](#Update-or-create)                 |

2. ä¹‹å‰æŠ¥å‘Šè¿‡è¿™æ ·çš„é”™è¯¯ï¼Œä½†ç°åœ¨å·²ç»æ”¯æŒäº†ï¼š

```go
query := facades.Orm.Query()
query = query.Where()
```

### æ”¯æŒè¿ç§»æ–‡ä»¶ä¸­çš„å¤šä¸ªSQLè¯­å¥

ç‰ˆæœ¬ï¼šv1.10.0

ä»¥å‰ï¼Œè¿ç§»æ–‡ä»¶ä¸­åªæ”¯æŒä¸€ä¸ªSQLè¯­å¥ï¼Œä½†ç°åœ¨æ”¯æŒå¤šä¸ªè¯­å¥ã€‚

### ä¸ºæ–‡ä»¶å­˜å‚¨æ·»åŠ minioé©±åŠ¨

ç‰ˆæœ¬ï¼šv1.10.0

æ·»åŠ minioé…ç½®ï¼Œ[è¯¦æƒ…](https://github.com/goravel/goravel/blob/v1.10.x/config/filesystems.go)ã€‚

### contracts/http æ·»åŠ  net/http çš„çŠ¶æ€æ˜ å°„

ç‰ˆæœ¬ï¼šv1.10.0

æ‚¨å¯ä»¥åœ¨æ§åˆ¶å™¨ä¸­ç›´æ¥ä½¿ç”¨ `http.StatusOK` ç­‰çŠ¶æ€ç ï¼Œæ— éœ€å¯¼å…¥ `net/http`ã€‚

[è¯¦ç»†ä¿¡æ¯](https://github.com/goravel/framework/blob/v1.10.0/contracts/http/status.go)

### APP_KEY å¿…å¡«

ç‰ˆæœ¬ï¼šv1.10.0

`.env` æ–‡ä»¶ä¸­çš„ `APP_KEY` ç°åœ¨æ˜¯å¿…å¡«é¡¹ï¼Œæ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆ APP_KEYï¼š
`go run . artisan key:generate`ã€‚

### ä¸º Form Request ä¸‹çš„æ–¹æ³•æ·»åŠ  ctx å‚æ•°

ç‰ˆæœ¬ï¼šv1.10.0

ä¸º Form Request ä¸‹çš„æ–¹æ³•æ·»åŠ  `ctx http.Context` å‚æ•°ï¼š`Rules`ã€`Messages`ã€`Attributes`ã€
`PrepareForValidation`ï¼Œå…è®¸æ‚¨è¿›è¡Œæ›´å¤šè‡ªå®šä¹‰é…ç½®ã€‚

[æŸ¥çœ‹è¯¦æƒ…](../basic/validation#creating-form-requests)

### facades.Auth.Parse æ·»åŠ æœ‰æ•ˆè½½è·è¿”å›

ç‰ˆæœ¬ï¼šv1.10.0

`err := facades.Auth.Parse(ctx, token)` æ›´æ”¹ä¸º `payload, err := facades.Auth.Parse(ctx, token)`ï¼Œé€šè¿‡ `payload`
ä½ å¯ä»¥è·å–ï¼š

1. `Guard`ï¼šå½“å‰å®ˆå«ï¼›
2. `Key`ï¼šç”¨æˆ·æ ‡è¯†ï¼›
3. `ExpireAt`ï¼šè¿‡æœŸæ—¶é—´ï¼›
4. `IssuedAt`ï¼šç­¾å‘æ—¶é—´ï¼›

[æŸ¥çœ‹è¯¦æƒ…](../security/authentication#parse-token)

### Orm çš„ä¸€äº›æ–¹æ³•æ·»åŠ æ–°çš„è¿”å›å€¼

ç‰ˆæœ¬ï¼šv1.10.0

ä»¥ä¸‹æ–¹æ³•æ·»åŠ  `*Result` è¿”å›å€¼ä»¥è·å–å—å½±å“çš„è¡Œæ•°ï¼š

```go
res, err := query.Delete(&user)
res, err := query.Exec(fmt.Sprintf("DELETE FROM users where id = %d", user.ID))
res, err := query.ForceDelete(&User{})
res, err := query.Updates(User{Avatar: "avatar"})

// å—å½±å“çš„è¡Œæ•°
num := res.RowsAffected
```
