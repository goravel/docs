# 从 v1.10 升级到 v1.11

[[toc]]

## v1.11.3

### Bug 修复 🐛

- [Schedule 中 panic 导致进程中断的问题](#schedule-中-panic-导致进程中断的问题)
- [Schedule 中 DailyAt 每分钟都会执行的问题](#schedule-中-dailyat-每分钟都会执行的问题)

## v1.11.2

### Bug 修复 🐛

- [同时使用 Request.Input() 与 Request.Bind() 数据错误的问题](#同时使用-request-input\(\)-与-request-bind\(\)-方法数据错误的问题)

## v1.11.1

### 功能增强 🚀

- [Route 新增资源路由](#route-新增资源路由)
- [Request 新增方法](#request-新增方法)
- [Storage 新增方法](#storage-新增方法)
- [File 新增方法](#file-新增方法)

### Bug 修复 🐛

- [修复文件储存 windows 路径错误的问题](#修复文件储存-windows-路径错误的问题)
- [修复 Request 模块 Header panic 问题](#修复-request-模块-header-panic-问题)

## v1.11.0

## 令人兴奋的新功能 🎉

- [Orm 新增模型事件(1.11.0)](#orm-新增模型事件)

## 功能增强 🚀

- [Cache 新增、优化方法(1.11.0)](#cache-新增、优化方法)
- [Route 支持 Fallback 路由(1.11.0)](#route-支持-fallback-路由)
- [Orm 新增方法(1.11.0)](#orm-新增方法)
- [优化 facades.Config.Add() 方法(1.11.0)](#优化-facades-config-add-方法)
- [修改 Sqlite 驱动(1.11.0)](#修改-sqlite-驱动)
- [contracts/http 增加 net/http 的 Method 映射(1.11.0)](#contracts-http-增加-net-http-的-method-映射)

### 破坏性变化 🛠

- [Orm 优化、移除方法(1.11.0)](#_2-优化、移除废弃的方法)

### Bug 修复 🐛

- Hash 配置在某种情况下不生效的问题(1.11.0)
- RateLimiter 非线程安全的问题(1.11.0)

## 升级指南

请根据本节内容，一步步进行框架升级。

**预计升级时间：1 分钟**

### 1. 更新依赖

`go.mod` 中更新依赖：

```
go get -u github.com/goravel/framework@v1.11.0 && go mod tidy
```

### 2. 优化、移除废弃的方法

```
import (
  "github.com/goravel/framework/database"
  "github.com/goravel/framework/database/gorm"
)

// Deprecated
database.NewGormInstance()
// Replace with(Note: This method is not recommended, please try not to use it)
gorm.New()

// Deprecated
facades.Orm.Query().Updates()
// Replace with(Only modify the method name is fine, no need to modify the parameters)
facades.Orm.Query().Update()

// The Update method changes return value
// Before
err := facades.Orm.Query().Update()
// After
res, err := facades.Orm.Query().Update()
```

## 新增内容

本节内容不涉及到代码修改，只是功能增强。

### Orm 新增模型事件

Version: v1.11.1

Orm 模型触发几个事件，允许你挂接到模型生命周期的如下节点：`Retrieved`、`Creating`、`Created`、`Updating`、`Updated`、`Saving`、`Saved`、`Deleting`、`Deleted`、`ForceDeleting`、`ForceDeleted`。

[详见文档](../orm/getting-started.md#events)

### Cache 新增、优化方法

Version: v1.11.1

#### 新增方法

| 方法名       | 作用                                                                                            |
| --------- | --------------------------------------------------------------------------------------------- |
| Decrement | [Decrement](../digging-deeper/cache.md#incrementing--decrementing-values)                     |
| Increment | [Increment](../digging-deeper/cache.md#incrementing--decrementing-values)                     |
| Lock      | [Atomic Locks](../digging-deeper/cache.md#atomic-locks)                                       |
| Store     | [Accessing Multiple Cache Stores](../digging-deeper/cache.md#accessing-multiple-cache-stores) |

#### Optimize methods

`Get`, `GetBool`, `GetInt`, `GetInt64`, `GetString`, `Pull` no longer need to pass a default value(Backwards compatible).

### Route supports Fallback route

Version: v1.11.1

You may define a route that will be executed when no other route matches the incoming request.

```go
facades.Route.Fallback(func(ctx http.Context) http.Response {
  return ctx.Response().String(404, "not found")
})
```

### Orm adds new methods

Version: v1.11.1

| Method                 | Action                                                               |
| ---------------------- | -------------------------------------------------------------------- |
| db.Raw | [Raw Expressions](../orm/getting-started.md#raw-expressions)         |
| LockForUpdate          | [Pessimistic Locking](../orm/getting-started.md#pessimistic-locking) |
| SharedLock             | [Pessimistic Locking](../orm/getting-started.md#pessimistic-locking) |

### Optimize facades.Config.Add()

Version: v1.11.0

The `configuration` parameter of `facades.Config.Add()` changes to `any` from `map[string]any`, make configuration more flexible.

[For Detail](../getting-started/configuration.md#set-configuration)

### Change Sqlite driver

Because `github.com/mattn/go-sqlite3` requires `CGO` to be started, so replacing a third-party package that does not require `CGO`: `github.com/glebarez/go-sqlite`.

### contracts/http add method mapping of net/http

Version: v1.11.0

You can use `http.MethodGet` in controller directly, instead of import `net/http`.

[For Detail](https://github.com/goravel/framework/blob/v1.11.0/contracts/http/method.go)

### Route Add Resource Routing

Version: v1.11.1

```go
facades.Route.Resource("/resource", resourceController)
```

[For Detail](../the-basics/routing.md#resource-routing)

### Request Add New Methods

Version: v1.11.1

| Method  | Action                                                                                                    |
| ------- | --------------------------------------------------------------------------------------------------------- |
| All     | [Retrieving all input data](../the-basics/request.md#retrieving-all-input-data)                           |
| Host    | [Retrieving the request HOST](../the-basics/request.md#retrieving-the-request-host)                       |
| Queries | [Retrieving input from the query string](../the-basics/request.md#retrieving-input-from-the-query-string) |

About to be deprecated the `Form`, `Json` methods, please use `Input` instead.

### Storage Add New Methods

Version: v1.11.1

| Method       | Action                                                                              |
| ------------ | ----------------------------------------------------------------------------------- |
| LastModified | [Get the last modified time of file](../digging-deeper/filesystem.md#file-metadata) |
| MimeType     | [Get the mime type of file](../digging-deeper/filesystem.md#file-metadata)          |

### File Add New Methods

Version: v1.11.1

| Method       | Action                                                                              |
| ------------ | ----------------------------------------------------------------------------------- |
| LastModified | [Get the last modified time of file](../digging-deeper/filesystem.md#file-metadata) |
| MimeType     | [Get the mime type of file](../digging-deeper/filesystem.md#file-metadata)          |
| Size         | [Get the size of file](../digging-deeper/filesystem.md#file-metadata)               |

### Fix The Error Of Incorrect Windows Path For Filesystem

Version: v1.11.1

windows 系统中路径有斜线不对的问题。

### Fix The Panic Of The Header Method For Request

Version: v1.11.1

`ctx.Request().Header( key: "token")` will panic.

### Fix The Data Error Of Using Request.Input() And Request.Bind() At The Same Time

Version: v1.11.2

`Request.Input()` will clear `Request.Body`, if you use `Request.Bind()` after that, you will not be able to get the data correctly.

### The problem of process interruption caused by panic in Schedule

Version: v1.11.3

The Schedule process will interruption when occurring panic, all tasks wil lbe affected.

### The problem that DailyAt in Schedule will be executed every minute

Version: v1.11.3

Fix the problem that `DailyAt` will be executed every minute:

```go
func (kernel *Kernel) Schedule() []schedule.Event {
  return []schedule.Event{
    facades.Schedule.Call(func() {
      fmt.Print("1")
    }).DailyAt("18:00"),
  }
}
```
