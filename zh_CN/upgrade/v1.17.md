# ä» v1.16 å‡çº§åˆ° v1.17

## ä»¤äººå…´å¥‹çš„æ–°åŠŸèƒ½ ğŸ‰

- [è½»é‡ç‰ˆ Goravel](#è½»é‡ç‰ˆ-goravel)
- [ç®€åŒ–ä»£ç ç»“æ„](#ç®€åŒ–ä»£ç ç»“æ„)
- [è¿›ç¨‹ Facade](#è¿›ç¨‹-facade)
- [å¤æ•°åŒ…](#å¤æ•°åŒ…)
- [æœåŠ¡æä¾›è€…è¿è¡Œå™¨](#æœåŠ¡æä¾›è€…è¿è¡Œå™¨)

## åŠŸèƒ½å¢å¼º ğŸš€

- [facades å¯æŒ‰éœ€å®‰è£…å’Œå¸è½½](#facades-å¯æŒ‰éœ€å®‰è£…å’Œå¸è½½)
- [é‚®ä»¶å¯é€šè¿‡æ¨¡æ¿å‘é€](#é‚®ä»¶å¯é€šè¿‡æ¨¡æ¿å‘é€)
- [build å‘½ä»¤æ”¯æŒæ›´å¤šé€‰é¡¹](#build-å‘½ä»¤æ”¯æŒæ›´å¤šé€‰é¡¹)
- [DB å’Œ Orm æ·»åŠ å’Œä¿®æ”¹å‡½æ•°](#db-å’Œ-orm-æ·»åŠ å’Œä¿®æ”¹å‡½æ•°)
- [Schema æ·»åŠ æ–°å‡½æ•°](#schema-æ·»åŠ æ–°å‡½æ•°)
- [æ·»åŠ æ–°å‘½ä»¤](#æ·»åŠ æ–°å‘½ä»¤)
- [æ·»åŠ  CSRF ä»¤ç‰Œä¸­é—´ä»¶](#æ·»åŠ -csrf-ä»¤ç‰Œä¸­é—´ä»¶)
- [å‘½ä»¤æ”¯æŒé…ç½®å‚æ•°](#å‘½ä»¤æ”¯æŒé…ç½®å‚æ•°)
- [make:migration æ”¯æŒé€šè¿‡æ¨¡å‹åˆ›å»ºè¿ç§»](#make-migration-æ”¯æŒé€šè¿‡æ¨¡å‹åˆ›å»ºè¿ç§»)
- [ä¼˜åŒ– gRPC å®¢æˆ·ç«¯è¿æ¥](#ä¼˜åŒ–-grpc-å®¢æˆ·ç«¯è¿æ¥)
- [æ—¥å¿—æ”¯æŒæ‰“å° JSON æ ¼å¼](#æ—¥å¿—æ”¯æŒæ‰“å°-json-æ ¼å¼)
- [Http æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯](#http-æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯)
- [éªŒè¯æ”¯æŒä¼ é€’ä¸Šä¸‹æ–‡](#éªŒè¯æ”¯æŒä¼ é€’ä¸Šä¸‹æ–‡)
- [Orm æ·»åŠ  WithoutGlobalScopes å‡½æ•°](#orm-æ·»åŠ -withoutglobalscopes-å‡½æ•°)

## ç ´åæ€§å˜åŒ– ğŸ› 

- [ç§»é™¤ machinery é˜Ÿåˆ—é©±åŠ¨](#ç§»é™¤-machinery-é˜Ÿåˆ—é©±åŠ¨)
- [ä¿®æ”¹ gRPC é…ç½®](#ä¿®æ”¹-grpc-é…ç½®)
- [åˆ‡æ¢æ—¥å¿—é©±åŠ¨](#åˆ‡æ¢æ—¥å¿—é©±åŠ¨)
- [ä¼˜åŒ– migrate:rollback å‘½ä»¤](#ä¼˜åŒ–-migrate-rollback-å‘½ä»¤)
- [ç§»é™¤ Http.Request.Bind å‡½æ•°](#ç§»é™¤-http-request-bind-å‡½æ•°)
- [ä¿®æ”¹åŒ…å®‰è£…æ–¹æ³•](#ä¿®æ”¹åŒ…å®‰è£…æ–¹æ³•)

## å‡çº§æŒ‡å—

éšç€ [Golang v1.23 ä¸å†è¢«ç»´æŠ¤](https://endoflife.date/go)ï¼ŒGoravel æ”¯æŒçš„ Golang ç‰ˆæœ¬å·²ä» 1.23 å‡çº§åˆ° 1.24ã€‚

goravel/example é¡¹ç›®ä» v1.16 å‡çº§åˆ° v1.17 çš„ PR å¯ä½œä¸ºå‡çº§å‚è€ƒï¼š[goravel/example#93](https://github.com/goravel/example/pull/93)ã€‚

### 1. æ›´æ–°ä¾èµ–

```shell
go get github.com/goravel/framework@latest

// å¦‚æœä½¿ç”¨ gin
go get github.com/goravel/gin@latest

// å¦‚æœä½¿ç”¨ fiber
go get github.com/goravel/fiber@latest

// å¦‚æœä½¿ç”¨ redis
go get github.com/goravel/redis@latest

// å¦‚æœä½¿ç”¨ S3
go get github.com/goravel/s3@latest

// å¦‚æœä½¿ç”¨ Oss
go get github.com/goravel/oss@latest

// å¦‚æœä½¿ç”¨ Cos
go get github.com/goravel/cos@latest

// å¦‚æœä½¿ç”¨ Minio
go get github.com/goravel/minio@latest

go mod tidy
```

### 2. æ·»åŠ æ–°çš„æœåŠ¡æä¾›è€…

```go
// config/app.go
import (
  ...
  "github.com/goravel/framework/facades/process"
  "github.com/goravel/framework/facades/view"
)

"providers": []foundation.ServiceProvider{
  ...
  &process.ServiceProvider{}, // [!code ++]
  &view.ServiceProvider{}, // [!code ++]
},
```

### 3. ä¿®æ”¹ http å®¢æˆ·ç«¯é…ç½®

åœ¨ `config/http.go` ä¸­æ·»åŠ æ–°é…ç½®ï¼š

```go
"client": map[string]any{ // [!code --]
  "base_url":                config.GetString("HTTP_CLIENT_BASE_URL"), // [!code --]
  "timeout":                 config.GetDuration("HTTP_CLIENT_TIMEOUT"), // [!code --]
  "max_idle_conns":          config.GetInt("HTTP_CLIENT_MAX_IDLE_CONNS"), // [!code --]
  "max_idle_conns_per_host": config.GetInt("HTTP_CLIENT_MAX_IDLE_CONNS_PER_HOST"), // [!code --]
  "max_conns_per_host":      config.GetInt("HTTP_CLIENT_MAX_CONN_PER_HOST"), // [!code --]
  "idle_conn_timeout":       config.GetDuration("HTTP_CLIENT_IDLE_CONN_TIMEOUT"), // [!code --]
}, // [!code --]
"default_client": config.Env("HTTP_CLIENT_DEFAULT", "default"), // [!code ++]
"clients": map[string]any{ // [!code ++]
  "default": map[string]any{ // [!code ++]
    "base_url": config.Env("HTTP_CLIENT_BASE_URL", ""), // [!code ++]
    "timeout": config.Env("HTTP_CLIENT_TIMEOUT", "30s"), // [!code ++]
    "max_idle_conns": config.Env("HTTP_CLIENT_MAX_IDLE_CONNS", 100), // [!code ++]
    "max_idle_conns_per_host": config.Env("HTTP_CLIENT_MAX_IDLE_CONNS_PER_HOST", 2), // [!code ++]
    "max_conns_per_host": config.Env("HTTP_CLIENT_MAX_CONN_PER_HOST", 0), // [!code ++]
    "idle_conn_timeout": config.Env("HTTP_CLIENT_IDLE_CONN_TIMEOUT", "90s"), // [!code ++]
  }, // [!code ++]
}, // [!code ++]
```

### 4. ä¿®æ”¹ gRPC é…ç½®

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¿®æ”¹ gRPC é…ç½®](#ä¿®æ”¹-grpc-é…ç½®)

### 5. å¦‚æœæƒ³é€šè¿‡æ¨¡æ¿å‘é€é‚®ä»¶

åœ¨ `config/mail.go` ä¸­æ·»åŠ æ–°é…ç½®ï¼š

```go
// Template Configuration
//
// This controls template rendering for email views. Template engines are cached
// globally and support both built-in drivers and custom implementations via factories.
//
// Available Drivers: "html", "custom"
"template": map[string]any{
  "default": config.Env("MAIL_TEMPLATE_ENGINE", "html"),
  "engines": map[string]any{
    "html": map[string]any{
      "driver": "html",
      "path":   config.Env("MAIL_VIEWS_PATH", "resources/views/mail"),
    },
  },
},
```

### 6. å¦‚æœä½ å¼€å‘äº†è‡ªå®šä¹‰åŒ…å¹¶é€šè¿‡ `package:install` å‘½ä»¤å®‰è£…å®ƒ

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¿®æ”¹åŒ…å®‰è£…æ–¹æ³•](#ä¿®æ”¹åŒ…å®‰è£…æ–¹æ³•)

### 7. å¦‚æœæ­£åœ¨ä½¿ç”¨ machinery é˜Ÿåˆ—é©±åŠ¨

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ç§»é™¤ machinery é˜Ÿåˆ—é©±åŠ¨](#ç§»é™¤-machinery-é˜Ÿåˆ—é©±åŠ¨)

### 8. å¦‚æœåˆ›å»ºäº†è‡ªå®šä¹‰æ—¥å¿—é©±åŠ¨

éœ€ç›¸åº”ä¿®æ”¹ï¼š[åˆ‡æ¢æ—¥å¿—é©±åŠ¨](#åˆ‡æ¢æ—¥å¿—é©±åŠ¨)

### 9. å¦‚æœæ­£åœ¨ä½¿ç”¨ Http.Request.Bind å‡½æ•°

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ç§»é™¤ Http.Request.Bind å‡½æ•°](#ç§»é™¤-http-request-bind-å‡½æ•°)

### 10. å¦‚æœæ­£åœ¨ä½¿ç”¨ validation.Make å‡½æ•°æˆ–è‡ªå®šä¹‰è§„åˆ™/è¿‡æ»¤å™¨

éœ€ç›¸åº”ä¿®æ”¹ï¼š[éªŒè¯æ”¯æŒä¼ é€’ä¸Šä¸‹æ–‡](#éªŒè¯æ”¯æŒä¼ é€’ä¸Šä¸‹æ–‡)

### 11. å¦‚æœ Orm æ¨¡å‹é…ç½®äº†å…¨å±€ä½œç”¨åŸŸ

éœ€ç›¸åº”ä¿®æ”¹ï¼š[Orm æ·»åŠ  WithoutGlobalScopes å‡½æ•°](#orm-æ·»åŠ -withoutglobalscopes-å‡½æ•°)

## åŠŸèƒ½ä»‹ç»

### è½»é‡ç‰ˆ Goravel

[Goravel Lite](https://github.com/goravel/goravel-lite) æ­£å¼ä¸Šçº¿ï¼Œè¿™æ˜¯ Goravel æ¡†æ¶çš„è½»é‡çº§ç‰ˆæœ¬ï¼Œä¸“ä¸ºå¸Œæœ›ä»¥æœ€å°ä¾èµ–å’Œæ›´å°å ç”¨ç©ºé—´æ„å»ºåº”ç”¨ç¨‹åºçš„å¼€å‘è€…è®¾è®¡ã€‚ å®ƒæä¾›äº† Goravel çš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒæ—¶å…è®¸å¼€å‘è€…æŒ‰éœ€æ·»åŠ å…¶ä»–æ¨¡å—ã€‚

- ä»…åŒ…å«å¿…è¦çš„ facadesï¼š`Artisan`ã€`Config`ã€`Process`ï¼Œå‡å°‘ä½“ç§¯å¹¶æé«˜æ€§èƒ½ã€‚
- å…¶ä»– facades å¯é€šè¿‡ `package:install` å’Œ `package:uninstall` å‘½ä»¤æŒ‰éœ€å®‰è£…å’Œå¸è½½ã€‚
- `goravel/goravel` == `goravel/goravel-lite` + æ‰€æœ‰ facadesã€‚ å¯¹ `goravel/goravel` çš„ä»»ä½•æ”¹è¿›éƒ½åº”æäº¤åˆ° `goravel/goravel-lite`ï¼Œç„¶å GitHub Action ä¼šå°†æ›´æ”¹åŒæ­¥åˆ° `goravel/goravel`ã€‚ `goravel/goravel` ä»ç„¶æ˜¯ Goravel æ¡†æ¶çš„ä¸»è¦ä»“åº“ã€‚

### ç®€åŒ–ä»£ç ç»“æ„

ç®€åŒ–ä»£ç ç»“æ„ï¼Œä»¥æé«˜å¯ç»´æŠ¤æ€§å’Œå¯è¯»æ€§ï¼Œå¹¶ä¸ Laravel ä¿æŒä¸€è‡´ã€‚ æ—§ç»“æ„ä»å¯ä½¿ç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªå‘åå…¼å®¹çš„æ›´æ”¹ã€‚ ä»æ—§ç»“æ„è¿ç§»åˆ°æ–°ç»“æ„æœ‰ç‚¹å¤æ‚ï¼Œå¦‚æœæƒ³è¦è¿ç§»ï¼Œå¯ä»¥å‚è€ƒç¤ºä¾‹ PRï¼š[goravel/example#91](https://github.com/goravel/example/pull/91)ã€‚

1. åˆ é™¤æ‰€æœ‰ `kenel.go` å’Œé»˜è®¤çš„ `*_service_providers.go` æ–‡ä»¶ã€‚ å°† `*_service_providers.go` æ–‡ä»¶ä¸­çš„é…ç½®ç§»åŠ¨åˆ° `bootstrap` æ–‡ä»¶å¤¹ã€‚
2. å°†æ‰€æœ‰ facades ä»æ¡†æ¶å†…éƒ¨ç§»åŠ¨åˆ° `app/facades` æ–‡ä»¶å¤¹ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰æˆ–æ‰©å±•å®ƒä»¬ã€‚
3. ç®€åŒ–å¤–è§‚å¯åŠ¨è¿‡ç¨‹ï¼Œä¸å†éœ€è¦åœ¨ `main.go` ä¸­è¿è¡Œ facadesï¼Œæ›´å¤šè¯¦æƒ…è¯·å‚é˜… [æœåŠ¡æä¾›è€…è¿è¡Œå™¨](../architecture-concepts/service-providers.md#runners)ã€‚
4. æ”¯æŒé€šè¿‡ `WithPath()` å‡½æ•°è‡ªå®šä¹‰ç›®å½•ç»“æ„ï¼Œæ›´å¤šè¯¦æƒ…è¯·å‚é˜… [è‡ªå®šä¹‰ç›®å½•ç»“æ„](../getting-started/directory-structure.md#customize-directory-structure)ã€‚

### è¿›ç¨‹ Facade

Goravel ç°åœ¨å›´ç»• Go æ ‡å‡† `os/exec` åŒ…æä¾›äº†ä¸€ä¸ªå¯Œæœ‰è¡¨ç°åŠ›ä¸”ä¼˜é›…çš„ APIï¼Œå…è®¸ä½ ä»åº”ç”¨ç¨‹åºä¸­æ— ç¼è°ƒç”¨å¤–éƒ¨å‘½ä»¤ã€‚

è¯¦æƒ…è¯· [æŸ¥çœ‹æ–‡æ¡£](../digging-deeper/processes.md)

### å¤æ•°åŒ…

Goravel ç°åœ¨åŒ…å«ä¸€ä¸ªå¤æ•°åŒ–åŒ…ï¼Œå¯æ ¹æ®è¯­è¨€è§„åˆ™å¸®åŠ©åœ¨å•è¯çš„å•æ•°å’Œå¤æ•°å½¢å¼ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚ è¿™å¯¹äºéœ€è¦å¤„ç†ä¸åŒè¯­è¨€åŠå…¶è¯­æ³•è§„åˆ™çš„åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ã€‚

è¯¦æƒ…è¯· [æŸ¥çœ‹æ–‡æ¡£](../digging-deeper/pluralization.md)

### æœåŠ¡æä¾›è€…è¿è¡Œå™¨

æœåŠ¡æä¾›è€…ç°åœ¨å¯ä»¥å®ç° `Runners` æ¥å£ï¼Œåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶è¿è¡Œä»£ç ã€‚ è¿™é€šå¸¸ç”¨äºå¯åŠ¨æˆ–å…³é—­æœåŠ¡æä¾›è€…ä¸­å®šä¹‰çš„æœåŠ¡ï¼Œä¾‹å¦‚è·¯ç”±ã€è°ƒåº¦ã€é˜Ÿåˆ—ç­‰ã€‚ ä½ ä¸å†éœ€è¦åœ¨ `main.go` ä¸­æ‰‹åŠ¨å¯åŠ¨æˆ–å…³é—­è¿™äº›æœåŠ¡ï¼Œå› ä¸º Goravel ä¼šä¸ºä½ å¤„ç†ã€‚

æ­¤åŠŸèƒ½ä»…åœ¨ä½¿ç”¨ [æ–°çš„ç®€åŒ–ä»£ç ç»“æ„](#simplified-code-structure) æ—¶å¯ç”¨ã€‚

[æŸ¥çœ‹æ–‡æ¡£](../architecture-concepts/service-providers.md#runners)

### æ—¥å¿—æ”¯æŒæ‰“å° JSON æ ¼å¼

Goravel çš„æ—¥å¿—ç³»ç»Ÿç°åœ¨æ”¯æŒä»¥ JSON æ ¼å¼è¾“å‡ºæ—¥å¿—ï¼Œä½¿å…¶æ›´å®¹æ˜“ä¸æ—¥å¿—ç®¡ç†ç³»ç»Ÿé›†æˆå¹¶æ‰§è¡Œç»“æ„åŒ–æ—¥å¿—è®°å½•ã€‚

```go
"channels": map[string]any{
  "daily": map[string]any{
    "driver":    "daily",
    "path":      "storage/logs/goravel.log",
    "level":     config.Env("LOG_LEVEL", "debug"),
    "days":      7,
    "print":     true,
    // the value can be "text" or "json"
    "formatter": "json", // [!code ++]
  },
},
```

### HTTP æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯

Goravel çš„ HTTP å®¢æˆ·ç«¯æ¨¡å—ç°åœ¨æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯ï¼Œå…è®¸ä½ å®šä¹‰å’Œä½¿ç”¨å…·æœ‰å„è‡ªé…ç½®çš„ä¸åŒ HTTP å®¢æˆ·ç«¯ï¼Œä»¥æ»¡è¶³åº”ç”¨ç¨‹åºå†…çš„å„ç§ç”¨é€”ã€‚

[æŸ¥çœ‹æ–‡æ¡£](../digging-deeper/http-client.md#making-requests)

### éªŒè¯æ”¯æŒä¼ é€’ä¸Šä¸‹æ–‡

Goravel çš„éªŒè¯æ¨¡å—ç°åœ¨æ”¯æŒå°†ä¸Šä¸‹æ–‡ä¼ é€’ç»™éªŒè¯å‡½æ•°ï¼Œä»è€Œèƒ½å¤ŸåŸºäºè¯·æ±‚æˆ–æ“ä½œçš„ä¸Šä¸‹æ–‡å®ç°æ›´çµæ´»å’ŒåŠ¨æ€çš„éªŒè¯åœºæ™¯ã€‚

```go
validator, err := facades.Validation().Make(input, rules) // [!code --]
validator, err := facades.Validation().Make(ctx, input, rules) // [!code ++]
```

è‡ªå®šä¹‰è§„åˆ™å’Œè¿‡æ»¤å™¨ä¹Ÿæ”¯æŒä¸Šä¸‹æ–‡å‚æ•°ï¼š

```go
type Rule interface {
  Signature() string
  Passes(data Data, val any, options ...any) bool // [!code --]
  Message() string // [!code --]
  Passes(ctx context.Context, data Data, val any, options ...any) bool // [!code ++]
  Message(ctx context.Context) string // [!code ++]
}

type Filter interface {
  Signature() string
  Handle() any // [!code --]
  Handle(ctx context.Context) any // [!code ++]
}
```

### Orm æ·»åŠ  WithoutGlobalScopes å‡½æ•°

Orm æ–°å¢äº†ä¸€ä¸ª `WithoutGlobalScopes` å‡½æ•°ï¼Œå…è®¸ä½ ä»æŸ¥è¯¢ä¸­æ’é™¤æ‰€æœ‰å…¨å±€ä½œç”¨åŸŸã€‚ å½“ä½ æƒ³æ£€ç´¢ä¸å—å…¨å±€ä½œç”¨åŸŸçº¦æŸçš„è®°å½•æ—¶è¿™éå¸¸æœ‰ç”¨ã€‚

```go
var user []User
err := facades.Orm().Model(&User{}).WithoutGlobalScopes().Get(&user)
err := facades.Orm().Model(&User{}).WithoutGlobalScopes("name").Get(&user)
```

ä¸ºäº†æ”¯æŒè®¾ç½®å…¨å±€ä½œç”¨åŸŸåç§°ï¼Œæ¨¡å‹çš„ `GlobalScope` æ¥å£å·²è¢«ä¿®æ”¹ï¼š

```go
import "github.com/goravel/framework/contracts/orm"

type User struct {
  orm.Model
  Name string
}

func (r *User) GlobalScopes() []func(orm.Query) orm.Query { // [!code --]
func (r *User) GlobalScopes() map[string]func(orm.Query) orm.Query { // [!code ++]
  return map[string]func(orm.Query) orm.Query{
    "name": func(query orm.Query) orm.Query {
      return query.Where("name", "goravel")
    },
  }
}
```

### facades å¯æŒ‰éœ€å®‰è£…å’Œå¸è½½

éšç€ [è½»é‡åŒ– Goravel](#è½»é‡åŒ–-goravel) çš„å‘å¸ƒï¼Œç°åœ¨å¯ä»¥é€šè¿‡ `package:install` å’Œ `package:uninstall` å‘½ä»¤æ ¹æ®éœ€è¦å®‰è£…å’Œå¸è½½å¤–è§‚ã€‚ æ³¨æ„ï¼šæ­¤åŠŸèƒ½ä»…åœ¨ä½ çš„é¡¹ç›®ä½¿ç”¨è½»é‡åŒ– Goravel æ„å»ºæˆ–å‡çº§åˆ° [æ–°çš„ç®€åŒ–ä»£ç ç»“æ„](#simplified-code-structure) æ—¶å¯ç”¨ã€‚

[æŸ¥çœ‹æ–‡æ¡£](../architecture-concepts/facades.md#install-uninstall-facades)

### é‚®ä»¶å¯é€šè¿‡æ¨¡æ¿å‘é€

é‚®ä»¶å‘é€æ”¯æŒæ¨¡æ¿ï¼Œå…è®¸ä½ ä½¿ç”¨é¢„å®šä¹‰çš„æ¨¡æ¿å‘é€ç”µå­é‚®ä»¶ï¼Œä»¥è·å¾—æ›´å¥½çš„ä¸€è‡´æ€§å’Œæ›´è½»æ¾çš„ç®¡ç†ã€‚ æ¨¡æ¿æ”¯æŒ http/template å’Œè‡ªå®šä¹‰é©±åŠ¨ã€‚

è¯¦æƒ…è¯· [æŸ¥çœ‹æ–‡æ¡£](../digging-deeper/mail.md#using-template)

### build å‘½ä»¤æ”¯æŒæ›´å¤šé€‰é¡¹

å‘ `build` å‘½ä»¤æ·»åŠ æ–°çš„ `--arch` å’Œ `--static` é€‰é¡¹ï¼Œå…è®¸ä½ æŒ‡å®šç›®æ ‡æ¶æ„ä»¥åŠæ˜¯å¦æ„å»ºé™æ€äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

### DB å’Œ Orm æ·»åŠ å’Œä¿®æ”¹å‡½æ•°

æ–°å‡½æ•°ï¼š

- `Avg(column string, dest any) error`ï¼šè®¡ç®—åˆ—çš„å¹³å‡å€¼ã€‚
- `Min(column string, dest any) error`ï¼šæŸ¥æ‰¾åˆ—çš„æœ€å°å€¼ã€‚
- `Max(column string, dest any) error`ï¼šæŸ¥æ‰¾åˆ—çš„æœ€å¤§å€¼ã€‚
- `WhereAll(columns []string, args ...any) Query`ï¼šå‘æŸ¥è¯¢æ·»åŠ â€œæ‰€æœ‰åˆ—åŒ¹é…â€å­å¥ã€‚
- `WhereAny(columns []string, args ...any) Query`ï¼šå‘æŸ¥è¯¢æ·»åŠ â€œä»»æ„åˆ—åŒ¹é…â€å­å¥ã€‚
- `WhereNone(columns []string, args ...any) Query`ï¼šå‘æŸ¥è¯¢æ·»åŠ â€œæ²¡æœ‰åˆ—åŒ¹é…â€å­å¥ã€‚

ä¿®æ”¹çš„å‡½æ•°ï¼š

```go
// ä¹‹å‰
Sum(column string) (int64, error)

// ç°åœ¨
Sum(column string, dest any) error
```

### Schema æ·»åŠ æ–°å‡½æ•°

å‘ Schema æ·»åŠ æ–°å‡½æ•°ï¼Œä»¥å¢å¼ºæ•°æ®åº“æ¨¡å¼ç®¡ç†èƒ½åŠ›ã€‚

- `DateTimes`ï¼šåœ¨è¡¨ä¸Šåˆ›å»º `created_at` å’Œ `updated_at` åˆ—ã€‚
- `ForeignID`ï¼šä¸ºå¤–é”®åˆ›å»ºä¸€ä¸ª unsigned big integer å­—æ®µã€‚
- `ForeignUlid`ï¼šä¸ºå¤–é”®åˆ›å»ºä¸€ä¸ª ULID åˆ—ã€‚
- `ForeignUuid`ï¼šä¸ºå¤–é”®åˆ›å»ºä¸€ä¸ª UUID åˆ—ã€‚

### æ·»åŠ æ–°å‘½ä»¤

- `make:provider`ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æœåŠ¡æä¾›è€…ç±»ã€‚
- `make:view`ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è§†å›¾æ¨¡æ¿æ–‡ä»¶ã€‚

### æ·»åŠ  CSRF ä»¤ç‰Œä¸­é—´ä»¶

æ·»åŠ ä¸€ä¸ªæ–°çš„ä¸­é—´ä»¶ï¼Œä»¥é˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰æ”»å‡»ã€‚ æ­¤ä¸­é—´ä»¶å¯åº”ç”¨äºè·¯ç”±ï¼Œä»¥ç¡®ä¿è¯·æ±‚æ¥è‡ªç»è¿‡èº«ä»½éªŒè¯çš„æ¥æºã€‚

[æŸ¥çœ‹æ–‡æ¡£](../the-basics/views.md#csrf-token-middleware)

### å‘½ä»¤æ”¯æŒé…ç½®å‚æ•°

å‘½ä»¤ç°åœ¨æ”¯æŒé…ç½®å‚æ•°ï¼Œå…è®¸ä½ åœ¨è‡ªå®šä¹‰å‘½ä»¤ä¸­æ›´æœ‰æ•ˆåœ°å®šä¹‰å’Œå¤„ç†å‘½ä»¤è¡Œå‚æ•°ã€‚

è¯¦æƒ…è¯· [æŸ¥çœ‹æ–‡æ¡£](../digging-deeper/artisan-console.md#arguments)

### make:migration æ”¯æŒé€šè¿‡æ¨¡å‹åˆ›å»ºè¿ç§»

`make:migration` å‘½ä»¤å·²å¢å¼ºï¼Œæ”¯æŒåŸºäºç°æœ‰æ¨¡å‹åˆ›å»ºè¿ç§»ã€‚ è¿™å…è®¸é€šè¿‡åˆ©ç”¨æ¨¡å‹ä¸­å®šä¹‰çš„ç»“æ„æ¥æ›´å¿«åœ°åˆ›å»ºè¿ç§»ã€‚

[æŸ¥çœ‹æ–‡æ¡£](../database/migrations.md#create-migrations)

### ä¼˜åŒ– gRPC å®¢æˆ·ç«¯è¿æ¥

ä¸º gRPC å®¢æˆ·ç«¯å®ç°å®¢æˆ·ç«¯è¿æ¥æ± ï¼Œä»¥ä¼˜åŒ–æ€§èƒ½å’Œèµ„æºåˆ©ç”¨ç‡ã€‚ è¿™å…è®¸å¤ç”¨ç°æœ‰è¿æ¥ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºæ–°è¿æ¥ï¼Œä»è€Œå‡å°‘å»¶è¿Ÿå¹¶æé«˜æ•ˆç‡ã€‚

### ç§»é™¤ machinery é˜Ÿåˆ—é©±åŠ¨

é‰´äºåœ¨ v1.16 ä¸­å·²å¼ƒç”¨ï¼Œmachinery é˜Ÿåˆ—é©±åŠ¨ç°å·²è¢«å®Œå…¨ç§»é™¤ã€‚ å¦‚æœä½ ä»åœ¨ä½¿ç”¨å®ƒï¼Œè¯·éµå¾ª [v1.16 å‡çº§æ–‡æ¡£](./v1.16.md#optimize-queue-module-configuration) ä¸­çš„æŒ‡å—è¿ç§»åˆ°å…¶ä»–é˜Ÿåˆ—é©±åŠ¨ã€‚

### ä¿®æ”¹ gRPC é…ç½®

gRPC é…ç½® `grpc.clients` å·²ä¿®æ”¹ä¸º `grpc.servers`ï¼Œå¹¶ä¸” `facades.Grpc().Client()` å‡½æ•°å·²è¢«å¼ƒç”¨ï¼Œå°†åœ¨ v1.18 ä¸­ç§»é™¤ï¼Œè¯·æ”¹ç”¨ `facades.Grpc().Connect()` å‡½æ•°ã€‚

```go
// config/grpc.go
"clients": map[string]any{ // [!code --]
"servers": map[string]any{ // [!code ++]
```

```go
facades.Grpc().Client(ctx, "name") // [!code --]
facades.Grpc().Connect("name") // [!code ++]
```

### åˆ‡æ¢æ—¥å¿—é©±åŠ¨

æ—¥å¿—é©±åŠ¨å·²ä» `logrus` åˆ‡æ¢åˆ° `log/slog`ï¼Œä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½å’Œç»“æ„åŒ–æ—¥å¿—è®°å½•èƒ½åŠ›ã€‚

è‡ªå®šä¹‰æ—¥å¿—é©±åŠ¨æ¥å£å·²ä¿®æ”¹ï¼š

```go
// framework/contracts/log/Logger
package log

type Logger interface {
  // Handle pass channel config path here
  Handle(channel string) (Hook, error) // [!code --]
  Handle(channel string) (Handler, error) // [!code ++]
}
```

ä½ å¯ä»¥ä½¿ç”¨ `log.HookToHandler` å‡½æ•°æ¥é€‚é…æ—§çš„è‡ªå®šä¹‰æ—¥å¿—é©±åŠ¨ï¼š

```go
type CustomLogger struct {}

func (logger *CustomLogger) Handle(channel string) (log.Handler, error) {
  hook := /* æ‚¨çš„æ—§è‡ªå®šä¹‰æ—¥å¿—é©±åŠ¨é€»è¾‘ */
  
  return log.HookToHandler(hook), nil
}
```

### ä¼˜åŒ– migrate:rollback å‘½ä»¤

ä¹‹å‰ï¼Œ`migrate:rollback` å‘½ä»¤ä¸€æ¬¡åªå›æ»šä¸€ä¸ªè¿ç§»ï¼Œè¿™ä¸ Laravel çš„è¡Œä¸ºä¸ä¸€è‡´ã€‚ ç°åœ¨è¯¥å‘½ä»¤é»˜è®¤å°†å›æ»šæœ€åä¸€æ‰¹çš„æ‰€æœ‰è¿ç§»ã€‚ ä½ ä»ç„¶å¯ä»¥ä½¿ç”¨ `--step` é€‰é¡¹æ¥æŒ‡å®šè¦å›æ»šçš„æ‰¹æ¬¡æ•°ã€‚

### ç§»é™¤ Http.Request.Bind å‡½æ•°

`Http.Request` æ¥å£ä¸Šçš„ `Bind` å‡½æ•°å·²è¢«ç§»é™¤ã€‚ ä½ ç°åœ¨å¯ä»¥é€šè¿‡ `response` ä½¿ç”¨ `Bind` æ–¹æ³•ã€‚

```go
var user User
response, err := facades.Http().Bind(&user).Get("https://github.com") // [!code --]
response, err := facades.Http().Get("https://github.com") // [!code ++]
err = response.Bind(&user) // [!code ++]
```

### ä¿®æ”¹åŒ…å®‰è£…æ–¹æ³•

ä»¥å‰ï¼Œè¿è¡Œ `package:install` å‘½ä»¤æ—¶ï¼ŒåŒ…çš„ service provder é€šè¿‡ `setup.go` æ–‡ä»¶å®‰è£…åˆ° `config/app.go` ä¸­ã€‚ ç°åœ¨ï¼Œç”±äº[ç®€åŒ–ä»£ç ç»“æ„](#ç®€åŒ–ä»£ç ç»“æ„)ï¼Œservice provder å°†è¢«å®‰è£…åˆ° `bootstrap/providers.go` æ–‡ä»¶ä¸­ã€‚ å› æ­¤ï¼ŒåŒ…å®‰è£…æ–¹æ³•å·²ä¿®æ”¹ä¸ºåŒæ—¶æ”¯æŒæ–°æ—§ä»£ç ç»“æ„ã€‚ æœªæ¥ï¼Œæ—§ä»£ç ç»“æ„å°†è¢«å®Œå…¨å¼ƒç”¨ã€‚ ä¾‹å¦‚ï¼š

```go
// setup/setup.go
package main

import (
  "os"

  "github.com/goravel/framework/packages"
  "github.com/goravel/framework/packages/match"
  "github.com/goravel/framework/packages/modify"
  "github.com/goravel/framework/support/path"
)

func main() {
  // åˆå§‹åŒ– setup ä»¥è·å–è·¯å¾„ï¼Œå§‹ç»ˆåº”åœ¨å¼€å¤´è°ƒç”¨ã€‚
  setup := packages.Setup(os.Args) // [!code ++]

  appConfigPath := path.Config("app.go")
  postgresServiceProvider := "&postgres.ServiceProvider{}"

  // åœ¨æ–°ä»£ç ç»“æ„ä¸­ï¼ŒGetModulePath å‡½æ•°å·²è¢«ç§»é™¤ï¼Œè¯·æ”¹ç”¨ setup.Paths().Module().Import()
  modulePath := packages.GetModulePath() // [!code --]
  moduleImport := setup.Paths().Module().Import() // [!code ++]

  packages.Setup(os.Args).Install( // [!code --]
  setup.Install( // [!code ++]
      // æ³¨å†Œ postgres service provider
      modify.GoFile(appConfigPath). // [!code --]
        Find(match.Imports()).Modify(modify.AddImport(modulePath)). // [!code --]
        Find(match.Providers()).Modify(modify.Register(postgresServiceProvider)), // [!code --]
      modify.RegisterProvider(moduleImport, postgresServiceProvider), // [!code ++]

      ...
    ).
    Uninstall(
      // ç§»é™¤ postgres service provider
      modify.GoFile(appConfigPath). // [!code --]
        Find(match.Providers()).Modify(modify.Unregister(postgresServiceProvider)). // [!code --]
        Find(match.Imports()).Modify(modify.RemoveImport(modulePath)), // [!code --]
      modify.UnregisterProvider(moduleImport, postgresServiceProvider), // [!code ++]
      ...
    ).
    Execute()
}
```

å¦‚æœä½ æƒ³åœ¨åŒ…ä¸­åŒæ—¶æ”¯æŒæ–°æ—§ä»£ç ç»“æ„ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è®¾ç½®ã€‚ ç®€å•æ¥è¯´ï¼Œä½ éœ€è¦é€šè¿‡ `env.IsBootstrapSetup()` å‡½æ•°æ£€æŸ¥é¡¹ç›®æ˜¯å¦ä½¿ç”¨æ–°ä»£ç ç»“æ„ï¼Œç„¶ååº”ç”¨ä¸åŒçš„ä¿®æ”¹ã€‚

```go
package main

import (
  "os"

  "github.com/goravel/framework/packages"
  "github.com/goravel/framework/packages/match"
  "github.com/goravel/framework/packages/modify"
  "github.com/goravel/framework/support/env"
  "github.com/goravel/framework/support/path"
)

func main() {
  // åˆå§‹åŒ– setup ä»¥è·å–è·¯å¾„ï¼Œå§‹ç»ˆåº”åœ¨å¼€å¤´è°ƒç”¨ã€‚
  setup := packages.Setup(os.Args)

  appConfigPath := path.Config("app.go")
  postgresServiceProvider := "&postgres.ServiceProvider{}"

  // ä½¿ç”¨æ–°çš„ setup.Paths().Module().Import() æ–¹æ³•è·å–æ¨¡å—å¯¼å…¥è·¯å¾„
  moduleImport := setup.Paths().Module().Import()

  setup.Install(
    // å¦‚æœä½¿ç”¨æ—§ä»£ç ç»“æ„ï¼Œå°† postgres service provider æ·»åŠ åˆ° app.go
    modify.When(func(_ map[string]any) bool {
      return !env.IsBootstrapSetup()
    }, modify.GoFile(appConfigPath).
      Find(match.Imports()).Modify(modify.AddImport(moduleImport)).
      Find(match.Providers()).Modify(modify.Register(postgresServiceProvider))),

    // å¦‚æœä½¿ç”¨æ–°ä»£ç ç»“æ„ï¼Œå°† postgres service provider æ·»åŠ åˆ° providers.go
    modify.When(func(_ map[string]any) bool {
      return env.IsBootstrapSetup()
    }, modify.RegisterProvider(moduleImport, postgresServiceProvider)),

  ).Uninstall(
    // å¦‚æœä½¿ç”¨æ—§ä»£ç ç»“æ„ï¼Œä» app.go ä¸­ç§»é™¤ postgres service provider
    modify.When(func(_ map[string]any) bool {
      return !env.IsBootstrapSetup()
    }, modify.GoFile(appConfigPath).
      Find(match.Providers()).Modify(modify.Unregister(postgresServiceProvider)).
      Find(match.Imports()).Modify(modify.RemoveImport(moduleImport))),

    // å¦‚æœä½¿ç”¨æ–°ä»£ç ç»“æ„ï¼Œä» providers.go ä¸­ç§»é™¤ postgres service provider
    modify.When(func(_ map[string]any) bool {
      return env.IsBootstrapSetup()
    }, modify.UnregisterProvider(moduleImport, postgresServiceProvider)),
  ).Execute()
}
```
