<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>队列 | Goravel</title>
    <meta name="description" content="Goravel 是一个功能完整且可扩展性极强的 Web 应用程序框架。作为一个起始脚手架，帮助 Gopher 快速构建自己的应用程序。">
    <meta name="generator" content="VitePress v2.0.0-alpha.4">
    <link rel="preload stylesheet" href="/assets/style.SY_qOvSh.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    <script type="module" src="/assets/chunks/metadata.cf76abb0.js"></script>
    <script type="module" src="/assets/app.Dz5T6ddl.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.QUpL7I0k.js">
    <link rel="modulepreload" href="/assets/chunks/framework.CFMQV-X7.js">
    <link rel="modulepreload" href="/assets/zh_CN_digging-deeper_queues.md.BGx5CZkM.lean.js">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HJQNEG5H69"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-HJQNEG5H69");</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-6d6bd506><!--[--><!--]--><!--[--><span tabindex="-1" data-v-333ac9e3></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-333ac9e3>跳转到内容</a><!--]--><!----><header class="VPNav" data-v-6d6bd506 data-v-f962ce96><div class="VPNavBar" data-v-f962ce96 data-v-d51ec76f><div class="wrapper" data-v-d51ec76f><div class="container" data-v-d51ec76f><div class="title" data-v-d51ec76f><div class="VPNavBarTitle has-sidebar" data-v-d51ec76f data-v-785ec13f><a class="title" href="/zh_CN/" data-v-785ec13f><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.png" alt data-v-cb6a40a9><!--]--><!----><!--[--><!--]--></a></div></div><div class="content" data-v-d51ec76f><div class="content-body" data-v-d51ec76f><!--[--><!--]--><div class="VPNavBarSearch search" data-v-d51ec76f><!--[--><!----><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-d51ec76f data-v-d968f6b6><span id="main-nav-aria-label" class="visually-hidden" data-v-d968f6b6> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/zh_CN/getting-started/installation.html" tabindex="0" data-v-d968f6b6 data-v-1833877b><!--[--><span data-v-1833877b>快速开始</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://space.bilibili.com/1886603340/channel/seriesdetail?sid=4302621&amp;ctype=0" target="_blank" rel="noreferrer" tabindex="0" data-v-d968f6b6 data-v-1833877b><!--[--><span data-v-1833877b>视频教程</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/zh_CN/getting-started/contributions.html#%E6%96%B0%E5%A2%9E%E8%AF%AD%E8%A8%80" tabindex="0" data-v-d968f6b6 data-v-1833877b><!--[--><span data-v-1833877b>翻译</span><!--]--></a><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-d51ec76f data-v-db588f7f data-v-32fb9f2f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="切换语言" data-v-32fb9f2f><span class="text" data-v-32fb9f2f><span class="vpi-languages option-icon" data-v-32fb9f2f></span><!----><span class="vpi-chevron-down text-icon" data-v-32fb9f2f></span></span></button><div class="menu" data-v-32fb9f2f><div class="VPMenu" data-v-32fb9f2f data-v-de6964af><!----><!--[--><!--[--><div class="items" data-v-db588f7f><p class="title" data-v-db588f7f>简体中文</p><!--[--><div class="VPMenuLink" data-v-db588f7f data-v-00af6738><a class="VPLink link" href="/digging-deeper/queues.html" data-v-00af6738><!--[--><span data-v-00af6738>English</span><!--]--></a></div><div class="VPMenuLink" data-v-db588f7f data-v-00af6738><a class="VPLink link" href="/zh_TW/digging-deeper/queues.html" data-v-00af6738><!--[--><span data-v-00af6738>繁體中文</span><!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-d51ec76f data-v-b02e1af6><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-b02e1af6 data-v-f6092fbf data-v-bc410495><span class="check" data-v-bc410495><span class="icon" data-v-bc410495><!--[--><span class="vpi-sun sun" data-v-f6092fbf></span><span class="vpi-moon moon" data-v-f6092fbf></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-d51ec76f data-v-0d1c8122 data-v-f5bbba7e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/goravel/goravel" aria-label="github" target="_blank" rel="noopener" data-v-f5bbba7e data-v-46233840><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://discord.gg/cFc5csczzS" aria-label="discord" target="_blank" rel="noopener" data-v-f5bbba7e data-v-46233840><span class="vpi-social-discord"></span></a><a class="VPSocialLink no-icon" href="https://x.com/goravelgolang" aria-label="x" target="_blank" rel="noopener" data-v-f5bbba7e data-v-46233840><span class="vpi-social-x"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-d51ec76f data-v-b5430ab9 data-v-32fb9f2f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-32fb9f2f><span class="vpi-more-horizontal icon" data-v-32fb9f2f></span></button><div class="menu" data-v-32fb9f2f><div class="VPMenu" data-v-32fb9f2f data-v-de6964af><!----><!--[--><!--[--><div class="group translations" data-v-b5430ab9><p class="trans-title" data-v-b5430ab9>简体中文</p><!--[--><div class="VPMenuLink" data-v-b5430ab9 data-v-00af6738><a class="VPLink link" href="/digging-deeper/queues.html" data-v-00af6738><!--[--><span data-v-00af6738>English</span><!--]--></a></div><div class="VPMenuLink" data-v-b5430ab9 data-v-00af6738><a class="VPLink link" href="/zh_TW/digging-deeper/queues.html" data-v-00af6738><!--[--><span data-v-00af6738>繁體中文</span><!--]--></a></div><!--]--></div><div class="group" data-v-b5430ab9><div class="item appearance" data-v-b5430ab9><p class="label" data-v-b5430ab9>主题</p><div class="appearance-action" data-v-b5430ab9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-b5430ab9 data-v-f6092fbf data-v-bc410495><span class="check" data-v-bc410495><span class="icon" data-v-bc410495><!--[--><span class="vpi-sun sun" data-v-f6092fbf></span><span class="vpi-moon moon" data-v-f6092fbf></span><!--]--></span></span></button></div></div></div><div class="group" data-v-b5430ab9><div class="item social-links" data-v-b5430ab9><div class="VPSocialLinks social-links-list" data-v-b5430ab9 data-v-f5bbba7e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/goravel/goravel" aria-label="github" target="_blank" rel="noopener" data-v-f5bbba7e data-v-46233840><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://discord.gg/cFc5csczzS" aria-label="discord" target="_blank" rel="noopener" data-v-f5bbba7e data-v-46233840><span class="vpi-social-discord"></span></a><a class="VPSocialLink no-icon" href="https://x.com/goravelgolang" aria-label="x" target="_blank" rel="noopener" data-v-f5bbba7e data-v-46233840><span class="vpi-social-x"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-d51ec76f data-v-3b6fb606><span class="container" data-v-3b6fb606><span class="top" data-v-3b6fb606></span><span class="middle" data-v-3b6fb606></span><span class="bottom" data-v-3b6fb606></span></span></button></div></div></div></div><div class="divider" data-v-d51ec76f><div class="divider-line" data-v-d51ec76f></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-6d6bd506 data-v-8868f59d><div class="container" data-v-8868f59d><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-8868f59d><span class="vpi-align-left menu-icon" data-v-8868f59d></span><span class="menu-text" data-v-8868f59d>菜单</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-8868f59d data-v-b36c5d28><button data-v-b36c5d28>回到顶部</button><!----></div></div></div><aside class="VPSidebar" data-v-6d6bd506 data-v-be6c243f><div class="curtain" data-v-be6c243f></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-be6c243f><span class="visually-hidden" id="sidebar-aria-label" data-v-be6c243f> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-785c71f3><section class="VPSidebarItem level-0" data-v-785c71f3 data-v-687e6ffa><div class="item" role="button" tabindex="0" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><h2 class="text" data-v-687e6ffa>快速开始</h2><!----></div><div class="items" data-v-687e6ffa><!--[--><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/getting-started/installation.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>安装</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/getting-started/configuration.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/getting-started/directory-structure.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>目录结构</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/getting-started/compile.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>编译</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/getting-started/releases.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>发行说明</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/getting-started/contributions.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>贡献指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/getting-started/packages.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>优秀扩展包</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/getting-started/privacy.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>隐私政策</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-785c71f3><section class="VPSidebarItem level-0" data-v-785c71f3 data-v-687e6ffa><div class="item" role="button" tabindex="0" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><h2 class="text" data-v-687e6ffa>升级</h2><!----></div><div class="items" data-v-687e6ffa><!--[--><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/upgrade/v1.16.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>从 v1.15 升级到 v1.16</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/upgrade/v1.15.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>从 v1.14 升级到 v1.15</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/upgrade/history.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>历史</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-785c71f3><section class="VPSidebarItem level-0" data-v-785c71f3 data-v-687e6ffa><div class="item" role="button" tabindex="0" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><h2 class="text" data-v-687e6ffa>核心架构</h2><!----></div><div class="items" data-v-687e6ffa><!--[--><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/architecture-concepts/request-lifecycle.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>生命周期</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/architecture-concepts/service-container.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>服务容器</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/architecture-concepts/service-providers.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>服务提供者</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/architecture-concepts/facades.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>门面</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-785c71f3><section class="VPSidebarItem level-0" data-v-785c71f3 data-v-687e6ffa><div class="item" role="button" tabindex="0" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><h2 class="text" data-v-687e6ffa>基本功能</h2><!----></div><div class="items" data-v-687e6ffa><!--[--><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/the-basics/routing.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>路由</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/the-basics/middleware.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>中间件</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/the-basics/controllers.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>控制器</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/the-basics/request.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>请求</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/the-basics/response.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>响应</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/the-basics/views.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>视图</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/the-basics/grpc.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>Grpc</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/the-basics/session.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>会话</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/the-basics/validation.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>验证</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/the-basics/logging.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>日志</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-785c71f3><section class="VPSidebarItem level-0 has-active" data-v-785c71f3 data-v-687e6ffa><div class="item" role="button" tabindex="0" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><h2 class="text" data-v-687e6ffa>高级功能</h2><!----></div><div class="items" data-v-687e6ffa><!--[--><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/digging-deeper/artisan-console.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>Artisan 命令行</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/digging-deeper/cache.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>缓存</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/digging-deeper/event.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>事件</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/digging-deeper/filesystem.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>文件存储</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/digging-deeper/mail.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>邮件</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/digging-deeper/queues.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>队列</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/digging-deeper/task-scheduling.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>任务调度</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/digging-deeper/localization.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>本地化</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/digging-deeper/package-development.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>包开发</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/digging-deeper/color.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>彩色输出</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/digging-deeper/strings.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>字符串</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/digging-deeper/helpers.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>辅助函数</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/digging-deeper/http-client.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>HTTP 客户端</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-785c71f3><section class="VPSidebarItem level-0" data-v-785c71f3 data-v-687e6ffa><div class="item" role="button" tabindex="0" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><h2 class="text" data-v-687e6ffa>安全</h2><!----></div><div class="items" data-v-687e6ffa><!--[--><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/security/authentication.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>身份验证</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/security/authorization.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>授权</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/security/encryption.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>加密</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/security/hashing.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>哈希</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-785c71f3><section class="VPSidebarItem level-0" data-v-785c71f3 data-v-687e6ffa><div class="item" role="button" tabindex="0" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><h2 class="text" data-v-687e6ffa>数据库</h2><!----></div><div class="items" data-v-687e6ffa><!--[--><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/database/getting-started.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>快速入门</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/database/queries.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>查询构建器</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/database/migrations.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>迁移</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/database/seeding.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>填充</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-785c71f3><section class="VPSidebarItem level-0" data-v-785c71f3 data-v-687e6ffa><div class="item" role="button" tabindex="0" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><h2 class="text" data-v-687e6ffa>ORM</h2><!----></div><div class="items" data-v-687e6ffa><!--[--><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/orm/getting-started.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>快速入门</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/orm/relationships.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>关系</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/orm/factories.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>工厂</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-785c71f3><section class="VPSidebarItem level-0" data-v-785c71f3 data-v-687e6ffa><div class="item" role="button" tabindex="0" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><h2 class="text" data-v-687e6ffa>测试</h2><!----></div><div class="items" data-v-687e6ffa><!--[--><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/testing/getting-started.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>快速入门</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/testing/http-tests.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>HTTP 测试</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-687e6ffa data-v-687e6ffa><div class="item" data-v-687e6ffa><div class="indicator" data-v-687e6ffa></div><a class="VPLink link link" href="/zh_CN/testing/mock.html" data-v-687e6ffa><!--[--><p class="text" data-v-687e6ffa>模拟</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-6d6bd506 data-v-95f78ad9><div class="VPDoc has-sidebar has-aside" data-v-95f78ad9 data-v-d3be2d93><!--[--><!--]--><div class="container" data-v-d3be2d93><div class="aside" data-v-d3be2d93><div class="aside-curtain" data-v-d3be2d93></div><div class="aside-container" data-v-d3be2d93><div class="aside-content" data-v-d3be2d93><div class="VPDocAside" data-v-d3be2d93 data-v-6e9cb4e7><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-6e9cb4e7 data-v-3473656f><div class="content" data-v-3473656f><div class="outline-marker" data-v-3473656f></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-3473656f>页面导航</div><ul class="VPDocOutlineItem root" data-v-3473656f data-v-5ead4e78><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-6e9cb4e7></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d3be2d93><div class="content-container" data-v-d3be2d93><!--[--><!--]--><main class="main" data-v-d3be2d93><div style="position:relative;" class="vp-doc _zh_CN_digging-deeper_queues" data-v-d3be2d93><div><h1 id="队列" tabindex="-1">队列 <a class="header-anchor" href="#队列" aria-label="Permalink to “队列”">​</a></h1><nav class="table-of-contents"><ul><li><a href="#简介">简介</a><ul><li><a href="#连接-vs-队列">连接 Vs 队列</a></li></ul></li><li><a href="#驱动">驱动</a><ul><li><a href="#同步驱动">同步驱动</a></li><li><a href="#数据库驱动">数据库驱动</a></li><li><a href="#自定义驱动">自定义驱动</a></li></ul></li><li><a href="#创建任务">创建任务</a><ul><li><a href="#生成任务类">生成任务类</a></li><li><a href="#类结构">类结构</a></li><li><a href="#注册任务">注册任务</a></li></ul></li><li><a href="#启动队列服务器">启动队列服务器</a></li><li><a href="#停止队列服务器">停止队列服务器</a></li><li><a href="#调度任务">调度任务</a><ul><li><a href="#同步调度">同步调度</a></li><li><a href="#任务链">任务链</a></li><li><a href="#延迟调度">延迟调度</a></li><li><a href="#自定义队列-连接">自定义队列 &amp; 连接</a></li></ul></li><li><a href="#获取失败任务">获取失败任务</a></li><li><a href="#重试失败任务">重试失败任务</a></li><li><a href="#queue-arg-type-支持的类型">queue.Arg.Type 支持的类型</a></li></ul></nav><h2 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-label="Permalink to “简介”">​</a></h2><p>在构建 Web 应用程序时，你可能需要执行一些比较耗时的任务（例如解析和存储上传的 CSV 文件）。 Goravel 可以让你轻松地创建可在后台排队处理的任务。 通过将耗时的任务移到队列中，你的应用程序可以以超快的速度响应 Web 请求，并为客户提供更好的用户体验。 我们使用 <code>facades.Queue()</code> 实现这些功能。</p><h3 id="连接-vs-队列" tabindex="-1">连接 Vs 队列 <a class="header-anchor" href="#连接-vs-队列" aria-label="Permalink to “连接 Vs  队列”">​</a></h3><p>在开始使用 Goravel 队列之前，理解「连接」和「队列」之间的区别非常重要。 在 <code>config/queue.go</code> 配置文件中，有一个 <code>connections</code> 配置选项。 此选项定义到后端服务（如 Redis）的特定连接。 然而，任何给定的队列连接都可能有多个「队列」，这些「队列」可能被认为是不同的堆栈或成堆的排队任务。</p><p>请注意，<code>config/queue.go</code> 文件中的每个连接配置示例都包含一个 <code>queue</code> 属性。 这是将任务发送到给定连接时将被分配到的默认队列。 换句话说，如果你没有显式地定义任务应该被发送到哪个队列，那么该任务将被放置在 <code>queue</code> 定义的队列上。</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 这个任务将被推送到默认队列</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> facades.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Job</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}, []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {Type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;int&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 这个任务将被推送到 &quot;emails&quot; 队列</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> facades.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Job</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}, []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {Type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;int&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OnQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;emails&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><h2 id="驱动" tabindex="-1">驱动 <a class="header-anchor" href="#驱动" aria-label="Permalink to “驱动”">​</a></h2><p>队列配置文件存储在 <code>config/queue.go</code> 中，可以在配置文件中设置不同的队列驱动。</p><h3 id="同步驱动" tabindex="-1">同步驱动 <a class="header-anchor" href="#同步驱动" aria-label="Permalink to “同步驱动”">​</a></h3><p>同步驱动是默认的驱动，它不会将任务推送到队列中，而是直接在当前进程中执行。</p><h3 id="数据库驱动" tabindex="-1">数据库驱动 <a class="header-anchor" href="#数据库驱动" aria-label="Permalink to “数据库驱动”">​</a></h3><p>为使用 <code>database</code> 驱动，需要先创建一个数据库表来存储任务：<a href="https://github.com/goravel/goravel/blob/master/database/migrations/20210101000002_create_jobs_table.go" target="_blank" rel="noreferrer">20210101000002_create_jobs_table.go</a>。 该迁移文件默认在 <code>database/migrations</code> 目录下。</p><h3 id="自定义驱动" tabindex="-1">自定义驱动 <a class="header-anchor" href="#自定义驱动" aria-label="Permalink to “自定义驱动”">​</a></h3><p>如果当前驱动无法满足需求，你可以自定义驱动。 需要实现 <code>contracts/queue/driver.go</code> 中的 <a href="https://github.com/goravel/framework/blob/master/contracts/queue/driver.go#L14" target="_blank" rel="noreferrer">Driver</a> 接口。</p><p>官方实现了 <code>Redis</code> 驱动，你可以参考 <a href="https://github.com/goravel/framework/blob/master/queue/drivers/redis/driver.go" target="_blank" rel="noreferrer">Redis Driver</a> 实现自己的自定义驱动。</p><p>自定义驱动实现后，可以添加配置到 <code>config/queue.go</code> 中：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span>...</span></span>
<span class="line"><span>&quot;connections&quot;: map[string]any{</span></span>
<span class="line"><span>  &quot;redis&quot;: map[string]any{</span></span>
<span class="line"><span>    &quot;driver&quot;: &quot;custom&quot;,</span></span>
<span class="line"><span>    &quot;connection&quot;: &quot;default&quot;,</span></span>
<span class="line"><span>    &quot;queue&quot;: &quot;default&quot;,</span></span>
<span class="line"><span>    &quot;via&quot;: func() (queue.Driver, error) {</span></span>
<span class="line"><span>        return redisfacades.Queue(&quot;redis&quot;) // The redis value is the key of connections</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>},</span></span></code></pre></div><h2 id="创建任务" tabindex="-1">创建任务 <a class="header-anchor" href="#创建任务" aria-label="Permalink to “创建任务”">​</a></h2><h3 id="生成任务类" tabindex="-1">生成任务类 <a class="header-anchor" href="#生成任务类" aria-label="Permalink to “生成任务类”">​</a></h3><p>默认情况下，应用程序的所有的任务都被存储在了 <code>app/jobs</code> 目录中。 如果 <code>app/jobs</code> 目录不存在，当你运行 <code>make:job</code> Artisan 命令时，将会自动创建该目录：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> make:job</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ProcessPodcast</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> make:job</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> user/ProcessPodcast</span></span></code></pre></div><h3 id="类结构" tabindex="-1">类结构 <a class="header-anchor" href="#类结构" aria-label="Permalink to “类结构”">​</a></h3><p>任务类非常简单，包含 <code>Signature</code>, <code>Handle</code> 方法。 <code>Signature</code> 是任务类的唯一标识，<code>Handle</code> 在队列处理任务时将会被调用。 在调用任务时传入的 <code>[]queue.Arg{}</code> 将会被传入 <code>Handle</code> 中：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jobs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ProcessPodcast</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Signature The name and signature of the job.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ProcessPodcast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Signature</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;process_podcast&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Handle Execute the job.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ProcessPodcast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Handle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ...interface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="任务重试" tabindex="-1">任务重试 <a class="header-anchor" href="#任务重试" aria-label="Permalink to “任务重试”">​</a></h4><p>任务类支持一个可选的 <code>ShouldRetry(err error, attempt int) (retryable bool, delay time.Duration)</code> 方法，用于控制任务重试。</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ShouldRetry determines if the job should be retried based on the error.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ProcessPodcast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ShouldRetry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">err</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">attempt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">retryable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">delay</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Duration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time.Second</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="注册任务" tabindex="-1">注册任务 <a class="header-anchor" href="#注册任务" aria-label="Permalink to “注册任务”">​</a></h3><p>当任务创建好后，需要注册到 <code>app/provides/queue_service_provider.go</code>，以便能够正确调用。 如果是通过 <code>make:job</code> 命令生成的任务，则不需要手动注册，框架会自动注册。</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">receiver </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">QueueServiceProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Job</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Job</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="启动队列服务器" tabindex="-1">启动队列服务器 <a class="header-anchor" href="#启动队列服务器" aria-label="Permalink to “启动队列服务器”">​</a></h2><p>在根目录下 <code>main.go</code> 中启动队列服务器。</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/goravel/framework/facades</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">goravel/bootstrap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // This bootstraps the framework and gets it ready for use.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  bootstrap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Boot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Start queue server by facades.Queue().</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  go</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> facades.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      facades.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Errorf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Queue run error: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>facades.Queue().Worker</code> 方法中可以传入不同的参数，通过启动多个 <code>facades.Queue().Worker</code>，可以达到监听多个队列的目的。</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 不传参数，默认监听 `config/queue.go` 中的配置，并发数为 1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">go</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> facades.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    facades.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Errorf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Queue run error: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 监听 redis 链接的 processing 队列，并发数 10，重试次数 3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">go</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> facades.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Connection: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;redis&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Queue: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;processing&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Concurrent: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Tries: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    facades.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Errorf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Queue run error: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}()</span></span></code></pre></div><h2 id="停止队列服务器" tabindex="-1">停止队列服务器 <a class="header-anchor" href="#停止队列服务器" aria-label="Permalink to “停止队列服务器”">​</a></h2><p>当队列服务器运行时，你可以通过调用 <code>Shutdown</code> 方法来停止队列服务器，该方法会等待当前运行中的任务完成后才会停止队列。</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> facades.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Shutdown</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><h2 id="调度任务" tabindex="-1">调度任务 <a class="header-anchor" href="#调度任务" aria-label="Permalink to “调度任务”">​</a></h2><p>一旦写好了任务类，你可以使用任务本身的 <code>Dispatch</code> 方法来调度它：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> controllers</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/goravel/framework/contracts/queue</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/goravel/framework/contracts/http</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/goravel/framework/facades</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">goravel/app/jobs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UserController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UserController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Show</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> facades.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Job</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}, []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // do something</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="同步调度" tabindex="-1">同步调度 <a class="header-anchor" href="#同步调度" aria-label="Permalink to “同步调度”">​</a></h3><p>如果你想立即（同步）调度任务，你可以使用 <code>DispatchSync</code> 方法。 使用此方法时，任务不会排队，会在当前进程内立即执行：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> controllers</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/goravel/framework/contracts/queue</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/goravel/framework/contracts/http</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/goravel/framework/facades</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">goravel/app/jobs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UserController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">serController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Show</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> facades.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Job</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}, []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DispatchSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // do something</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="任务链" tabindex="-1">任务链 <a class="header-anchor" href="#任务链" aria-label="Permalink to “任务链”">​</a></h3><p>任务链允许你指定一组按顺序运行的排队任务。 如果序列中的一个任务失败，其余的任务将不会运行。 要执行一个排队的任务链，你可以使用 <code>facades.Queue()</code> 提供的 <code>Chain</code> 方法：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> facades.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Chain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Job: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Args: []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {Type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;int&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Job: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Test1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Args: []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {Type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;int&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><h3 id="延迟调度" tabindex="-1">延迟调度 <a class="header-anchor" href="#延迟调度" aria-label="Permalink to “延迟调度”">​</a></h3><p>如果你想指定任务不应立即被队列处理，你可以在调度任务时使用 <code>Delay</code> 方法。 例如，让我们指定一个任务在分派 100 秒后处理：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> facades.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Job</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}, []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Delay</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(time.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">time.Second)).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><h3 id="自定义队列-连接" tabindex="-1">自定义队列 &amp; 连接 <a class="header-anchor" href="#自定义队列-连接" aria-label="Permalink to “自定义队列 &amp; 连接”">​</a></h3><h4 id="分派到特定队列" tabindex="-1">分派到特定队列 <a class="header-anchor" href="#分派到特定队列" aria-label="Permalink to “分派到特定队列”">​</a></h4><p>通过将任务推送到不同的队列，你可以对排队的任务进行「分类」，甚至可以优先考虑分配给各个队列的 worker 数量。</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> facades.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Job</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}, []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OnQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;processing&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><h4 id="调度到特定连接" tabindex="-1">调度到特定连接 <a class="header-anchor" href="#调度到特定连接" aria-label="Permalink to “调度到特定连接”">​</a></h4><p>如果你的应用程序与多个队列连接交互，你可以使用 <code>OnConnection</code> 方法指定将任务推送到哪个连接：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> facades.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Job</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}, []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OnConnection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sync&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><p>你可以将 <code>OnConnection</code> 和 <code>OnQueue</code> 方法链接在一起，以指定任务的连接和队列：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> facades.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Job</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}, []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OnConnection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sync&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OnQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;processing&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><h2 id="获取失败任务" tabindex="-1">获取失败任务 <a class="header-anchor" href="#获取失败任务" aria-label="Permalink to “获取失败任务”">​</a></h2><p>你可以使用 <code>queue:failed</code> 命令来获取失败任务，该命令会从数据库 <code>failed_jobs</code> 表中获取失败任务：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> queue:failed</span></span></code></pre></div><h2 id="重试失败任务" tabindex="-1">重试失败任务 <a class="header-anchor" href="#重试失败任务" aria-label="Permalink to “重试失败任务”">​</a></h2><p>如果任务在处理过程中失败，你可以使用 <code>queue:retry</code> 命令来重试该任务。 在重试任务前请先从数据库 <code>failed_jobs</code> 表中获取要重试的任务 UUID：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重试单个任务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> queue:retry</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 4427387e-c75a-4295-afb3-2f3d0e410494</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重试多个任务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> queue:retry</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 4427387e-c75a-4295-afb3-2f3d0e410494</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eafdd963-a8b7-4aca-9421-b376ed9f4382</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重试指定连接的失败任务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> queue:retry</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --connection=redis</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重试指定队列的失败任务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> queue:retry</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --queue=processing</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重试指定连接和队列的失败任务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> queue:retry</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --connection=redis</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --queue=processing</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重试所有失败任务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> queue:retry</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all</span></span></code></pre></div><h2 id="queue-arg-type-支持的类型" tabindex="-1"><code>queue.Arg.Type</code> 支持的类型 <a class="header-anchor" href="#queue-arg-type-支持的类型" aria-label="Permalink to “queue.Arg.Type 支持的类型”">​</a></h2><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int8</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int16</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int32</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int64</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint8</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint16</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint32</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint64</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float32</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float64</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int16</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int32</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int64</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint16</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint32</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint64</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float32</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float64</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-d3be2d93 data-v-7ab990f9><!--[--><!--]--><div class="edit-info" data-v-7ab990f9><div class="edit-link" data-v-7ab990f9><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/goravel/docs/edit/master/zh_CN/digging-deeper/queues.md" target="_blank" rel="noreferrer" data-v-7ab990f9><!--[--><span class="vpi-square-pen edit-link-icon" data-v-7ab990f9></span> 在 GitHub 上编辑此页面<!--]--></a></div><div class="last-updated" data-v-7ab990f9><p class="VPLastUpdated" data-v-7ab990f9 data-v-809efa9f>最后更新于: <time datetime="2025-10-26T03:32:27.000Z" data-v-809efa9f></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-7ab990f9><span class="visually-hidden" id="doc-footer-aria-label" data-v-7ab990f9>Pager</span><div class="pager" data-v-7ab990f9><a class="VPLink link pager-link prev" href="/zh_CN/digging-deeper/mail.html" data-v-7ab990f9><!--[--><span class="desc" data-v-7ab990f9>上一页</span><span class="title" data-v-7ab990f9>邮件</span><!--]--></a></div><div class="pager" data-v-7ab990f9><a class="VPLink link pager-link next" href="/zh_CN/digging-deeper/task-scheduling.html" data-v-7ab990f9><!--[--><span class="desc" data-v-7ab990f9>下一页</span><span class="title" data-v-7ab990f9>任务调度</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-6d6bd506 data-v-11c72509><div class="container" data-v-11c72509><p class="message" data-v-11c72509>基于 MIT 许可发布</p><p class="copyright" data-v-11c72509>版权所有 © 2021-2025 Goravel</p></div></footer><!--[--><!--]--></div></div>
    
    
  </body>
</html>