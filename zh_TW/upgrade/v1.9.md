# 從 v1.8 升級到 v1.9

[[toc]]

## 功能增強 🚀

- [新增資料庫讀寫分離(1.9.0)](#add-database-read-write-separation)
- [新增資料庫連接池配置(1.9.0)](#add-database-pool-configuration)
- [自定義 .env 路徑(1.9.0)](#custom--env-path)
- [Cache 新增 Memory 驅動(1.9.0)](#cache-add-memory-driver)
- [Orm 新增分頁方法(1.9.0)](#orm-add-paginate-method)
- [新增 make 命令(1.9.0)](#add-make-command)
- [Response 新增方法(1.9.0)](#add-new-methods-for-Response)

## 破壞性變化 🛠

- [Request PrepareForValidation 方法新增 error 返回(1.9.0)](#add-return-for-request-prepareforvalidation-method)

## Bug 修復 🐛

- [File 獲取錯誤的文件類型(1.9.0)](#file-gets-the-wrong-file-type)
- [修復 make:event 和 make:listener 命令生成模板有誤的問題(1.9.0)](#fix-template-error-on-make-event-and-make-listener-command)
- [修復保存文件時有些類型無法獲取後綴的問題(1.9.1)](#fix-some-types-cannot-obtain-suffixes-when-save-file)

## 升級依賴 ⬆️

- build(deps): bump github.com/gin-gonic/gin from v1.7.3 to v1.8.2

## 升級指南

**預估升級時間：10 分鐘**

### 更新依賴

在 `go.mod` 文件中更新依賴：

```
go get -u github.com/goravel/framework@v1.9.0
```

### 新增資料庫讀寫分離

Version: v1.9.0

資料庫支持讀寫分離，[詳見文檔](../orm/getting-started.md#read--write-connections)。

### 新增資料庫連接池配置

Version: v1.9.0

資料庫配置文件 `config/database.go` 新增連接池配置 `pool`，[詳見文件](https://github.com/goravel/goravel/blob/v1.9.x/config/database.go)。

### 自定義 .env 路徑

Version: v1.9.0

```
// 開發
go run . --env=../.env

// 編譯後
./main --env=../.env
```

### Cache 新增 Memory 驅動

Version: v1.9.0

`config/cache.go` 新增 `memory` 配置：

```
"stores": map[string]any{
  // 新增
  "memory": map[string]any{
    "driver": "memory",
  },
},
```

[詳見文件](https://github.com/goravel/goravel/blob/v1.9.x/config/cache.go)

### Orm 新增分頁方法

Version: v1.9.0

`facades.Orm` 新增 `Paginate` 方法，[詳見文檔](../orm/getting-started.md#Paginate)。

### 新增 make 命令

Version: v1.9.0

```
// 創建控制器
go run . artisan make:controller UserController

// 創建中間件
go run . artisan make:middleware Cors

// 創建模型
go run . artisan make:model User
```

### Response 新增方法

Version: v1.9.0

| 方法名      | 操作                                               |
| -------- | ------------------------------------------------ |
| Data     | [自定義返回](../the-basics/response.md#custom-return) |
| Redirect | [重定向](../the-basics/response.md#redirect)        |

### Request PrepareForValidation 方法新增 error 返回

Version: v1.9.0

如果你使用到了 [表單驗證中的 PrepareForValidation 方法](../the-basics/validation.md#驗證前格式化數據)，請新增返回值：`PrepareForValidation(data validation.Data) error`。

### File 獲取錯誤的文件類型

Version: v1.9.0

修復 `.docx`, `.xlsx` 等類型錯誤的識別為 `.zip` 的問題。

### 修復 make:event 和 make:listener 命令生成模板有誤的問題

Version: v1.9.0

`import "github.com/goravel/framework/contracts/events"` 改為 `import "github.com/goravel/framework/contracts/event"`

### 修復保存文件時有些類型無法獲取後綴的問題

Version: v1.9.1

下面代碼有些類型無法獲取後綴:

```go
file, err := ctx.Request().File()
file.Store("upload")
```
