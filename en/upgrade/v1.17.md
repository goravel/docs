# Upgrading To v1.17 From v1.16

## Exciting New Features ðŸŽ‰

- [Simplified code structure](#simplified-code-structure)
- [Process Management](#process-management)
- [Pluralizer package](#pluralizer-package)
- [TODO Install facades](#pluralizer-package)
- [TODO Goravel Lite (optimize service-providers.md)](#pluralizer-package)
- [TODO Telemetry module](#pluralizer-package)

## Enhancements ðŸš€

- [Mail can be sent via template](#mail-can-be-sent-via-template)
- [The build command supports more flags](#the-build-command-supports-more-flags)
- [Add and modify functions for DB and Orm](#add-and-modify-functions-for-db-and-orm)
- [Add new functions for Schema](#add-new-functions-for-schema)
- [Add new commands](#add-new-commands)
- [Add csrf token middleware](#add-csrf-token-middleware)
- [Command supports configure Arguments](#command-supports-configure-arguments)
- [make:migration supports create migration via model](#make-migration-supports-create-migration-via-model)
- [TODO Runners](#pluralizer-package)

## Breaking Changes ðŸ› 

- [Remove machinery queue driver](#remove-machinery-queue-driver)

## Upgrade Guide

As [Golang v1.23 is no longer maintained](https://endoflife.date/go), the Golang version of Goravel supports has been upgraded from 1.23 to 1.24.

goravel/example project from v1.16 to v1.17 PR can be used as an upgrade reference: [goravel/example#93](https://github.com/goravel/example/pull/93).

### 1. Update Dependencies

```shell
go get github.com/goravel/framework@latest

// If using gin
go get github.com/goravel/gin@latest

// If using fiber
go get github.com/goravel/fiber@latest

// If using redis
go get github.com/goravel/redis@latest

// If using S3
go get github.com/goravel/s3@latest

// If using Oss
go get github.com/goravel/oss@latest

// If using Cos
go get github.com/goravel/cos@latest

// If using Minio
go get github.com/goravel/minio@latest

go mod tidy
```

### 2. If you want to send mail via template

Add new configuration in `config/mail.go`:

```go
// Template Configuration
//
// This controls template rendering for email views. Template engines are cached
// globally and support both built-in drivers and custom implementations via factories.
//
// Available Drivers: "html", "custom"
"template": map[string]any{
  "default": config.Env("MAIL_TEMPLATE_ENGINE", "html"),
  "engines": map[string]any{
    "html": map[string]any{
      "driver": "html",
      "path":   config.Env("MAIL_VIEWS_PATH", "resources/views/mail"),
    },
  },
},
```

### 3. If you are using machinery queue driver

Need to modify accordingly: [Remove machinery queue driver](#remove-machinery-queue-driver)

## Feature Introduction

### Simplified code structure

The code structure has been simplified to improve maintainability and readability to consitent with Laravel. The old structure can still be used, it's a backward compatible change. It's a bit complicated to migrate from old structure to new structure, there is an example PR for reference if needed: [goravel/example#91](https://github.com/goravel/example/pull/91).

1. Remove all `kenel.go` and default `*_service_providers.go` files.
2. Move configurations in `*_service_providers.go` files to the `bootstrap` folder.
3. Move all facades from framework intenal to `app/facades` folder.
4. Simplify the facades startup process, no need to run facades in `main.go` anymore.

### Process Management

Goravel now provides an expressive and elegant API around Go's standard `os/exec` package, allowing you to invoke external commands from your application seamlessly.

[View Document](../digging-deeper/processes.md)

### Pluralizer package

Goravel now includes a pluralizer package that helps with converting words between singular and plural forms based on language rules. This is useful for applications that need to handle different languages and their grammatical rules.

[View Document](../digging-deeper/pluralization.md)

### Mail can be sent via template

Mail sending now supports templates, allowing you to send emails using predefined templates for better consistency and easier management. The template supports http and custom drivers.

[View Document](../digging-deeper/mail.md#using-template)

### The build command supports more flags

Add new `--arch` and `--static` flags to the `build` command, allowing you to specify the target architecture and whether to build a static binary.

### Add and modify functions for DB and Orm

New functions:

- `Avg(column string, dest any) error`: Calculate the average value of a column.
- `Min(column string, dest any) error`: Find the minimum value of a column.
- `Max(column string, dest any) error`: Find the maximum value of a column.
- `WhereAll(columns []string, args ...any) Query`: Adds a "where all columns match" clause to the query.
- `WhereAny(columns []string, args ...any) Query`: Adds a "where any column matches" clause to the query.
- `WhereNone(columns []string, args ...any) Query`: Adds a "where none of the columns match" clause to the query.

Modified functions:

```go
// Before
Sum(column string) (int64, error)

// After
Sum(column string, dest any) error
```

### Add new functions for Schema

New functions have been added to the Schema package to enhance database schema management capabilities.

- `DateTimes`: Create `created_at` and `updated_at` columns on the table.
- `ForeignID`: Create an unsigned big integer column for foreign keys.
- `ForeignUlid`: Create a ULID column for foreign keys.
- `ForeignUuid`: Create a UUID column for foreign keys.

### Add new commands

- `make:provider`: Create a new service provider class.
- `make:view`: Create a new view template file.

### Add csrf token middleware

A new middleware has been added to protect against Cross-Site Request Forgery (CSRF) attacks. This middleware can be applied to routes to ensure that requests are coming from authenticated sources.

[View Document](../the-basics/views.md#csrf-token-middleware)

### Command supports configure Arguments

Commands now support configuring arguments, allowing you to define and handle command-line arguments more effectively within your custom commands.

[View Document](../digging-deeper/artisan-console.md#arguments)

### make:migration supports create migration via model

The `make:migration` command has been enhanced to support creating migrations based on existing models. This allows for quicker migration creation by leveraging the structure defined in your models.

[View Document](../database/migrations.md#create-migrations)

### Remove machinery queue driver

The machinery queue driver has been removed totally given it's deprecated in v1.16. Please follow the guidelines in the [v1.16 upgrade document](./v1.16.md#optimize-queue-module-configuration) to migrate to other queue drivers if you are still using it.
