# Upgrading To v1.15 From v1.14

### Exciting New Features ðŸŽ‰

### Enhancements ðŸš€

- [Request supports configure Filter](#request-supports-configure-filter)
- [Request adds the BindQuery method](#request-adds-the-bindquery-method)
- [Support control Schedule log output](#support-control-schedule-log-output)
- [Mail supports Mailable template](#mail-supports-mailable-template)
- [HTTP supports return Stream](#http-supports-return-stream)
- [Auth adds the Id method](#auth-adds-the-id-method)
- [Validation supports Regex rules](#validation-supports-regex-rules)
- [The Create method of Orm supports using map to create](#the-create-method-of-orm-supports-using-map-to-create)
- [Schedule adds the Stop method](#schedule-adds-the-stop-method)

### Breaking Changes ðŸ› 

- [Optimize the Worker method of the Queue module](#optimize-the-worker-method-of-the-queue-module)
- [The name of Postgresql driver changes to Postgres](#the-name-of-postgresql-driver-changes-to-postgres)
- [Modify the Orm.Transaction method callback parameter type](#modify-the-ormtransaction-method-callback-parameter-type)
- [Optimize the Delete and ForceDelete methods of Orm](#optimize-the-delete-and-forcedelete-methods-of-orm)
- [Optimize the Decrement and Increment methods of Cache](#optimize-the-decrement-and-increment-methods-of-cache)
- [Optimize the Call method of Artisan](#optimize-the-call-method-of-artisan)
- [Route deprecates the Shutdown method](#route-deprecates-the-shutdown-method)

## Upgrade Guide

**Estimated Upgrade Time: 10 Minutes**

As [Golang v1.21 is no longer maintained](https://endoflife.date/go), the Golang version of Goravel supports has been upgraded from 1.21 to 1.22. Please update the version in the go.mod file.

### 1. Updating Dependencies

```
go get -u github.com/goravel/framework@v1.15.0

// If using gin
go get -u github.com/goravel/gin@v1.3.0

// If using fiber
go get -u github.com/goravel/fiber@v1.3.0
```

### 2. ä¸º Add Filters method for Request

Enter the `app/http/requests` directory and add the `Filters` method to all Requests.

```go
// Modify `r *StorePostRequest` to your own value
func (r *StorePostRequest) Filters(ctx http.Context) map[string]string {
	return map[string]string{}
}
```

### 3. If you are using the Mail module

Modify the way `Subject` is set:

```go
-- import "github.com/goravel/framework/contracts/mail"
++ import "github.com/goravel/framework/mail"

-- Content(mail.Content{Subject: "Subject", Html: "<h1>Hello Goravel</h1>"})
++ Content(mail.Html("<h1>Hello Goravel</h1>")).Subject("Subject")
```

If you are using the `From` method:

```go
-- import "github.com/goravel/framework/contracts/mail"
++ import "github.com/goravel/framework/mail"

-- From(mail.From{Address: testFromAddress, Name: testFromName}
++ From(mail.Address(testFromAddress, testFromName)
```

If you are using the `Queue` method:

```go
-- import "github.com/goravel/framework/contracts/mail"
++ import "github.com/goravel/framework/mail"

-- Queue(mail.Queue{Connection: "high", Queue: "mail"})
++ Queue(mail.Queue().Connection("high").Queue("mail"))
```

### 4. If you are using the Worker method of the Queue module

Need to modify accordingly: [Optimize the Worker method of the Queue module](#optimize-the-worker-method-of-the-queue-module)

### 5. If you are using the Postgresql driver

Need to modify accordingly: [The name of Postgresql driver changes to Postgres](#the-name-of-postgresql-driver-changes-to-postgres)

### 6. If you are using the Orm.Transaction method

Need to modify accordingly: [Modify the Orm.Transaction method callback parameter type](#modify-the-ormtransaction-method-callback-parameter-type)

### 7. If you are using the Delete or ForceDelete method of Orm

Need to modify accordingly: [Optimize the Delete and ForceDelete methods of Orm](#optimize-the-delete-and-forcedelete-methods-of-orm)

### 8. If you are using the Shutdown method of Route

Need to modify accordingly: [Route adds the Stop method](#route-adds-the-stop-method)

### 9. If you are using the Decrement and Increment methods of Cache

Need to modify accordingly: [Optimize the Decrement and Increment methods of Cache](#optimize-the-decrement-and-increment-methods-of-cache)

### 10. If you are using the Call method of Artisan

Need to modify accordingly: [Optimize the Call method of Artisan](#optimize-the-call-method-of-artisan)

### 11. If you are using the Shutdown method of Route

Need to modify accordingly: [Route deprecates the Shutdown method](#route-deprecates-the-shutdown-method)

## Feature Introduction

### Request supports configure Filter

Version: v1.15.0

[View Documentation](../the-basics/validation.md#filter-input-data)

### Request adds the BindQuery method

Version: v1.15.0

Support using `ctx.Request().BindQuery()` to bind parameters directly from the link.

[View Documentation](../the-basics/request.md#bind-query)

### Support control Schedule log output

Version: v1.15.0

When `app.debug` is `false`, only `error` level logs will be output.

### Mail supports Mailable template

Version: v1.15.0

[View Documentation](../digging-deeper/mail.md#using-mailable)

### HTTP supports return Stream

Version: v1.15.0

[View Documentation](../the-basics/response.md#return-stream)

### Auth adds the Id method

Version: v1.15.0

```go
id, err := facades.Auth(ctx).Id()
```

### Validation supports Regex rules

Version: v1.15.0

```go
validator, err := ctx.Request().Validate(map[string]string{
  "code": "required|regex:\d{4,6}",
})
```

### The Create method of Orm supports using map to create

Version: v1.15.0

[View Documentation](../orm/getting-started.md#create)

### Schedule adds the Stop method

Version: v1.15.0

[View Documentation](../digging-deeper/task-scheduling.md#stopping-the-scheduler)

### Optimize the Worker method of the Queue module

Version: v1.15.0

When the `Worker` method does not need to set parameters, it can be kept empty:

```go
-- facades.Queue().Worker(nil).Run()
++ facades.Queue().Worker().Run()
```

When you need to set parameters, the parameters are changed from pointers to instances:

```go
-- facades.Queue().Worker(&queue.Args{Connection: "redis").Run()
++ facades.Queue().Worker(queue.Args{Connection: "redis").Run()
```

### The name of Postgresql driver changes to Postgres

Version: v1.15.0

The name of the Postgresql driver has been changed to `postgres`. If you are using the Postgresql driver, you need to modify the configration file:

```go
// config/database.go
"postgres": map[string]any{
  -- "driver":   "postgresql",
  ++ "driver":   "postgres",
  "host":     config.Env("DB_HOST", "127.0.0.1"),
}
```

### Modify the Orm.Transaction method callback parameter type

Version: v1.15.0

The `facades.Orm().Transaction()` method callback parameter type has been changed from `func(tx orm.Transaction) error` to `func(tx orm.Query) error`, if you are using this method, please modify accordingly.

```go
-- facades.Orm().Transaction(func(tx orm.Transaction) error {
++ facades.Orm().Transaction(func(tx orm.Query) error {
  var user models.User

  return tx.Find(&user, user.ID)
})
```

### Optimize the Delete and ForceDelete methods of Orm

Version: v1.15.0

If you are passing an ID to the `Delete` or `ForceDelete` method to delete data, use the `Where` method instead:

```go
-- facades.Orm().Query().Delete(&models.User{}, 10)
++ facades.Orm().Query().Where("id", 10).Delete(&models.User{})

-- facades.Orm().Query().Delete(&models.User{}, []uint{1, 2, 3})
++ facades.Orm().Query().WhereIn("id", []uint{1, 2, 3}).Delete(&models.User{})

-- facades.Orm().Query().ForceDelete(&models.User{}, 10)
++ facades.Orm().Query().ForceDelete("id", 10).Delete(&models.User{})
```

`Delete` and `ForceDelete` methods support deleting data without passing parameters:

```go
res, err := facades.Orm().Query().Model(&models.User{}).Where("id", 1).Delete()
res, err := facades.Orm().Query().Table("users").Where("id", 1).Delete()
```

### Rename the Shutdown method of Route to Stop

Version: v1.15.0

In order to keep the Stop method name consistent with other modules, we renamed the `Shutdown` method to `Stop`.

```go
-- facades.Route().Shutdown()
++ facades.Route().Stop()
```

### Optimize the Decrement and Increment methods of Cache

Version: v1.15.0

The input and output types of the `Decrement` and `Increment` methods have been changed from `int` to `int64`:

```go
-- Decrement(key string, value ...int) (int, error)
++ Decrement(key string, value ...int64) (int64, error)

-- Increment(key string, value ...int) (int, error)
++ Increment(key string, value ...int64) (int64, error)
```

### Optimize the Call method of Artisan

Version: v1.15.0

The `facades.Artisan().Call()` method will panic if an error is encountered during execution. It now returns an error, so handle the error if you are using this method.

```go
err := facades.Artisan().Call("command:name")
```

### Route deprecates the Shutdown method

Version: v1.15.0

The `Shutdown` method has been deprecated, please use the `Stop` method instead.

```go
-- facades.Route().Shutdown()
++ facades.Route().Stop()
```
