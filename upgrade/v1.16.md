# Upgrading To v1.16 From v1.15

### Exciting New Features üéâ

- [Split Database Driver](#split-database-driver)

### Enhancements üöÄ

- [Migration adds methods](#migration-adds-methods)
- [Grpc adds Shutdown method](#grpc-adds-shutdown-method)
- [Artisan adds disable print colors option](#artisan-adds-disable-print-colors-option)
- [Encrypt and decrypt env file](#encrypt-and-decrypt-env-file)

### Breaking Changes üõ†

- [Optimize Config moudlue methods default value type](#optimize-config-moudlue-methods-default-value-type)
- [Remove SQL Migration](#remove-sql-migration)
- [Optimize Orm module methods](#optimize-orm-module-methods)
- [Optimize Path method](#optimize-path-method)

## Upgrade Guide

**Estimated Upgrade Time: 10 Minutes**

As [Golang v1.22 is no longer maintained](https://encdoflife.date/go), the Golang version of Goravel supports has been upgraded from 1.22 to 1.23. Please update the version in the go.mod file.

### 1. Update Dependencies

```
go get -u github.com/goravel/framework@v1.16.0

// If using gin
go get -u github.com/goravel/gin@v1.4.0

// If using fiber
go get -u github.com/goravel/fiber@v1.4.0

// If using redis
go get -u github.com/goravel/redis@v1.4.0

// If using S3
go get -u github.com/goravel/s3@v1.4.0

// If using Oss
go get -u github.com/goravel/oss@v1.4.0

// If using Cos
go get -u github.com/goravel/cos@v1.4.0

// If using Minio
go get -u github.com/goravel/minio@v1.4.0

// If using Cloudinary
go get -u github.com/goravel/cloudinary@v1.4.0
```

```
go mod tidy
```

### 2. Modify Database Configuration

Delete the `connections` in the `config/database.go` file that you do not need, and install the database driver you need.

| Database Type | Driver Package |
| ------------- | -------------- |
| Postgres      | github.com/goravel/postgres |
| MySQL         | github.com/goravel/mysql |
| Sqlserver     | github.com/goravel/sqlserver |
| SQLite     | github.com/goravel/sqlite |

For example:

```go
// config/database.go
"connections": map[string]any{
--  "postgres": map[string]any{
--    "host":     config.Env("DB_HOST", "127.0.0.1"),
--    "port":     config.Env("DB_PORT", 5432),
--    "database": config.Env("DB_DATABASE", "forge"),
--    "username": config.Env("DB_USERNAME", ""),
--    "password": config.Env("DB_PASSWORD", ""),
--    "sslmode":  "disable",
--    "timezone": "UTC", // Asia/Shanghai
--    "prefix":   "",
--    "singular": false,
--    "schema":   config.Env("DB_SCHEMA", "public"),
++    "via": func() (driver.Driver, error) {
++      return postgresfacades.Postgres("postgres")
++    },
--  },
--  "mysql": map[string]any{
--    "driver":   "mysql",
--    "host":     config.Env("DB_HOST", "127.0.0.1"),
--    "port":     config.Env("DB_PORT", 3306),
--    "database": config.Env("DB_DATABASE", "forge"),
--    "username": config.Env("DB_USERNAME", ""),
--    "password": config.Env("DB_PASSWORD", ""),
--    "charset":  "utf8mb4",
--    "loc":      "Local",
--    "prefix":   "",
--    "singular": false,
--  },
```

### 3. Check Config Module

If you are using the `Config` module, please check the following methods:

- `GetString`
- `GetInt`
- `GetBool`

Need to modify accordingly: [Modify Config Moudlue methods default value type](#modify-config-moudlue-methods-default-value-type)

### 4. If Using SQL Migrations

Need to modify accordingly: [Remove SQL Migration](#remove-sql-migration)

### 5. If Using Orm Module

Need to modify accordingly: [Optimize Orm module methods](#optimize-orm-module-methods)

### 6. If Using Path Method

Need to modify accordingly: [Optimize Path method](#optimize-path-method)

## Feature Introduction

### Split Database Driver

Before multiple database drivers were integrated in the framework, which increased the software package size. Starting from v1.16, the database driver will be a separate package, so you only need to install the database driver you need.

| Database Type | Driver Package |
| ------------- | -------------- |
| Postgres      | github.com/goravel/postgres |
| MySQL         | github.com/goravel/mysql |
| Sqlserver     | github.com/goravel/sqlserver |
| SQLite        | github.com/goravel/sqlite |

### Migration adds methods

Add the `Change` method to modify the table structure(Apply to Postgres, MySQL, MsSQL):

```go
table.String("name").Change()
```

Add the `RenameColumn` method, for renaming the table column:

```go
table.RenameColumn("old_name", "new_name")
```

Add the `Comment` method, for adding a comment to the table (Apply to Postgres, MySQL):

```go
table.Comment("user table")
```

Add the `First` method, for setting the field as the first field of the table (Apply to MySQL):

```go
table.String("name").First()
```

Add the `After` method, for setting the field as the last field of the table (Apply to MySQL):

```go
table.String("name").After("id")
```

### Grpc adds Shutdown method

Add the `Shutdown` method to gracefully shut down Grpc:

[View Document](../the-basics/grpc.md#shutdown-grpc)

### Artisan adds disable print colors option

Some commands print colors by default, such as the `list` command. However, in some terminals or logs, the color values may be garbled. You can use the `--no-ansi` option to disable the print colors:

```shell
go run . artisan list --no-ansi
```

### Encrypt and decrypt env file

You may want to add the production environment env file to version control, but you don't want to expose sensitive information, you can encrypt and decrypt the env file:

[View Document](../getting-started/installation.md#encrypt-and-decrypt-env-file)

### Remove SQL Migration

SQL migrations have been completely removed, please use Go language migrations. Migration steps:

1. Remove the `migrations.driver` key in `config/database.go`;
2. Convert the SQL migration files in the `database/migrations` directory to Go language migration files:

```go
// Up Run the migrations.
func (r *M20241207095921CreateUsersTable) Up() error {
    return facades.Schema().Sql({Original SQL})
}

// Down Reverse the migrations.
func (r *M20241207095921CreateUsersTable) Down() error {
    return facades.Schema().Sql({Original SQL})
}
```

3. Register the migration files in the `database/kernel.go` file;

### Optimize Config moudlue methods default value type

Before the `GetString`„ÄÅ`GetInt`„ÄÅ`GetBool` method of the `Config` module had a default value type of `any`, starting from v1.16, the default value type is `string`„ÄÅ`int`„ÄÅ`bool`, to ensure type safety.

```
-- GetString(path string, defaultValue ...any) string
++ GetString(path string, defaultValue ...string) string

-- GetInt(path string, defaultValue ...any) int
++ GetInt(path string, defaultValue ...int) int

-- GetBool(path string, defaultValue ...any) bool
++ GetBool(path string, defaultValue ...bool) bool
```

### Optimize Orm module methods

Optimize the return value of the `Count`, `Exists` method:

```go
-- Count(count *int64) error
++ Count() (int64, error)

-- Exists(exists *bool) error
++ Exists() (bool, error)
```

### Optimize Path method

Before the `path` method returned the relative path of the root directory, for example, `path.Config("app.go") == config/app.go`. Starting from v1.16, the `path` method returns the absolute path, for example, `path.Config("app.go") == /Users/goravel/workspace/goravel/config/app.go`.
