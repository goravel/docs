# ä» v1.13 å‡çº§åˆ° v1.14

### ä»¤äººå…´å¥‹çš„æ–°åŠŸèƒ½ ğŸ‰

- [æœ¬åœ°åŒ–](#æœ¬åœ°åŒ–)
- [å®‰è£…å™¨](#å®‰è£…å™¨)
- [Cookie](#cookie)
- [Session](#session)

### åŠŸèƒ½å¢å¼º ğŸš€

- [gin å’Œ fiber é©±åŠ¨æ”¯æŒè®¾ç½® body_limit å’Œ header_limit](#gin-å’Œ-fiber-é©±åŠ¨æ”¯æŒè®¾ç½®-body-limit-å’Œ-header-limit)
- [Log æ–°å¢æ–¹æ³•](#log-æ–°å¢æ–¹æ³•)
- [Orm æ–°å¢æ–¹æ³•](#orm-æ–°å¢æ–¹æ³•)
- [Console æ–°å¢æ–¹æ³•](#console-æ–°å¢æ–¹æ³•)
- [æ–°å¢ Build å‘½ä»¤](#æ–°å¢-build-å‘½ä»¤)
- [æ–°å¢ helper æ–¹æ³•](#æ–°å¢-helper-æ–¹æ³•)

### ç ´åæ€§å˜åŒ– ğŸ› 

- [Validation å¦‚æœéªŒè¯å¤±è´¥å°†ä¸ç»‘å®šæ•°æ®](#validation-å¦‚æœéªŒè¯å¤±è´¥å°†ä¸ç»‘å®šæ•°æ®)
- [Testing æ¨¡å—æ–°å¢ã€ä¿®æ”¹æ–¹æ³•](#testing-æ¨¡å—æ–°å¢-ä¿®æ”¹æ–¹æ³•)
- [ä¼˜åŒ– Mail æ¨¡å—çš„ Queue æ–¹æ³•](#ä¼˜åŒ–-mail-æ¨¡å—çš„-queue-æ–¹æ³•)
- [ä¼˜åŒ– Auth æ¨¡å— ctx çš„è®¾ç½®æ–¹æ³•](#ä¼˜åŒ–-auth-æ¨¡å—-ctx-çš„è®¾ç½®æ–¹æ³•)
- [ä¼˜åŒ– mock facades çš„æ–¹å¼](#ä¼˜åŒ–-mock-facades-çš„æ–¹å¼)
- [æ¡†æ¶ Orm model æ–°å¢ json tag](#æ¡†æ¶-orm-model-æ–°å¢-json-tag)

### Bug ä¿®å¤ ğŸ›

## å‡çº§æŒ‡å—

è¯·æ ¹æ®æœ¬èŠ‚å†…å®¹ï¼Œä¸€æ­¥æ­¥è¿›è¡Œæ¡†æ¶å‡çº§ã€‚

**é¢„è®¡å‡çº§æ—¶é—´ï¼š10 åˆ†é’Ÿ**

### 1. æ›´æ–°ä¾èµ–

`go.mod` ä¸­æ›´æ–°ä¾èµ–ï¼š

```
go get -u github.com/goravel/framework@v1.14.0

// å¦‚æœä½¿ç”¨ gin
go get -u github.com/goravel/gin@v1.2.0

// å¦‚æœä½¿ç”¨ fiber
go get -u github.com/goravel/fiber@v1.2.0

//å¦‚æœä½¿ç”¨å…¶ä»–åŒ…
// TODO
```

### 2. æ–°å¢é…ç½®é¡¹

1. `config/app.go` æ–°å¢æœ¬åœ°åŒ–æ¨¡å—é…ç½®é¡¹ï¼š

```
"locale": "en",
"fallback_locale": "en",
```

### 3. å¦‚æœæ­£åœ¨ä½¿ç”¨ Validation æ¨¡å—

æ£€æŸ¥æ˜¯å¦åœ¨æ ¡éªŒæ•°æ®å¤±è´¥çš„æƒ…å†µä¸‹ä¾ç„¶å°è¯•è¯»å–ç»‘å®šå€¼ï¼Œå¦‚æœæœ‰ï¼Œéœ€ä¼˜åŒ–é€»è¾‘ï¼Œå› ä¸ºè¯¥å€¼å‡çº§åä¸ºç©ºï¼Œè¯¦è§ï¼š[Validation å¦‚æœéªŒè¯å¤±è´¥å°†ä¸ç»‘å®šæ•°æ®](#validation-å¦‚æœéªŒè¯å¤±è´¥å°†ä¸ç»‘å®šæ•°æ®)

### 4. å¦‚æœæ­£åœ¨ä½¿ç”¨ Testing æ¨¡å—

æ£€æŸ¥æ˜¯å¦ä½¿ç”¨ `Clear`, `Image` æ–¹æ³•ï¼Œå¦‚æœæœ‰ï¼Œéœ€ç›¸åº”ä¿®æ”¹ï¼š[Testing æ¨¡å—æ–°å¢ã€ä¿®æ”¹æ–¹æ³•](#testing-æ¨¡å—æ–°å¢-ä¿®æ”¹æ–¹æ³•)

### 5. å¦‚æœæ­£åœ¨ä½¿ç”¨ Mail æ¨¡å—

æ£€æŸ¥æ˜¯å¦ä½¿ç”¨ `Queue` æ–¹æ³•ï¼Œå¦‚æœæœ‰ï¼Œéœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Mail æ¨¡å—çš„ Queue æ–¹æ³•](#ä¼˜åŒ–-mail-æ¨¡å—çš„-queue-æ–¹æ³•)

### 6. å¦‚æœæ­£åœ¨ä½¿ç”¨ Auth æ¨¡å—

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Auth æ¨¡å— ctx çš„è®¾ç½®æ–¹æ³•](#ä¼˜åŒ–-auth-æ¨¡å—-ctx-çš„è®¾ç½®æ–¹æ³•)

### 7. å¦‚æœæ­£åœ¨ä½¿ç”¨ mock facades

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– mock facades çš„æ–¹å¼](#ä¼˜åŒ–-mock-facades-çš„æ–¹å¼)

### 8. å¦‚æœæ­£åœ¨ä½¿ç”¨æ¡†æ¶ Orm model å¹¶ä¸”ç›´æ¥é€šè¿‡æ¥å£è¿”å›æ•°æ®

éœ€ç›¸åº”ä¿®æ”¹ï¼š[æ¡†æ¶ Orm model æ–°å¢ json tag](#æ¡†æ¶-orm-model-æ–°å¢-json-tag)

## åŠŸèƒ½ä»‹ç»

### æœ¬åœ°åŒ–

Version: v1.14.0

[æŸ¥çœ‹æ–‡æ¡£](../digging-deeper/localization.md)

### å®‰è£…å™¨

Version: v1.14.0

é€šè¿‡å®‰è£…å™¨ï¼Œä½ å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸‹è½½å¹¶åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Goravel é¡¹ç›®ã€‚

[æŸ¥çœ‹æ–‡æ¡£](http://github.com/goravel/installer)

### Cookie

Version: v1.14.0

[æŸ¥çœ‹ Request æ–‡æ¡£](../the-basics/request.md#cookie)
[æŸ¥çœ‹ Response æ–‡æ¡£](../the-basics/response.md#cookie)

### Session

Version: v1.14.0

[æŸ¥çœ‹æ–‡æ¡£](../the-basics/session.md)

### gin å’Œ fiber é©±åŠ¨æ”¯æŒè®¾ç½® body_limit å’Œ header_limit

Version: v1.14.0

HTTP é©±åŠ¨æ”¯æŒè®¾ç½® `body_limit` å’Œ `header_limit` ä»¥é™åˆ¶ `body`, `header` å¤§å°ï¼Œè¯¦è§ï¼š[goravel/gin](https://github.com/goravel/gin/blob/c9d7706a6a04c05c8c33af5c97877a1ad2ea6362/README.md?plain=1#L54) å’Œ [goravel/fiber](https://github.com/goravel/fiber/blob/aa63ab657cd2b371fcda4df0090a41226f6c0704/README.md?plain=1#L56)ã€‚

### Log æ–°å¢æ–¹æ³•

Version: v1.14.0

| æ–¹æ³• | è¯´æ˜ |
| --- | --- |
| `Stack` | åŒæ—¶ä½¿ç”¨å¤šä¸ªæ—¥å¿—é€šé“ |
| `Channel` | æŒ‡å®šæ—¥å¿—é€šé“ |
| `WithTrace` | æ‰“å°å †æ ˆä¿¡æ¯ |

[æŸ¥çœ‹æ–‡æ¡£](../logging/getting-started.md#æ–°å¢æ–¹æ³•)

### Orm æ–°å¢æ–¹æ³•

Version: v1.14.0

æ–°å¢ `WhereIn`, `OrWhereIn`, `OrWhereNotIn`, `WhereNotIn`, `WhereBetween`, `WhereNotBetween`, `WhereNull`, `OrWhereNull`, `OrderByDesc`, `OrderBy`, `InRandomOrder`, `Exists` æ–¹æ³•ã€‚

### Console æ–°å¢æ–¹æ³•

Version: v1.14.0

[æŸ¥çœ‹æ–‡æ¡£](../digging-deeper/artisan-console.md#äº¤äº’å¼è¾“å…¥)

### æ–°å¢ Build å‘½ä»¤

Version: v1.14.0

Goravel é¡¹ç›®å¯ä»¥ç›´æ¥é€šè¿‡ `go run . artisan build` å‘½ä»¤è¿›è¡Œç¼–è¯‘ã€‚

[æŸ¥çœ‹æ–‡æ¡£](../getting-started/compile.md#ç¼–è¯‘å‘½ä»¤)

### æ–°å¢ helper æ–¹æ³•

Version: v1.14.0

- [Str](../digging-deeper/str.md)
- [Map](../digging-deeper/helpers.md#maps)
- [Color](../digging-deeper/color.md)
- [Convert](../digging-deeper/helpers.md#convert)
- [Collection](../digging-deeper/helpers.md#collections)

### Validation å¦‚æœéªŒè¯å¤±è´¥å°†ä¸ç»‘å®šæ•°æ®

Version: v1.14.0

ä¹‹å‰åœ¨è°ƒç”¨ä¸‹é¢æ–¹å¼æ—¶ï¼Œå¦‚æœéªŒè¯å¤±è´¥ `userRequest` ä¾ç„¶ç»‘å®šäº†å€¼ï¼Œå‡çº§ååˆ™ä¸å†ç»‘å®šã€‚

```
var userRequest requests.UserRequest
errors, err := ctx.Request().ValidateRequest(&userRequest)

// or
validator, err := validation.Make(***)
err = validator.Bind(&userRequest)
```

### Testing æ¨¡å—æ–°å¢ã€ä¿®æ”¹æ–¹æ³•

Version: v1.14.0

1. æ–°å¢ [Fresh](../testing/getting-started.md#é‡ç½®æ•°æ®åº“) æ–¹æ³•ï¼›
2. ä¿®æ”¹ `Clear` æ–¹æ³•ä¸º [Stop](../testing/getting-started.md#å¸è½½é•œåƒ) æ–¹æ³•ï¼›
3. `Image` æ–¹æ³•æ–°å¢ `ExposedPorts` å‚æ•°ï¼Œåˆ é™¤ `Timeout` å‚æ•°ï¼›

```diff
database, err := facades.Testing().Docker().Database()
database.Image(testingcontract.Image{
  Repository: "mysql",
  Tag:        "5.7",
  Env: []string{
    "MYSQL_ROOT_PASSWORD=123123",
    "MYSQL_DATABASE=goravel",
  },
  -- Timeout: 1000,
  ++ ExposedPorts: []string{"3306"},
})
```

### ä¼˜åŒ– Mail æ¨¡å—çš„ Queue æ–¹æ³•

Version: v1.14.0

`Queue` æ–¹æ³•çš„å…¥å‚ç”± `queue *mail.Queue` æ”¹ä¸º `queue ...mail.Queue`ã€‚

```diff
-- facades.Mail().Queue(nil)
++ facades.Mail().Queue()

-- facades.Mail().Queue(&mail.Queue{})
++ facades.Mail().Queue(mail.Queue{})
```

### ä¼˜åŒ– Auth æ¨¡å— ctx çš„è®¾ç½®æ–¹æ³•

Version: v1.14.0

ä¹‹å‰è°ƒç”¨ `Parse`, `User`, `Login`, `LoginUsingID`, `Refresh`, `Logout` æ–¹æ³•æ—¶ï¼Œéœ€è¦ä¼ é€’ `ctx`ï¼Œå‡çº§åä¸å†éœ€è¦ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥è®¾ç½®åœ¨ `facades.Auth(ctx)`ã€‚

```diff
-- facades.Auth().Parse(ctx, token)
++ facades.Auth(ctx).Parse(token)

-- facades.Auth().User(ctx, &user)
++ facades.Auth(ctx).User(&user)

-- facades.Auth().Login(ctx, &user)
++ facades.Auth(ctx).Login(&user)

-- facades.Auth().LoginUsingID(ctx, id)
++ facades.Auth(ctx).LoginUsingID(id)

-- facades.Auth().Refresh(ctx)
++ facades.Auth(ctx).Refresh()

-- facades.Auth().Logout(ctx)
++ facades.Auth(ctx).Logout()
```

### ä¼˜åŒ– mock facades çš„æ–¹å¼

Version: v1.14.0

```diff
import github.com/goravel/framework/testing/mock

++ mockFactory := mock.Factory()

-- app := mock.App()
++ app := mockFactory.App()

-- artisan := mock.Artisan()
++ artisan := mockFactory.Artisan()

-- auth := mock.Auth()
++ auth := mockFactory.Auth()

-- artisan := mock.Artisan()
++ artisan := mockFactory.Artisan()

-- cache, driver, lock := mock.Cache()
++ cache := mockFactory.Cache()
++ driver := mockFactory.CacheDriver()
++ lock := mockFactory.CacheLock()

-- config := mock.Config()
++ config := mockFactory.Config()

-- crypt := mock.Crypt()
++ crypt := mockFactory.Crypt()

-- event, task := mock.Event()
++ event := mockFactory.Event()
++ event := mockFactory.EventTask()

-- gate := mock.Gate()
++ gate := mockFactory.Gate()

-- grpc := mock.Grpc()
++ grpc := mockFactory.Grpc()

-- hash := mock.Hash()
++ hash := mockFactory.Hash()

-- mock.Log()
++ mockFactory.Log()

-- mail := mock.Mail()
++ mail := mockFactory.Mail()

-- orm, query, transaction, association := mock.Orm()
++ orm := mockFactory.Orm()
++ query := mockFactory.OrmQuery()
++ transaction := mockFactory.OrmTransaction()
++ association := mockFactory.OrmAssociation()

-- queue, task := mock.Queue()
++ queue := mockFactory.Queue()
++ task := mockFactory.QueueTask()

-- rateLimiter := mock.RateLimiter()
++ rateLimiter := mockFactory.RateLimiter()

-- storage, driver, file := mock.Storage()
++ storage := mockFactory.Storage()
++ driver := mockFactory.StorageDriver()
++ file := mockFactory.StorageFile()

-- seeder := mock.Seeder()
++ seeder := mockFactory.Seeder()

-- validation, validator, errors := mock.Validation()
++ validation := mockFactory.Validation()
++ validator := mockFactory.ValidationValidator()
++ errors := mockFactory.ValidationErrors()

-- view := mock.View()
++ view := mockFactory.View()
```

### æ¡†æ¶ Orm model æ–°å¢ json tag

Version: v1.14.0

å¦‚æœä½¿ç”¨äº†æ¡†æ¶çš„ Orm model å¹¶ä¸”é€šè¿‡æ¥å£ç›´æ¥è¿”å›æ•°æ®ï¼Œéœ€è¦è‡ªå·±æ ¹æ®åŸ model ç»“æ„æ–°å»º model å¹¶æ›¿æ¢ï¼Œæˆ–è€…å‰ç«¯æ ¹æ® json tag ä¿®æ”¹å­—æ®µåç§°ã€‚

```diff
type Model struct {
	-- ID uint `gorm:"primaryKey"`
	++ ID uint `gorm:"primaryKey" json:"id"`
	Timestamps
}

type SoftDeletes struct {
	-- DeletedAt gorm.DeletedAt `gorm:"column:deleted_at"`
	++ DeletedAt gorm.DeletedAt `gorm:"column:deleted_at" json:"deleted_at"`
}

type Timestamps struct {
	-- CreatedAt carbon.DateTime `gorm:"autoCreateTime;column:created_at"`
	-- UpdatedAt carbon.DateTime `gorm:"autoUpdateTime;column:updated_at"`
	++ CreatedAt carbon.DateTime `gorm:"autoCreateTime;column:created_at" json:"created_at"`
	++ UpdatedAt carbon.DateTime `gorm:"autoUpdateTime;column:updated_at" json:"updated_at"`
}
```