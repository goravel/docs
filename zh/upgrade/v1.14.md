# ä» v1.13 å‡çº§åˆ° v1.14

### ä»¤äººå…´å¥‹çš„æ–°åŠŸèƒ½ ğŸ‰

- [æ•°æ®å¡«å……](#æ•°æ®å¡«å……)

### åŠŸèƒ½å¢å¼º ğŸš€

- [Validation è‡ªåŠ¨å°†è¯·æ±‚ä½“è½¬æ¢ä¸ºç›®æ ‡ç±»å‹](#validation-è‡ªåŠ¨å°†è¯·æ±‚ä½“è½¬æ¢ä¸ºç›®æ ‡ç±»å‹)

### ç ´åæ€§å˜åŒ– ğŸ› 

- [ç§»é™¤é»˜è®¤åŠ è½½çš„ HTTP å…¨å±€ä¸­é—´ä»¶](#_5-ç§»é™¤é»˜è®¤åŠ è½½çš„-http-å…¨å±€ä¸­é—´ä»¶)

### Bug ä¿®å¤ ğŸ›

- [ä¿®å¤ facades.Auth().User() çš„é—®é¢˜](#ä¿®å¤-facades-auth-user-çš„é—®é¢˜)

## å‡çº§æŒ‡å—

è¯·æ ¹æ®æœ¬èŠ‚å†…å®¹ï¼Œä¸€æ­¥æ­¥è¿›è¡Œæ¡†æ¶å‡çº§ã€‚

**é¢„è®¡å‡çº§æ—¶é—´ï¼š10 åˆ†é’Ÿ**

### 1. æ›´æ–°ä¾èµ–

`go.mod` ä¸­æ›´æ–°ä¾èµ–ï¼š

```
go get -u github.com/goravel/framework@v1.13.9 && go get -u github.com/goravel/gin
```

### 2. æ–°å¢æ–‡ä»¶

[tests](https://github.com/goravel/goravel/tree/v1.13.x/tests)

[database/seeders/database_seeder.go](https://github.com/goravel/goravel/tree/v1.13.x/database/seeders/database_seeder.go)

[app/providers/database_service_provider.go](https://github.com/goravel/goravel/tree/v1.13.x/app/providers/database_service_provider.go)

### 3. æ³¨å†Œæ–°çš„ Provider

æ³¨æ„é¡ºåºï¼š

```go
import (
  "github.com/goravel/framework/testing"
  "github.com/goravel/gin"
)

// config/app.go
"providers": []foundation.ServiceProvider{
  ...
  &validation.ServiceProvider{},
  // New
  &testing.ServiceProvider{}, 
  &providers.AppServiceProvider{},
  ...
  &providers.ValidationServiceProvider{},
  // New
  &providers.DatabaseServiceProvider{}, 
  // New
  &gin.ServiceProvider{}, 
}
```

### 4. æ–°å¢é…ç½®

ä¿®æ”¹ [config/http.go](https://github.com/goravel/goravel/tree/v1.13.x/config/http.go)

```go
import (
  "github.com/goravel/framework/contracts/route"
  "github.com/goravel/framework/facades"
  ginfacades "github.com/goravel/gin/facades"
)

config.Add("http", map[string]any{
  // HTTP Driver
  "default": "gin",
  // HTTP Drivers
  "drivers": map[string]any{
    "gin": map[string]any{
      "route": func() (route.Route, error) {
        return ginfacades.Route("gin"), nil
      },
    },
  },
  ...
}
```

ä¿®æ”¹ [config/cors.go](https://github.com/goravel/goravel/tree/v1.13.x/config/cors.go)

```go
config.Add("cors", map[string]any{
  ...
  // New
  "paths":                []string{"*"}, 
  "allowed_methods":      []string{"*"},
  ...
}
```

### 5. ç§»é™¤é»˜è®¤åŠ è½½çš„ HTTP å…¨å±€ä¸­é—´ä»¶

1. `tls` ä¸ `cors` ä¸­é—´ä»¶å·²é›†æˆè‡³é»˜è®¤ HTTP é©±åŠ¨ä¸­ï¼Œå› æ­¤ `app/http/kernel.go` æ–‡ä»¶ä¸­çš„ `middleware.Cors()` ä¸ `middleware.Tls()` éœ€è¢«ç§»é™¤ã€‚

2. `app/providers/route_service_provider.go` æ–‡ä»¶ä¸­ `facades.Route().GlobalMiddleware(http.Kernel{}.Middleware()...)` æ–¹æ³•ä» `Register` ç§»åŠ¨è‡³ `Boot`:

```go
package providers

...

type RouteServiceProvider struct {
}

func (receiver *RouteServiceProvider) Register(app foundation.Application) {
}

func (receiver *RouteServiceProvider) Boot(app foundation.Application) {
  //Add HTTP middleware
  facades.Route().GlobalMiddleware(http.Kernel{}.Middleware()...)

  receiver.configureRateLimiting()

  routes.Web()
}

func (receiver *RouteServiceProvider) configureRateLimiting() {

}
```

### 6. ä¼˜åŒ– Controller è¿”å›

`Controller` å¢åŠ è¿”å›å€¼ `http.Response`ï¼Œ`ctx.Response()` å¯ç›´æ¥è¿”å›ï¼Œä¸éœ€è¦å†å•ç‹¬ `return`ï¼Œä½¿é€»è¾‘æ›´åŠ æµç•…ï¼š

```go
// Before
func (r *UserController) Show(ctx http.Context) {
  ctx.Response().Success().Json(http.Json{
    "Hello": "Goravel",
  })
  return
}

// After
func (r *UserController) Show(ctx http.Context) http.Response {
  return ctx.Response().Success().Json(http.Json{
    "Hello": "Goravel",
  })
}
```

### 7. ä¿®æ”¹ facades.Route() ä¸­ Group æ–¹æ³•çš„å…¥å‚

`route.Route` ä¿®æ”¹ä¸º `route.Router`ï¼š

```go
// Before
facades.Route().Group(func(route route.Route)

// After
facades.Route().Group(func(route route.Router)
```

### 8. ä¿®æ”¹ facades.Cache() ä¸­ Remember ä¸ RememberForever æ–¹æ³•ï¼ˆå¦‚æœç”¨åˆ°ï¼‰

`callback` ç±»å‹ç”± `func() any` ä¿®æ”¹ä¸º `func() (any, error)`ï¼š

```go
// Before
Remember(key string, ttl time.Duration, callback func() any) (any, error)
RememberForever(key string, callback func() any) (any, error)

// After
Remember(key string, ttl time.Duration, callback func() (any, error)) (any, error)
RememberForever(key string, callback func() (any, error)) (any, error)
```

### 9. ä¿®æ”¹ access.NewAllowResponse ä¸ access.NewDenyResponse åŒ…åï¼ˆå¦‚æœç”¨åˆ°ï¼‰

ç”± `/contracts/auth/access` ä¿®æ”¹ä¸º `/auth/access`:

```go
// Before
import "github.com/goravel/framework/contracts/auth/access"

access.NewAllowResponse()
access.NewDenyResponse()

// After
import "github.com/goravel/framework/auth/access"

access.NewAllowResponse()
access.NewDenyResponse()
```

### 10. ç§»é™¤åºŸå¼ƒæ–¹æ³•ï¼ˆå¦‚æœç”¨åˆ°ï¼‰

1. ç§»é™¤ `ctx.Request().Form()` å’Œ `ctx.Request().Json()` æ–¹æ³•ï¼Œä½¿ç”¨ `ctx.Request().Input()` æ–¹æ³•æ›¿ä»£ï¼›

2. ç§»é™¤ `Log` è‡ªå®šä¹‰é©±åŠ¨çš„ `GetLevel`, `GetTime`, `GetMessage` æ–¹æ³•ï¼Œä½¿ç”¨ `Level`, `Time`, `Message` æ–¹æ³•æ›¿ä»£ï¼›

3. ç§»é™¤ `gorm.New` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºç›´æ¥è·å– `gorm` å®ä¾‹ï¼Œå·²ä¸æ¨èä½¿ç”¨ï¼Œå¦‚æœ‰å¿…è¦ï¼Œè¯·ä½¿ç”¨ `gorm.NewGormImpl` æ–¹æ³•æ›¿ä»£ï¼›

## åŠŸèƒ½ä»‹ç»

### Validation è‡ªåŠ¨å°†è¯·æ±‚ä½“è½¬æ¢ä¸ºç›®æ ‡ç±»å‹

Version: v1.14.0

