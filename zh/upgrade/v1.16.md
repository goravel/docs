# ä» v1.15 å‡çº§åˆ° v1.16

### ä»¤äººå…´å¥‹çš„æ–°åŠŸèƒ½ ğŸ‰

- [æ–°å¢ facades.DB()](#æ–°å¢-facades-db)
- [æ–°å¢ facades.Http()](#æ–°å¢-facades-http)
- [é‡æ„ facades.Queue()](#é‡æ„-facades-queue)
- [facades.Auth() æ”¯æŒè‡ªå®šä¹‰é©±åŠ¨](#facades-auth-æ”¯æŒè‡ªå®šä¹‰é©±åŠ¨)
- [make:* å‘½ä»¤ç”Ÿæˆçš„æ–‡ä»¶æ”¯æŒè‡ªåŠ¨æ³¨å†Œ](#make-å‘½ä»¤ç”Ÿæˆçš„æ–‡ä»¶æ”¯æŒè‡ªåŠ¨æ³¨å†Œ)
- [Goravel Installer æ”¯æŒé€‰æ‹©é©±åŠ¨](#goravel-installer-æ”¯æŒé€‰æ‹©é©±åŠ¨)

### åŠŸèƒ½å¢å¼º ğŸš€

- [æ‹†åˆ†æ•°æ®åº“é©±åŠ¨](#æ‹†åˆ†æ•°æ®åº“é©±åŠ¨)
- [Orm æ–°å¢ç‰¹æ€§](#orm-æ–°å¢ç‰¹æ€§)
- [æ”¯æŒæ ¹æ®æ•°æ®è¡¨åˆ›å»º Model](#æ”¯æŒæ ¹æ®æ•°æ®è¡¨åˆ›å»º-model)
- [æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€è·å– SQL è¯­å¥](#æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€è·å–-sql-è¯­å¥)
- [Migration æ–°å¢ç‰¹æ€§](#migration-æ–°å¢ç‰¹æ€§)
- [Grpc æ–°å¢ Shutdown æ–¹æ³•](#grpc-æ–°å¢-shutdown-æ–¹æ³•)
- [Artisan æ–°å¢ç¦ç”¨æ‰“å°é¢œè‰²é€‰é¡¹](#artisan-æ–°å¢ç¦ç”¨æ‰“å°é¢œè‰²é€‰é¡¹)
- [åŠ è§£å¯† env æ–‡ä»¶](#åŠ è§£å¯†-env-æ–‡ä»¶)
- [å‘é€é‚®ä»¶æ”¯æŒè®¾ç½® Header](#å‘é€é‚®ä»¶æ”¯æŒè®¾ç½®-header)
- [Installer æ”¯æŒè‡ªå‡çº§](#installer-æ”¯æŒè‡ªå‡çº§)
- [å¤šè¯­è¨€æ–‡ä»¶æ”¯æŒ embed åŠ è½½](#å¤šè¯­è¨€æ–‡ä»¶æ”¯æŒ-embed-åŠ è½½)
- [å®šæ—¶ä»»åŠ¡æ”¯æŒè®¾ç½®ç§’çº§ä»»åŠ¡](#å®šæ—¶ä»»åŠ¡æ”¯æŒè®¾ç½®ç§’çº§ä»»åŠ¡)
- [Request æ–°å¢ç‰¹æ€§](#request-æ–°å¢ç‰¹æ€§)
- [Route æ–°å¢ç‰¹æ€§](#route-æ–°å¢ç‰¹æ€§)
- [Testing æ”¯æŒåˆ›å»º Cache é•œåƒ](#testing-æ”¯æŒåˆ›å»º-cache-é•œåƒ)
- [ä¸åŒ JWT Guard æ”¯æŒè®¾ç½®ä¸åŒçš„ secert ä¸ ttl](#ä¸åŒ-jwt-guard-æ”¯æŒè®¾ç½®ä¸åŒçš„-ttl-ä¸-secert)
- [æ³¨å†Œ ServiceProvider ä¸å†ä¾èµ–é¡ºåº](#æ³¨å†Œ-serviceprovider-ä¸å†ä¾èµ–é¡ºåº)

### ç ´åæ€§å˜åŒ– ğŸ› 

- [ç§»é™¤ SQL è¿ç§»](#ç§»é™¤-sql-è¿ç§»)
- [ä¼˜åŒ– Config æ¨¡å—æ–¹æ³•é»˜è®¤å€¼ç±»å‹](#ä¼˜åŒ–-config-æ¨¡å—æ–¹æ³•é»˜è®¤å€¼ç±»å‹)
- [ä¼˜åŒ– Orm æ–¹æ³•](#ä¼˜åŒ–-orm-æ–¹æ³•)
- [ä¼˜åŒ– Path æ–¹æ³•](#ä¼˜åŒ–-path-æ–¹æ³•)
- [ä¼˜åŒ– Request æ–¹æ³•](#ä¼˜åŒ–-request-æ–¹æ³•)
- [ä¼˜åŒ– console Confirm æ–¹æ³•](#ä¼˜åŒ–-console-confirm-æ–¹æ³•)
- [ä¼˜åŒ– Session è‡ªå®šä¹‰é©±åŠ¨æ–¹å¼](#ä¼˜åŒ–-session-è‡ªå®šä¹‰é©±åŠ¨æ–¹å¼)
- [ä¼˜åŒ– Testing.Request æ–¹æ³•](#ä¼˜åŒ–-testing-request-æ–¹æ³•)
- [ä¼˜åŒ– Carbon æ–¹æ³•](#ä¼˜åŒ–-carbon-æ–¹æ³•)

## å‡çº§æŒ‡å—

éšç€ [Golang v1.22 ä¸å†è¢«ç»´æŠ¤](https://endoflife.date/go)ï¼ŒGoravel v1.16 é»˜è®¤æ”¯æŒ Golang ç‰ˆæœ¬ç”± 1.22 å‡çº§ä¸º 1.23ã€‚

goravel/example é¡¹ç›®ç”± v1.15 å‡çº§åˆ° v1.16 PR å¯ä»¥ä½œä¸ºå‡çº§å‚è€ƒï¼š[goravel/example#68](https://github.com/goravel/example/pull/68)

### 1. æ›´æ–°ä¾èµ–

```shell
go get github.com/goravel/framework@master

// å¦‚æœä½¿ç”¨ gin
go get github.com/goravel/gin@master

// å¦‚æœä½¿ç”¨ fiber
go get github.com/goravel/fiber@master

// å¦‚æœä½¿ç”¨ redis
go get github.com/goravel/redis@master

// å¦‚æœä½¿ç”¨ S3
go get github.com/goravel/s3@master

// å¦‚æœä½¿ç”¨ Oss
go get github.com/goravel/oss@master

// å¦‚æœä½¿ç”¨ Cos
go get github.com/goravel/cos@master

// å¦‚æœä½¿ç”¨ Minio
go get github.com/goravel/minio@master

// å¦‚æœä½¿ç”¨ Cloudinary
go get github.com/goravel/cloudinary@master

go mod tidy
```

### 2. ä¿®æ”¹æ•°æ®åº“é…ç½®

åˆ é™¤æ•°æ®åº“é…ç½®æ–‡ä»¶ `config/database.go` ä¸­è‡ªå·±ç”¨ä¸åˆ°çš„ `connections`ï¼Œå®‰è£…è‡ªå·±éœ€è¦çš„æ•°æ®åº“é©±åŠ¨ã€‚

ä»¥ Postgres ä¸ºä¾‹ï¼š

1. å®‰è£…é©±åŠ¨åŒ…

```shell
go get github.com/goravel/postgres
```

2. æ·»åŠ  `postgres.ServiceProvider` åˆ° `config/app.go` æ–‡ä»¶

```go
// config/app.go
import "github.com/goravel/postgres"

"providers": []foundation.ServiceProvider{
  ...
  &postgres.ServiceProvider{},
},
```

3. ä¿®æ”¹ `config/database.go` æ–‡ä»¶ä¸­çš„é…ç½®

```go
// config/database.go
import (
	"github.com/goravel/framework/contracts/database/driver"
	postgresfacades "github.com/goravel/postgres/facades"
)

"connections": map[string]any{
  "postgres": map[string]any{
    ...
++    "via": func() (driver.Driver, error) {
++      return postgresfacades.Postgres("postgres")
++    },
  },
},
```

### 3. ä¿®æ”¹ auth.go é…ç½®æ–‡ä»¶

```go
// config/auth.go

// Supported: "jwt"
"guards": map[string]any{
  "user": map[string]any{
    "driver":   "jwt",
++    "provider": "user",
  },
},

++ // Supported: "orm"
++ "providers": map[string]any{
++   "user": map[string]any{
++     "driver": "orm",
++   },
++ },
```

### 4. ä¿®æ”¹ session.go é…ç½®æ–‡ä»¶

```go
// config/session.go

-- "driver": config.Env("SESSION_DRIVER", "file"),
++ "default": config.Env("SESSION_DRIVER", "file"),
++ "drivers": map[string]any{
++   "file": map[string]any{
++     "driver": "file",
++   },
++ },
```

### 5. ä¿®æ”¹ queue.go é…ç½®æ–‡ä»¶

- å¦‚æœæ­£åœ¨ä½¿ç”¨ Queue æ¨¡å—çš„ Redis é©±åŠ¨ï¼Œéœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Queue é…ç½®](#ä¼˜åŒ–-queue-é…ç½®)ã€‚

- å¦‚æœæ²¡æœ‰ä½¿ç”¨æˆ–æƒ³è¦ä»¥åä½¿ç”¨ database é©±åŠ¨ï¼Œéœ€è¦ä¿®æ”¹ `config/queue.go` æ–‡ä»¶ä¸­çš„é…ç½®ï¼š

```go
// config/queue.go

-- // Drivers: "sync", "redis"
++ // Drivers: "sync", "database", "custom"
"connections": map[string]any{
  "sync": map[string]any{
    "driver": "sync",
  },
--  "redis": map[string]any{
--    "driver":     "redis",
--    "connection": "default",
--    "queue":      config.Env("REDIS_QUEUE", "default"),
--  },
++  "database": map[string]any{
++    "driver":     "database",
++    "connection": "postgres",
++    "queue":      "default",
++    "concurrent": 1,
++  },
},

++ "failed": map[string]any{
++  "database": config.Env("DB_CONNECTION", "postgres"),
++  "table":    "failed_jobs",
++ },
```

æ·»åŠ  database é©±åŠ¨éœ€è¦çš„è¿ç§»æ–‡ä»¶ï¼š [database/migrations/20210101000002_create_jobs_table.go](https://github.com/goravel/goravel/blob/master/database/migrations/20210101000002_create_jobs_table.go)ï¼Œå¹¶åœ¨ `database/kernel.go` æ–‡ä»¶ä¸­æ³¨å†Œè¯¥è¿ç§»æ–‡ä»¶ã€‚

### 6. å¦‚æœéœ€è¦ä½¿ç”¨ HTTP Client

`config/http.go` æ–‡ä»¶ä¸­æ–°å¢ HTTP Client é…ç½®é¡¹:

```go
// config/http.go
++ "client": map[string]any{
++   "base_url":                config.GetString("HTTP_CLIENT_BASE_URL"),
++   "timeout":                 config.GetDuration("HTTP_CLIENT_TIMEOUT"),
++   "max_idle_conns":          config.GetInt("HTTP_CLIENT_MAX_IDLE_CONNS"),
++   "max_idle_conns_per_host": config.GetInt("HTTP_CLIENT_MAX_IDLE_CONNS_PER_HOST"),
++   "max_conns_per_host":      config.GetInt("HTTP_CLIENT_MAX_CONN_PER_HOST"),
++   "idle_conn_timeout":       config.GetDuration("HTTP_CLIENT_IDLE_CONN_TIMEOUT"),
++ },
```

### 7. å¦‚æœæ­£åœ¨ä½¿ç”¨ goravel/redis é©±åŠ¨

éœ€ä¿®æ”¹ `config/cache.go` æ–‡ä»¶ä¸­çš„é…ç½®ï¼š

```go
// config/cache.go
"redis": map[string]any{
  "driver":     "custom",
  "connection": "default",
  "via": func() (cache.Driver, error) {
--  return redisfacades.Redis("redis"), nil
++  return redisfacades.Cache("redis")
  },
},
```

### 8. å¦‚æœæ­£åœ¨ä½¿ç”¨ carbon.DateTime ç­‰æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Carbon æ–¹æ³•](#ä¼˜åŒ–-carbon-æ–¹æ³•)

### 9. å¦‚æœæ­£åœ¨ä½¿ç”¨ session è‡ªå®šä¹‰é©±åŠ¨

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Session è‡ªå®šä¹‰é©±åŠ¨æ–¹å¼](#ä¼˜åŒ–-session-è‡ªå®šä¹‰é©±åŠ¨æ–¹å¼)

### 10. å¦‚æœæ­£åœ¨ä½¿ç”¨ facades.Config() ä¸­çš„æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Config æ¨¡å—æ–¹æ³•é»˜è®¤å€¼ç±»å‹](#ä¼˜åŒ–-config-æ¨¡å—æ–¹æ³•é»˜è®¤å€¼ç±»å‹)

### 11. å¦‚æœæ­£åœ¨ä½¿ç”¨ SQL æ•°æ®è¿ç§»

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ç§»é™¤ SQL è¿ç§»](#ç§»é™¤-sql-è¿ç§»)

### 12. å¦‚æœæ­£åœ¨ä½¿ç”¨ Orm

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Orm æ–¹æ³•](#ä¼˜åŒ–-orm-æ–¹æ³•)

### 13. å¦‚æœæ­£åœ¨ä½¿ç”¨ Path æ–¹æ³•

Path æ–¹æ³•ç”±åŸæ¥è¿”å›ç›¸å¯¹è·¯å¾„æ”¹ä¸ºè¿”å›ç»å¯¹è·¯å¾„ï¼Œå¦‚æœæ­£åœ¨ä½¿ç”¨éœ€æ£€æŸ¥æ˜¯å¦éœ€è¦ä¿®æ”¹ï¼š[ä¼˜åŒ– Path æ–¹æ³•](#ä¼˜åŒ–-path-æ–¹æ³•)

### 14. å¦‚æœ æ­£åœ¨ä½¿ç”¨ `ctx.Request().InputMap` æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Request æ–¹æ³•](#ä¼˜åŒ–-request-æ–¹æ³•)

### 15. å¦‚æœæ­£åœ¨ä½¿ç”¨ `console.Confirm` æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– console Confirm æ–¹æ³•](#ä¼˜åŒ–-console-confirm-æ–¹æ³•)

### 16. å¦‚æœæ­£åœ¨ä½¿ç”¨ Testing.Request æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Testing.Request æ–¹æ³•](#ä¼˜åŒ–-testing-request-æ–¹æ³•)

## åŠŸèƒ½ä»‹ç»

### æ–°å¢ facades.DB()

æ–°å¢ `facades.DB()` æ¨¡å—ï¼Œæ–¹ä¾¿è¿›è¡Œæ•°æ®åº“çš„åŸç”Ÿæ“ä½œï¼Œæ¯” ORM é€Ÿåº¦æ›´å¿«ã€‚

[æŸ¥çœ‹æ–‡æ¡£](../database/getting-started.md)

### æ–°å¢ facades.Http()

æ–°å¢ä¸€ä¸ªå†…ç½®çš„ HTTP å®¢æˆ·ç«¯ `facades.Http()`ï¼Œè®© API è°ƒç”¨å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚

[æŸ¥çœ‹æ–‡æ¡£](../digging-deeper/http-client.md)

### é‡æ„ facades.Queue()

1. v1.15 ä¹‹å‰ Queue ä»…æ”¯æŒåŒæ­¥é©±åŠ¨ä¸ Redis é©±åŠ¨ï¼Œä» v1.16 å¼€å§‹æ”¯æŒæ•°æ®åº“é©±åŠ¨åŠè‡ªå®šä¹‰é©±åŠ¨ã€‚
2. æ–°å¢ `jobs` å’Œ `failed_jobs` è¡¨ï¼Œç”¨äºå­˜å‚¨ä»»åŠ¡åŠå¤±è´¥ä»»åŠ¡ã€‚
3. æ–°å¢ `queue:retry` å‘½ä»¤ï¼Œç”¨äºé‡è¯•å¤±è´¥çš„ä»»åŠ¡ã€‚
4. æ–°å¢ `queue:failed` å‘½ä»¤ï¼Œç”¨äºæŸ¥çœ‹å¤±è´¥ä»»åŠ¡ã€‚
5. æ”¯æŒåœ¨å¯åŠ¨é˜Ÿåˆ—ä»»åŠ¡æ—¶è®¾ç½®é‡è¯•æ¬¡æ•°ã€‚

è¯¦æƒ…è¯· [æŸ¥çœ‹æ–‡æ¡£](../digging-deeper/queues.md)

### facades.Auth() æ”¯æŒè‡ªå®šä¹‰é©±åŠ¨

v1.15 ä¹‹å‰ Auth ä»…æ”¯æŒ JWT é©±åŠ¨ï¼Œä» v1.16 å¼€å§‹æ”¯æŒ Session åŠè‡ªå®šä¹‰é©±åŠ¨ï¼Œè¯¦æƒ…è¯· [æŸ¥çœ‹æ–‡æ¡£](../security/authentication.md#è‡ªå®šä¹‰é©±åŠ¨)ã€‚

### make:* å‘½ä»¤ç”Ÿæˆçš„æ–‡ä»¶æ”¯æŒè‡ªåŠ¨æ³¨å†Œ

`make:migration`ã€ `make:seeder` ç­‰å‘½ä»¤ç”Ÿæˆçš„æ–‡ä»¶ï¼Œåœ¨ç”Ÿæˆåä¼šè‡ªåŠ¨æ³¨å†Œåˆ°æ¡†æ¶ä¸­ï¼Œæ— éœ€åƒä¹‹å‰ä¸€æ ·éœ€è¦æ‰‹åŠ¨æ³¨å†Œã€‚

### Goravel Installer æ”¯æŒé€‰æ‹©é©±åŠ¨

ä½¿ç”¨ Goravel Installer å®‰è£…æ–°é¡¹ç›®çš„è¿‡ç¨‹ä¸­å¯ä»¥é€‰æ‹©å®‰è£…ä¸åŒçš„é©±åŠ¨ï¼Œä¾‹å¦‚ï¼šå¯ä»¥é€‰æ‹©å®‰è£… goravel/gin æˆ– goravel/fiber ç­‰ã€‚

### æ‹†åˆ†æ•°æ®åº“é©±åŠ¨

ä¹‹å‰å¤šä¸ªæ•°æ®åº“é©±åŠ¨åŒæ—¶é›†æˆåœ¨æ¡†æ¶ä¸­ï¼Œä½¿å¾—è½¯ä»¶æ‰“åŒ…ä½“ç§¯å˜å¤§ï¼Œä» v1.16 å¼€å§‹ï¼Œæ•°æ®åº“é©±åŠ¨å°†ä½œä¸ºç‹¬ç«‹åŒ…å­˜åœ¨ï¼Œåªéœ€å®‰è£…è‡ªå·±éœ€è¦çš„æ•°æ®åº“é©±åŠ¨å³å¯ã€‚

| æ•°æ®åº“ç±»å‹ | é©±åŠ¨åŒ… |
| ---------- | ------ |
| Postgres   | [github.com/goravel/postgres](https://github.com/goravel/postgres) |
| MySQL      | [github.com/goravel/mysql](https://github.com/goravel/mysql) |
| Sqlserver  | [github.com/goravel/sqlserver](https://github.com/goravel/sqlserver) |
| SQLite     | [github.com/goravel/sqlite](https://github.com/goravel/sqlite) |

### Orm æ–°å¢ç‰¹æ€§

- æ”¯æŒæŸ¥æ‰¾ JSON å­—æ®µï¼Œ[æŸ¥çœ‹æ–‡æ¡£](../orm/getting-started.md#where-æ¡ä»¶)ã€‚

- æ”¯æŒæ›´æ–° JSON å­—æ®µï¼Œ[æŸ¥çœ‹æ–‡æ¡£](../orm/getting-started.md#æ›´æ–°-json-å­—æ®µ)ã€‚

- Model ä¸­æ”¯æŒè®¾ç½® `GlobalScope` æ–¹æ³•ï¼Œåœ¨æŸ¥æ‰¾ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œæ—¶é™åˆ¶ä½œç”¨åŸŸï¼š

```go
import (
  contractsorm"github.com/goravel/framework/contracts/database/orm"
  "github.com/goravel/framework/database/orm"
)

type User struct {
  orm.Model
  Name string
}

func (r *User) GlobalScopes() []func(contractsorm.Query) contractsorm.Query {
  return []func(contractsorm.Query) contractsorm.Query{
    func(query contractsorm.Query) contractsorm.Query {
      return query.Where("name", "goravel")
    },
  }
}
```

### æ”¯æŒæ ¹æ®æ•°æ®è¡¨åˆ›å»º Model

`make:model` å‘½ä»¤æ–°å¢ `--table` é€‰é¡¹ï¼Œç”¨äºæ ¹æ®æ•°æ®è¡¨åˆ›å»º Modelï¼š

```shell
./artisan make:model --table=users User

// å¦‚æœ Model å·²å­˜åœ¨å¯ä»¥ä½¿ç”¨ -f é€‰é¡¹å¼ºåˆ¶è¦†ç›–
./artisan make:model --table=users -f User
```

### æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€è·å– SQL è¯­å¥

æ–°å¢ `EnableQueryLog` ç­‰æ–¹æ³•ï¼Œç”¨äºåœ¨è¿è¡Œæ—¶åŠ¨æ€è·å– SQL è¯­å¥ï¼š

```go
ctx := db.EnableQueryLog(ctx)

facades.Orm().WithContext(ctx).Query().Find()

queryLogs := db.GetQueryLog(ctx)
ctx := db.DisableQueryLog(ctx)
```

### Migration æ–°å¢ç‰¹æ€§

- æ–°å¢ `Change` æ–¹æ³•ï¼ˆé€‚ç”¨äº Postgres, MySQL, Sqlserverï¼‰ï¼Œç”¨äºä¿®æ”¹è¡¨ç»“æ„ï¼š

```go
table.String("name").Change()
```

- æ–°å¢ `RenameColumn` æ–¹æ³•ï¼Œç”¨äºé‡å‘½åè¡¨åˆ—ï¼š

```go
table.RenameColumn("old_name", "new_name")
```

- æ–°å¢ `Comment` æ–¹æ³•ï¼Œç”¨äºä¸ºè¡¨æ·»åŠ æ³¨é‡Šï¼ˆé€‚ç”¨äº Postgres, MySQLï¼‰ï¼š

```go
table.Comment("user table")
```

- æ–°å¢ `First` æ–¹æ³•ï¼Œç”¨äºå°†å­—æ®µè®¾ç½®ä¸ºè¡¨çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼ˆé€‚ç”¨äº MySQLï¼‰ï¼š

```go
table.String("name").First()
```

- æ–°å¢ `After` æ–¹æ³•ï¼Œç”¨äºå°†å­—æ®µè®¾ç½®ä¸ºè¡¨çš„æœ€åä¸€ä¸ªå­—æ®µï¼ˆé€‚ç”¨äº MySQLï¼‰ï¼š

```go
table.String("name").After("id")
```

- æ–°å¢ `Morphs`, `NullableMorphs`, `NumericMorphs`, `UuidMorphs`, `UlidMorphs` æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºå¤šæ€å…³è”å­—æ®µï¼š

```go
table.Morphs("morphable")
// morphable_type, morphable_id
```

- æ–°å¢ `Uuid`, `Ulid` æ–¹æ³•ï¼Œç”¨äºåˆ›å»º UUID å’Œ ULID å­—æ®µï¼š

```go
table.Uuid("uuid")
table.Ulid("ulid")
```

### Grpc æ–°å¢ Shutdown æ–¹æ³•

æ–°å¢ `Shutdown` æ–¹æ³•ä»¥ä¾¿ä¼˜é›…çš„å…³é—­ Grpcï¼Œ[æŸ¥çœ‹æ–‡æ¡£](../the-basics/grpc.md#å…³é—­grpc)ã€‚

### Artisan æ–°å¢ç¦ç”¨æ‰“å°é¢œè‰²é€‰é¡¹

æœ‰äº›å‘½ä»¤é»˜è®¤ä¼šæ‰“å°é¢œè‰²ï¼Œä¾‹å¦‚ `list` å‘½ä»¤ï¼Œä½†åœ¨æŸäº›ç»ˆç«¯æˆ–æ—¥å¿—ä¸­é¢œè‰²å€¼ä¼šæ˜¯ä¹±ç ï¼Œè¿™æ—¶ä½ å¯ä»¥ä½¿ç”¨ `--no-ansi` é€‰é¡¹ç¦ç”¨æ‰“å°é¢œè‰²ï¼š

```shell
go run . artisan list --no-ansi
```

### åŠ è§£å¯† env æ–‡ä»¶

ä½ ä¹Ÿè®¸æƒ³å°†ç”Ÿäº§ç¯å¢ƒçš„ env æ–‡ä»¶æ·»åŠ åˆ°ç‰ˆæœ¬æ§åˆ¶ä¸­ï¼Œä½†åˆä¸æƒ³å°†æ•æ„Ÿä¿¡æ¯æš´éœ²å‡ºæ¥ï¼Œè¿™æ—¶ä½ å¯ä»¥åŠ è§£å¯† env æ–‡ä»¶ã€‚

[æŸ¥çœ‹æ–‡æ¡£](../getting-started/installation.md#åŠ è§£å¯†-env-æ–‡ä»¶)

### å‘é€é‚®ä»¶æ”¯æŒè®¾ç½® Header

æ–°å¢ `Headers` æ–¹æ³•ï¼Œç”¨äºè®¾ç½®é‚®ä»¶çš„ Headerã€‚

```go
facades.Mail().Headers(map[string]string{"X-Mailer": "Goravel"})
```

### Installer æ”¯æŒè‡ªå‡çº§

goravel/installer æ–°å¢ `upgrade` å‘½ä»¤ï¼Œç”¨äº installer çš„è‡ªèº«å‡çº§ï¼š

```shell
goravel upgrade
goravel upgrade v1.1.1
```

### å¤šè¯­è¨€æ–‡ä»¶æ”¯æŒ embed åŠ è½½

ä½¿ç”¨ embed åŠ è½½æ—¶ï¼Œå¤šè¯­è¨€æ–‡ä»¶å°†ä¼šè¢«ç¼–è¯‘åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œéƒ¨ç½²æ—¶ä¸å†éœ€è¦å¤šè¯­è¨€æ–‡ä»¶ã€‚

[æŸ¥çœ‹æ–‡æ¡£](../digging-deeper/localization.md#embed-åŠ è½½)

### å®šæ—¶ä»»åŠ¡æ”¯æŒè®¾ç½®ç§’çº§ä»»åŠ¡

æ–°å¢ `EverySecond` ç­‰æ–¹æ³•ï¼Œè¯¦ç»†è¯· [æŸ¥çœ‹æ–‡æ¡£](../digging-deeper/task-scheduling.md#è°ƒåº¦é¢‘ç‡é€‰é¡¹)ã€‚

### Request æ–°å¢ç‰¹æ€§

- v1.15 ä¹‹å‰ä¸‹é¢ `Request` ç»‘å®šå°†æŠ¥é”™ï¼Œä» v1.16 å¼€å§‹æ”¯æŒç»‘å®šå¤šä¸ªæ–‡ä»¶ï¼š

```go
type StoreMediaRequest struct {
	Files []*multipart.FileHeader `form:"files" json:"files"`
}
```

- æ–°å¢ `OriginalPath` æ–¹æ³•ï¼Œç”¨äºè·å–åŸå§‹è·¯ç”±è·¯å¾„ï¼š

```go
ctx.Request().OriginPath()
```

- å½“è®¾ç½® `http.request_timeout` é…ç½®é¡¹ ä¸º `0` æ—¶ï¼Œè¯·æ±‚å°†ä¸ä¼šè¶…æ—¶ã€‚

### Route æ–°å¢ç‰¹æ€§

- æ–°å¢ `GetRoutes` æ–¹æ³•ï¼Œç”¨äºè·å–æ‰€æœ‰è·¯ç”±ï¼š

```go
routes := facades.Route().GetRoutes()
```

- æ–°å¢ `Name` æ–¹æ³•ï¼Œç”¨äºè®¾ç½®è·¯ç”±åç§°ï¼š

```go
facades.Route().Get("users", usersController.Index).Name("users.index")
```

ç„¶åå¯ä»¥ä½¿ç”¨ `Info` æ–¹æ³•è·å–è·¯ç”±ä¿¡æ¯ï¼š

```go
route := facades.Route().Info("users.index")
```

- æ–°å¢ `route:list` å‘½ä»¤ï¼Œç”¨äºæŸ¥çœ‹æ‰€æœ‰è·¯ç”±ï¼š

```shell
./artisan route:list
```

### Testing æ”¯æŒåˆ›å»º Cache é•œåƒ

æ–°å¢ `Cache` æ–¹æ³•ï¼Œç”¨äºåˆ›å»º Cache é•œåƒï¼š

```go
cache, err := facades.Testing().Docker().Cache()
```

è¯¦ç»†è¯· [æŸ¥çœ‹æ–‡æ¡£](../testing/getting-started.md#ä½¿ç”¨-docker)ã€‚

### ä¸åŒ JWT Guard æ”¯æŒè®¾ç½®ä¸åŒçš„ ttl ä¸ secert

ä¹‹å‰ JWT Guard çš„ `ttl` ä¸ `secret` é…ç½®é¡¹æ˜¯å…¨å±€é…ç½®ï¼Œä» v1.16 å¼€å§‹ï¼Œä½ å¯ä»¥ä¸ºä¸åŒçš„ JWT Guard è®¾ç½®ä¸åŒçš„ `ttl` ä¸ `secret`ï¼Œ[æŸ¥çœ‹æ–‡æ¡£](../security/authentication.md#ä¸åŒ-jwt-guard-æ”¯æŒä¸åŒé…ç½®)ã€‚

### æ³¨å†Œ ServiceProvider ä¸å†ä¾èµ–é¡ºåº

ServiceProvider æ–°å¢å¯é€‰æ–¹æ³• `Relationship() binding.Relationship`ï¼Œç”¨æ¥å£°æ˜å½“å‰ ServicerProvider çš„ä¾èµ–å…³ç³»ï¼Œè®¾ç½®äº†è¯¥æ–¹æ³•çš„ ServiceProvider å°†ä¸ä¾èµ–æ³¨å†Œé¡ºåºï¼Œæœªè®¾ç½®çš„ ServiceProvider å°†è¢«æœ€åæ³¨å†Œï¼Œä¾‹å¦‚ï¼š

```go
type ServiceProvider struct {
}

func (r *ServiceProvider) Relationship() binding.Relationship {
	return binding.Relationship{
		Bindings: []string{
			BindingSession,
		},
		Dependencies: []string{
			binding.Config,
		},
		ProvideFor: []string{
			binding.Cache,
		},
	}
}

func (r *ServiceProvider) Register(app foundation.Application) {}

func (r *ServiceProvider) Boot(app foundation.Application) {}
```

### ç§»é™¤ SQL è¿ç§»

SQL è¿ç§»è¢«å®Œå…¨ç§»é™¤ï¼Œè¯·ä½¿ç”¨ Go è¯­è¨€è¿ç§»ã€‚è¿ç§»æ­¥éª¤ï¼š

1. ç§»é™¤ `config/database.go` ä¸­çš„ `migrations.driver` é”®ï¼›

```go
// config/database.go
"migrations": map[string]any{
--   "driver": "sql",
  "table":  "migrations",
},
```

2. å°† `database/migrations` ç›®å½•ä¸‹çš„ SQL è¿ç§»æ–‡ä»¶è½¬æ¢ä¸º Go è¯­è¨€è¿ç§»æ–‡ä»¶ï¼š

```go
// Up Run the migrations.
func (r *M20241207095921CreateUsersTable) Up() error {
  return facades.Schema().Sql({Original SQL})
}

// Down Reverse the migrations.
func (r *M20241207095921CreateUsersTable) Down() error {
  return facades.Schema().Sql({Original SQL})
}
```

3. åœ¨ `database/kernel.go` æ–‡ä»¶ä¸­æ³¨å†Œè¿ç§»æ–‡ä»¶ï¼›

### ä¼˜åŒ– Config æ¨¡å—æ–¹æ³•é»˜è®¤å€¼ç±»å‹

ä¹‹å‰ `GetString`ã€`GetInt`ã€`GetBool` æ–¹æ³•çš„é»˜è®¤å€¼ç±»å‹ä¸º `any`ï¼Œä» v1.16 å¼€å§‹ï¼Œé»˜è®¤å€¼ç±»å‹ä¸º `string`ã€`int`ã€`bool`ï¼Œä»¥ä¿è¯ç±»å‹å®‰å…¨ã€‚

```go
-- GetString(path string, defaultValue ...any) string
++ GetString(path string, defaultValue ...string) string

-- GetInt(path string, defaultValue ...any) int
++ GetInt(path string, defaultValue ...int) int

-- GetBool(path string, defaultValue ...any) bool
++ GetBool(path string, defaultValue ...bool) bool
```

### ä¼˜åŒ– Orm æ–¹æ³•

- ä¼˜åŒ– `Count`, `Distinct`, `Select`, `Exists`, `Sum` æ–¹æ³•ï¼š

```go
-- Count(count *int64) error
++ Count() (int64, error)

-- Distinct(args ...any) Query
++ Distinct(columns ...string) Query

-- Exists(exists *bool) error
++ Exists() (bool, error)

-- Select(query any, args ...any) Query
++ Select(columns ...string) Query

-- Sum(column string, dest any) error
++ Sum(column string) (int64, error)
```

- `Where` æ–¹æ³•æ”¯æŒé—­åŒ…ï¼š

```go
facades.Orm().Query().Where(func(query orm.Query) orm.Query {
  return query.Where("height", 180).Where("age", 18)
}).FindOrFail(&user, 100)
// SELECT * FROM users WHERE id = 100 AND (height = 180 AND age = 18);
```

### ä¼˜åŒ– Path æ–¹æ³•

- path æ–¹æ³•è¿”å›ç»å¯¹è·¯å¾„

ä¹‹å‰ path æ–¹æ³•è¿”å›çš„æ˜¯ç›¸å¯¹äºæ ¹ç›®å½•çš„è·¯å¾„ï¼Œä¾‹å¦‚ `path.Config("app.go") == config/app.go`ï¼Œä» v1.16 å¼€å§‹ï¼Œpath æ–¹æ³•è¿”å›çš„æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¾‹å¦‚ `path.Config("app.go") == /Users/goravel/workspace/goravel/config/app.go`ï¼›

- æ–°å¢ `Resource` æ–¹æ³•

```go
path.Resource("views/welcome.tmpl")
```

### ä¼˜åŒ– Request æ–¹æ³•

- ä¿®æ”¹ `InputMap` æ–¹æ³•é»˜è®¤å€¼ç±»å‹ï¼š

```go
-- ctx.Request().InputMap(key string, defaultValue ...map[string]string) map[string]string
++ ctx.Request().InputMap(key string, defaultValue ...map[string]any) map[string]any
```

- æ–°å¢ `InputMapArray` æ–¹æ³•ï¼Œç”¨äºè·å–æ•°ç»„ç±»å‹çš„ Mapï¼š

```go
ctx.Request().InputMapArray(key string, defaultValue ...[]map[string]any) []map[string]any
```

- æ–°å¢ `Files` æ–¹æ³•ï¼Œç”¨äºè·å–å¤šä¸ªæ–‡ä»¶ï¼š

```go
ctx.Request().Files(name string) ([]filesystem.File, error)
```

### ä¼˜åŒ– console Confirm æ–¹æ³•

ä¿®æ”¹ `Confirm` æ–¹æ³•çš„è¿”å›å€¼ï¼Œç®€åŒ–åˆ¤æ–­é€»è¾‘ï¼š

```go
-- Confirm(question string, option ...ConfirmOption) (bool, error)
++ Confirm(question string, option ...ConfirmOption) bool
```

### ä¼˜åŒ– Session è‡ªå®šä¹‰é©±åŠ¨æ–¹å¼

ä¹‹å‰ï¼Œä½ éœ€è¦é€šè¿‡ `facades.Session().Extend` æ–¹æ³•æ³¨å†Œé©±åŠ¨ï¼Œä» v1.16 å¼€å§‹ï¼Œä½ åªéœ€è¦å°†å…¶æ·»åŠ åˆ° `config/session.go` é…ç½®æ–‡ä»¶ä¸­å³å¯ï¼š

```go
// app/providers/app_service_provider.go
-- facades.Session().Extend("redis", func() session.Driver {
--   return &RedisDriver{}
-- })

// config/session.go
"drivers": map[string]any{
  "redis": map[string]any{
    "driver": "custom",
    "via": func() (session.Driver, error) {
      return &RedisDriver{}, nil
    },
  }
},
```

[æŸ¥çœ‹æ–‡æ¡£](../the-basics/session.md#æ·»åŠ è‡ªå®šä¹‰ä¼šè¯é©±åŠ¨)

### ä¼˜åŒ– Testing.Request æ–¹æ³•

ä¼˜åŒ– `WithCookies` å’Œ `WithCookie` æ–¹æ³•çš„å…¥å‚ï¼š

```go
-- WithCookies(cookies map[string]string) Request
++ WithCookies(cookies []*http.Cookie) Request

-- WithCookie(key, value string) Request
++ WithCookie(cookie *http.Cookie) Request
```

### ä¼˜åŒ– Carbon æ–¹æ³•

`carbon.NewDateTime` ç­‰æ–¹æ³•åŸæ¥è¿”å›çš„æ˜¯ struct å®ä¾‹ï¼Œv1.16 å¼€å§‹è¿”å›æŒ‡é’ˆï¼Œå¦‚æœä½ å®šä¹‰äº† `carbon.DateTime` ç­‰ç±»å‹ï¼Œéœ€è¦ä¿®æ”¹ä¸º `*carbon.DateTime` ç­‰æŒ‡é’ˆç±»å‹ã€‚

### ä¼˜åŒ– Queue é…ç½®

v1.15 ä¹‹å‰ï¼ŒQueue æ¨¡å—çš„ Redis é©±åŠ¨ä½¿ç”¨ [RichardKnop/machinery](https://github.com/RichardKnop/machinery) å®ç°ã€‚ä» v1.16 å¼€å§‹ï¼ŒRedis é©±åŠ¨åœ¨ [goravel/redis](https://github.com/goravel/redis) ä¸­æä¾›å®˜æ–¹æ”¯æŒã€‚

ä½ ä¾ç„¶å¯ä»¥åœ¨ v1.16 ä¸­ä½¿ç”¨ Machinery é©±åŠ¨ï¼Œä½†å…¶å°†åœ¨ v1.17 ä¸­è¢«ç§»é™¤ï¼Œå»ºè®®ä½¿ç”¨ Redis é©±åŠ¨ã€‚ä¸‹é¢æä¾›ä¸¤ç§å‡çº§æ–¹å¼ï¼š

#### ç»§ç»­ä½¿ç”¨ Machinery é©±åŠ¨

ä¿®æ”¹ `config/queue.go` æ–‡ä»¶ä¸­çš„é…ç½®ï¼š

```go
// config/queue.go
"connections": map[string]any{
...
  "redis": map[string]any{
--    "driver":     "redis",
++    "driver":     "machinery",
    "connection": "default",
    "queue":      config.Env("REDIS_QUEUE", "default"),
  },
},
```

#### ä½¿ç”¨ Redis é˜Ÿåˆ—é©±åŠ¨

ä¿®æ”¹ `config/queue.go` æ–‡ä»¶ä¸­çš„é…ç½®ï¼š

```go
// config/queue.go
import (
  "github.com/goravel/framework/contracts/queue"
  redisfacades "github.com/goravel/redis/facades"
)

"connections": map[string]any{
...
  "redis": map[string]any{
--  "driver":     "redis",
++  "driver":     "custom",
    "connection": "default",
    "queue":      config.Env("REDIS_QUEUE", "default"),
++  "via": func() (queue.Driver, error) {
++    return redisfacades.Queue("redis") // The ` + "`redis`" + ` value is the key of ` + "`connections`" + `
++  },
  },
},
```

æ–°çš„ Redis é˜Ÿåˆ—é©±åŠ¨ä¸åŸ machinery é˜Ÿåˆ—é©±åŠ¨çš„ä»»åŠ¡éƒ½ä¿å­˜åœ¨åŒä¸€ä¸ª Redis ä¸­ï¼Œä½†ä½¿ç”¨ä¸åŒçš„é˜Ÿåˆ—åç§°ã€‚å³ä½¿ä½ åˆ‡æ¢ä¸ºæ–°çš„ Redis é˜Ÿåˆ—é©±åŠ¨ï¼Œæ¡†æ¶ä¼šç»§ç»­è¯»å–åŸ Machinery é˜Ÿåˆ—é©±åŠ¨çš„ä»»åŠ¡ï¼Œç›´åˆ° Machinery ä¸­æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚ä¸æ­¤åŒæ—¶ï¼Œæ–°çš„é˜Ÿåˆ—ä»»åŠ¡ä¸å†å†™å…¥ Machinery é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å†™å…¥æ–°çš„ Redis é˜Ÿåˆ—ï¼Œå¹¶è¢«æ–°çš„ Redis é˜Ÿåˆ—é©±åŠ¨æ¶ˆè´¹ã€‚ä»¥å®ç°ä¸¤ä¸ªé©±åŠ¨é—´çš„æ— ç¼åˆ‡æ¢ã€‚

ä½ å¯ä»¥åˆ° Redis ä¸­æŸ¥çœ‹ä¸¤ä¸ªé©±åŠ¨çš„æ•°æ®æ˜¯å¦è¢«æ­£ç¡®å†™å…¥ä¸æ¶ˆè´¹ï¼š

```shell
redis-cli

# è·å– Redis ä¸­æ‰€æœ‰çš„é”®
keys

# æŸ¥çœ‹ Machinery é˜Ÿåˆ—é©±åŠ¨æ•°æ®ï¼ˆæ›¿æ¢ {} ä¸­çš„å€¼ï¼‰
LRANGE {app_name}_queues:{queue_name} 0 -1

# æŸ¥çœ‹ Redis é˜Ÿåˆ—é©±åŠ¨æ•°æ®ï¼ˆæ›¿æ¢ {} ä¸­çš„å€¼ï¼‰
LRANGE {app_name}_queues:{connection}_{queue} 0 -1
```
