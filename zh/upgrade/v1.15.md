# ä» v1.14 å‡çº§åˆ° v1.15

### ä»¤äººå…´å¥‹çš„æ–°åŠŸèƒ½ ğŸ‰

### åŠŸèƒ½å¢å¼º ğŸš€

- [Request æ”¯æŒè®¾ç½® Filter](#request-æ”¯æŒè®¾ç½®-filter)
- [Request å¢åŠ  BindQuery æ–¹æ³•](#request-å¢åŠ -bindquery-æ–¹æ³•)
- [æ”¯æŒæ§åˆ¶ Schedule æ—¥å¿—è¾“å‡º](#æ”¯æŒæ§åˆ¶-schedule-æ—¥å¿—è¾“å‡º)
- [Mail æ”¯æŒ Mailable æ¨¡ç‰ˆ](#mail-æ”¯æŒ-mailable-æ¨¡ç‰ˆ)
- [HTTP æ”¯æŒè¿”å› Stream](#http-æ”¯æŒè¿”å›-stream)
- [Auth æ–°å¢ Id æ–¹æ³•](#auth-æ–°å¢-id-æ–¹æ³•)
- [Validation æ”¯æŒ Regex è§„åˆ™](#validation-æ”¯æŒ-regex-è§„åˆ™)
- [Orm çš„ Create æ–¹æ³•æ”¯æŒä½¿ç”¨ map åˆ›å»º](#orm-çš„-create-æ–¹æ³•æ”¯æŒä½¿ç”¨-map-åˆ›å»º)
- [Schedule æ–°å¢ Stop æ–¹æ³•](#schedule-æ–°å¢-stop-æ–¹æ³•)

### ç ´åæ€§å˜åŒ– ğŸ› 

- [ä¼˜åŒ– Queue æ¨¡å—çš„ Worker æ–¹æ³•](#ä¼˜åŒ–-queue-æ¨¡å—çš„-worker-æ–¹æ³•)
- [Postgresql é©±åŠ¨åç§°æ›´æ”¹ä¸º Postgres](#postgresql-é©±åŠ¨åç§°æ›´æ”¹ä¸º-postgres)
- [ä¿®æ”¹ Orm.Transaction æ–¹æ³•å›è°ƒå‚æ•°ç±»å‹](#ä¿®æ”¹-orm-transaction-æ–¹æ³•å›è°ƒå‚æ•°ç±»å‹)
- [ä¼˜åŒ– Orm çš„ Delete ä¸ ForceDelete æ–¹æ³•](#ä¼˜åŒ–-orm-çš„-delete-ä¸-forcedelete-æ–¹æ³•)
- [Route çš„ Shutdown æ–¹æ³•é‡å‘½åä¸º Stop](#route-çš„-shutdown-æ–¹æ³•é‡å‘½åä¸º-stop)
- [ä¼˜åŒ– Cache çš„ Decrement ä¸ Increment æ–¹æ³•](#ä¼˜åŒ–-cache-çš„-decrement-ä¸-increment-æ–¹æ³•)
- [ä¼˜åŒ– Artisan çš„ Call æ–¹æ³•](#ä¼˜åŒ–-artisan-çš„-call-æ–¹æ³•)
- [Route åºŸå¼ƒ Shutdown æ–¹æ³•](#route-åºŸå¼ƒ-shutdown-æ–¹æ³•)

## å‡çº§æŒ‡å—

**é¢„è®¡å‡çº§æ—¶é—´ï¼š10 åˆ†é’Ÿ**

éšç€ [Golang v1.21 ä¸å†è¢«ç»´æŠ¤](https://endoflife.date/go)ï¼ŒGoravel v1.15 é»˜è®¤æ”¯æŒ Golang ç‰ˆæœ¬ç”± 1.21 å‡çº§ä¸º 1.22ï¼Œè¯·åœ¨ go.mod æ–‡ä»¶ä¸­æ›´æ–°ç‰ˆæœ¬ã€‚

### 1. æ›´æ–°ä¾èµ–

```
go get -u github.com/goravel/framework@v1.15.0

// å¦‚æœä½¿ç”¨ gin
go get -u github.com/goravel/gin@v1.3.0

// å¦‚æœä½¿ç”¨ fiber
go get -u github.com/goravel/fiber@v1.3.0
```

### 2. ä¸º Request æ–°å¢ Filters æ–¹æ³•

è¿›å…¥ `app/http/requests` ç›®å½•ï¼Œä¸ºæ‰€æœ‰çš„ Request æ–°å¢ `Filters` æ–¹æ³•ã€‚

```go
// ä¿®æ”¹ `r *StorePostRequest` ä¸ºè‡ªå·±çš„å€¼
func (r *StorePostRequest) Filters(ctx http.Context) map[string]string {
	return map[string]string{}
}
```

### 3. å¦‚æœæ­£åœ¨ä½¿ç”¨ Mail æ¨¡å—

ä¿®æ”¹ `Subject` çš„è®¾ç½®æ–¹å¼ï¼š

```go
-- import "github.com/goravel/framework/contracts/mail"
++ import "github.com/goravel/framework/mail"

-- Content(mail.Content{Subject: "Subject", Html: "<h1>Hello Goravel</h1>"})
++ Content(mail.Html("<h1>Hello Goravel</h1>")).Subject("Subject")
```

å¦‚æœä½¿ç”¨äº† `From` æ–¹æ³•ï¼š

```go
-- import "github.com/goravel/framework/contracts/mail"
++ import "github.com/goravel/framework/mail"

-- From(mail.From{Address: testFromAddress, Name: testFromName}
++ From(mail.Address(testFromAddress, testFromName)
```

å¦‚æœä½¿ç”¨äº† `Queue` æ–¹æ³•ï¼š

```go
-- import "github.com/goravel/framework/contracts/mail"
++ import "github.com/goravel/framework/mail"

-- Queue(mail.Queue{Connection: "high", Queue: "mail"})
++ Queue(mail.Queue().Connection("high").Queue("mail"))
```

### 4. å¦‚æœæ­£åœ¨ä½¿ç”¨ Queue æ¨¡å—çš„ Worker æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Queue æ¨¡å—çš„ Worker æ–¹æ³•](#ä¼˜åŒ–-queue-æ¨¡å—çš„-worker-æ–¹æ³•)

### 5. å¦‚æœæ­£åœ¨ä½¿ç”¨ Postgres æ•°æ®åº“

éœ€ç›¸åº”ä¿®æ”¹ï¼š[Postgresql é©±åŠ¨åç§°æ›´æ”¹ä¸º Postgres](#postgresql-é©±åŠ¨åç§°æ›´æ”¹ä¸º-postgres)

### 6. å¦‚æœæ­£åœ¨ä½¿ç”¨ Orm.Transaction æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¿®æ”¹ Orm.Transaction æ–¹æ³•å›è°ƒå‚æ•°ç±»å‹](#ä¿®æ”¹-orm-transaction-æ–¹æ³•å›è°ƒå‚æ•°ç±»å‹)

### 7. å¦‚æœæ­£åœ¨ä½¿ç”¨ Orm çš„ Delete æˆ– ForceDelete æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Orm çš„ Delete ä¸ ForceDelete æ–¹æ³•](#ä¼˜åŒ–-orm-çš„-delete-ä¸-forcedelete-æ–¹æ³•)

### 8. å¦‚æœæ­£åœ¨ä½¿ç”¨ Route çš„ Shutdown æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[Route çš„ Shutdown æ–¹æ³•é‡å‘½åä¸º Stop](#route-çš„-shutdown-æ–¹æ³•é‡å‘½åä¸º-stop)

### 9. å¦‚æœæ­£åœ¨ä½¿ç”¨ Cache çš„ Decrement æˆ– Increment æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Cache çš„ Decrement ä¸ Increment æ–¹æ³•](#ä¼˜åŒ–-cache-çš„-decrement-ä¸-increment-æ–¹æ³•)

### 10. å¦‚æœæ­£åœ¨ä½¿ç”¨ Artisan çš„ Call æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Artisan çš„ Call æ–¹æ³•](#ä¼˜åŒ–-artisan-çš„-call-æ–¹æ³•)

### 11. å¦‚æœæ­£åœ¨ä½¿ç”¨ Route çš„ Shutdown æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[Route åºŸå¼ƒ Shutdown æ–¹æ³•](#route-åºŸå¼ƒ-shutdown-æ–¹æ³•)

## åŠŸèƒ½ä»‹ç»

### Request æ”¯æŒè®¾ç½® Filter

Version: v1.15.0

[æŸ¥çœ‹æ–‡æ¡£](../the-basics/validation.md#è¿‡æ»¤è¾“å…¥æ•°æ®)

### Request å¢åŠ  BindQuery æ–¹æ³•

Version: v1.15.0

æ”¯æŒä½¿ç”¨ `ctx.Request().BindQuery()` ç›´æ¥ç»‘å®šé“¾æ¥ä¸­çš„å‚æ•°ã€‚

[æŸ¥çœ‹æ–‡æ¡£](../the-basics/request.md#ç»‘å®š-query)

### æ”¯æŒæ§åˆ¶ Schedule æ—¥å¿—è¾“å‡º

Version: v1.15.0

å½“ `app.debug` ä¸º `false` æ—¶ï¼Œå°†åªè¾“å‡º `error` çº§åˆ«æ—¥å¿—ã€‚

### Mail æ”¯æŒ Mailable æ¨¡ç‰ˆ

Version: v1.15.0

[æŸ¥çœ‹æ–‡æ¡£](../digging-deeper/mail.md#ä½¿ç”¨-mailable)

### HTTP æ”¯æŒè¿”å› Stream

Version: v1.15.0

[æŸ¥çœ‹æ–‡æ¡£](../the-basics/response.md#è¿”å›-stream)

### Auth æ–°å¢ Id æ–¹æ³•

Version: v1.15.0

```go
id, err := facades.Auth(ctx).Id()
```

### Validation æ”¯æŒ Regex è§„åˆ™

Version: v1.15.0

```go
validator, err := ctx.Request().Validate(map[string]string{
  "code": "required|regex:\d{4,6}",
})
```

### Orm çš„ Create æ–¹æ³•æ”¯æŒä½¿ç”¨ map åˆ›å»º

Version: v1.15.0

[æŸ¥çœ‹æ–‡æ¡£](../orm/getting-started.md#åˆ›å»º)

### Schedule æ–°å¢ Stop æ–¹æ³•

Version: v1.15.0

[æŸ¥çœ‹æ–‡æ¡£](../digging-deeper/task-scheduling.md#å…³é—­è°ƒåº¦ç¨‹åº)

### ä¼˜åŒ– Queue æ¨¡å—çš„ Worker æ–¹æ³•

Version: v1.15.0

å½“ `Worker` æ–¹æ³•ä¸éœ€è¦è®¾ç½®å‚æ•°æ—¶ï¼Œå¯ä»¥ä¿æŒä¸ºç©ºï¼š

```go
-- facades.Queue().Worker(nil).Run()
++ facades.Queue().Worker().Run()
```

å½“éœ€è¦è®¾ç½®å‚æ•°æ—¶ï¼Œå‚æ•°ç”±æŒ‡é’ˆæ”¹ä¸ºå®ä¾‹ï¼š

```go
-- facades.Queue().Worker(&queue.Args{Connection: "redis").Run()
++ facades.Queue().Worker(queue.Args{Connection: "redis").Run()
```

### Postgresql é©±åŠ¨åç§°æ›´æ”¹ä¸º Postgres

Version: v1.15.0

Postgresql é©±åŠ¨çš„åç§°å·²æ›´æ”¹ä¸º `postgres`ï¼Œå¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ Postgresql é©±åŠ¨ç¨‹åºï¼Œåˆ™éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š

```go
// config/database.go
"postgres": map[string]any{
  -- "driver":   "postgresql",
  ++ "driver":   "postgres",
  "host":     config.Env("DB_HOST", "127.0.0.1"),
}
```

### ä¿®æ”¹ Orm.Transaction æ–¹æ³•å›è°ƒå‚æ•°ç±»å‹

Version: v1.15.0

`facades.Orm().Transaction()` æ–¹æ³•çš„å›è°ƒå‚æ•°ç±»å‹ç”± `func(tx orm.Transaction) error` æ”¹ä¸º `func(tx orm.Query) error`ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œè¯·ç›¸åº”ä¿®æ”¹ã€‚

```go
-- facades.Orm().Transaction(func(tx orm.Transaction) error {
++ facades.Orm().Transaction(func(tx orm.Query) error {
  var user models.User

  return tx.Find(&user, user.ID)
})
```

### ä¼˜åŒ– Orm çš„ Delete ä¸ ForceDelete æ–¹æ³•

Version: v1.15.0

å¦‚æœä½ æ­£åœ¨å‘ `Delete` æˆ– `ForceDelete` æ–¹æ³•ä¼ å…¥ ID åˆ é™¤æ•°æ®ï¼Œè¯·æ”¹ä¸ºä½¿ç”¨ `Where` æ–¹æ³•ï¼š

```go
-- facades.Orm().Query().Delete(&models.User{}, 10)
++ facades.Orm().Query().Where("id", 10).Delete(&models.User{})

-- facades.Orm().Query().Delete(&models.User{}, []uint{1, 2, 3})
++ facades.Orm().Query().WhereIn("id", []uint{1, 2, 3}).Delete(&models.User{})

-- facades.Orm().Query().ForceDelete(&models.User{}, 10)
++ facades.Orm().Query().ForceDelete("id", 10).Delete(&models.User{})
```

`Delete` å’Œ `ForceDelete` æ–¹æ³•æ”¯æŒä¸ä¼ å…¥å‚æ•°åˆ é™¤æ•°æ®ï¼š

```go
res, err := facades.Orm().Query().Model(&models.User{}).Where("id", 1).Delete()
res, err := facades.Orm().Query().Table("users").Where("id", 1).Delete()
```

### Route çš„ Shutdown æ–¹æ³•é‡å‘½åä¸º Stop

Version: v1.15.0

ä¸ºäº†ä¿æŒ Stop æ–¹æ³•åç§°ä¸å…¶ä»–æ¨¡å—ä¸€è‡´ï¼Œæˆ‘ä»¬å°† `Shutdown` æ–¹æ³•é‡å‘½åä¸º `Stop`ã€‚

```go
-- facades.Route().Shutdown()
++ facades.Route().Stop()
```

### ä¼˜åŒ– Cache çš„ Decrement ä¸ Increment æ–¹æ³•

Version: v1.15.0

`Decrement` å’Œ `Increment` æ–¹æ³•çš„å…¥å‚ä¸å‡ºå‚ç±»å‹ç”± `int` ä¿®æ”¹ä¸º `int64`ï¼š

```go
-- Decrement(key string, value ...int) (int, error)
++ Decrement(key string, value ...int64) (int64, error)

-- Increment(key string, value ...int) (int, error)
++ Increment(key string, value ...int64) (int64, error)
```

### ä¼˜åŒ– Artisan çš„ Call æ–¹æ³•

Version: v1.15.0

ä¹‹å‰ `facades.Artisan().Call()` æ–¹æ³•æ‰§è¡Œæ—¶é‡åˆ°é”™è¯¯å°†ä¼šç›´æ¥ panicï¼Œç°åœ¨å°†è¿”å›é”™è¯¯ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œè¯·å¤„ç†è¯¥é”™è¯¯è¿”å›ã€‚

```go
err := facades.Artisan().Call("command:name")
```

### Route åºŸå¼ƒ Shutdown æ–¹æ³•

Version: v1.15.0

`Shutdown` æ–¹æ³•å·²åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ `Stop` æ–¹æ³•ä»£æ›¿ã€‚

```go
-- facades.Route().Shutdown()
++ facades.Route().Stop()
```
