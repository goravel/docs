# ä» v1.14 å‡çº§åˆ° v1.15

### ä»¤äººå…´å¥‹çš„æ–°åŠŸèƒ½ ğŸ‰

- [Migration æ”¯æŒä½¿ç”¨ Go è¯­è¨€è¿ç§»](#migration-æ”¯æŒä½¿ç”¨-go-è¯­è¨€è¿ç§»)
- [Testing æ”¯æŒ HTTP æµ‹è¯•](#testing-æ”¯æŒ-http-æµ‹è¯•)

### åŠŸèƒ½å¢å¼º ğŸš€

- [Request æ”¯æŒè®¾ç½® Filter](#request-æ”¯æŒè®¾ç½®-filter)
- [Request å¢åŠ  BindQuery æ–¹æ³•](#request-å¢åŠ -bindquery-æ–¹æ³•)
- [æ”¯æŒæ§åˆ¶ Schedule æ—¥å¿—è¾“å‡º](#æ”¯æŒæ§åˆ¶-schedule-æ—¥å¿—è¾“å‡º)
- [Mail æ”¯æŒ Mailable æ¨¡ç‰ˆ](#mail-æ”¯æŒ-mailable-æ¨¡ç‰ˆ)
- [HTTP æ”¯æŒè¿”å› Stream](#http-æ”¯æŒè¿”å›-stream)
- [Auth æ–°å¢ ID æ–¹æ³•](#auth-æ–°å¢-id-æ–¹æ³•)
- [Validation æ”¯æŒ Regex è§„åˆ™](#validation-æ”¯æŒ-regex-è§„åˆ™)
- [Orm çš„ Create æ–¹æ³•æ”¯æŒä½¿ç”¨ map åˆ›å»º](#orm-çš„-create-æ–¹æ³•æ”¯æŒä½¿ç”¨-map-åˆ›å»º)
- [Schedule æ–°å¢ Stop æ–¹æ³•](#schedule-æ–°å¢-stop-æ–¹æ³•)
- [HTTP æ”¯æŒè®¾ç½®è¶…æ—¶æ—¶é—´](#http-æ”¯æŒè®¾ç½®è¶…æ—¶æ—¶é—´)
- [é”™è¯¯æ—¥å¿—è¾“å‡ºçš„ trace æ”¯æŒç‚¹å‡»è·³è½¬](#é”™è¯¯æ—¥å¿—è¾“å‡ºçš„-trace-æ”¯æŒç‚¹å‡»è·³è½¬)
- [å¤šä¸ª Auth.Guard å¯ä»¥è®¾ç½®è‡ªå·±çš„ TTL](#å¤šä¸ª-authguard-å¯ä»¥è®¾ç½®è‡ªå·±çš„-ttl)
- [Log æ”¯æŒæ‰“å° Context ä¸­çš„é”®å€¼](#log-æ”¯æŒæ‰“å°-context-ä¸­çš„é”®å€¼)
- [æ”¯æŒç›´æ¥è®¾ç½® DSN è¿æ¥æ•°æ®åº“](#æ”¯æŒç›´æ¥è®¾ç½®-dsn-è¿æ¥æ•°æ®åº“)

### ç ´åæ€§å˜åŒ– ğŸ› 

- [ä¼˜åŒ– Queue æ¨¡å—çš„ Worker æ–¹æ³•](#ä¼˜åŒ–-queue-æ¨¡å—çš„-worker-æ–¹æ³•)
- [Postgresql é©±åŠ¨åç§°æ›´æ”¹ä¸º Postgres](#postgresql-é©±åŠ¨åç§°æ›´æ”¹ä¸º-postgres)
- [ä¿®æ”¹ Orm.Transaction æ–¹æ³•å›è°ƒå‚æ•°ç±»å‹](#ä¿®æ”¹-orm-transaction-æ–¹æ³•å›è°ƒå‚æ•°ç±»å‹)
- [ä¼˜åŒ– Orm çš„ Delete ä¸ ForceDelete æ–¹æ³•](#ä¼˜åŒ–-orm-çš„-delete-ä¸-forcedelete-æ–¹æ³•)
- [Route çš„ Shutdown æ–¹æ³•é‡å‘½åä¸º Stop](#route-çš„-shutdown-æ–¹æ³•é‡å‘½åä¸º-stop)
- [ä¼˜åŒ– Cache çš„ Decrement ä¸ Increment æ–¹æ³•](#ä¼˜åŒ–-cache-çš„-decrement-ä¸-increment-æ–¹æ³•)
- [ä¼˜åŒ– Artisan çš„ Call æ–¹æ³•](#ä¼˜åŒ–-artisan-çš„-call-æ–¹æ³•)
- [Testing.Database çš„ Clear æ–¹æ³•é‡å‘½åä¸º Stop](#testing-database-çš„-clear-æ–¹æ³•é‡å‘½åä¸º-stop)
- [ä¼˜åŒ– Testing.Database çš„ Build æ–¹æ³•](#ä¼˜åŒ–-testing-database-çš„-build-æ–¹æ³•)
- [ä¼˜åŒ– Request.Input* æ–¹æ³•](#ä¼˜åŒ–-requestinput-æ–¹æ³•)
- [ä¼˜åŒ– validation.PrepareForValidation æ–¹æ³•](#ä¼˜åŒ–-validationprepareforvalidation-æ–¹æ³•)

## å‡çº§æŒ‡å—

**é¢„è®¡å‡çº§æ—¶é—´ï¼š10 åˆ†é’Ÿ**

éšç€ [Golang v1.21 ä¸å†è¢«ç»´æŠ¤](https://endoflife.date/go)ï¼ŒGoravel v1.15 é»˜è®¤æ”¯æŒ Golang ç‰ˆæœ¬ç”± 1.21 å‡çº§ä¸º 1.22ï¼Œè¯·åœ¨ go.mod æ–‡ä»¶ä¸­æ›´æ–°ç‰ˆæœ¬ã€‚

### 1. æ›´æ–°ä¾èµ–

```
go get -u github.com/goravel/framework@v1.15.0

// å¦‚æœä½¿ç”¨ gin
go get -u github.com/goravel/gin@v1.3.0

// å¦‚æœä½¿ç”¨ fiber
go get -u github.com/goravel/fiber@v1.3.0
```

### 2. ä¸º Request æ–°å¢ Filters æ–¹æ³•

è¿›å…¥ `app/http/requests` ç›®å½•ï¼Œä¸ºæ‰€æœ‰çš„ Request æ–°å¢ `Filters` æ–¹æ³•ã€‚

```go
// ä¿®æ”¹ `r *StorePostRequest` ä¸ºè‡ªå·±çš„å€¼
func (r *StorePostRequest) Filters(ctx http.Context) map[string]string {
  return map[string]string{}
}
```

### 3. å¦‚æœæ­£åœ¨ä½¿ç”¨ Mail æ¨¡å—

ä¿®æ”¹ `Subject` çš„è®¾ç½®æ–¹å¼ï¼š

```go
-- import "github.com/goravel/framework/contracts/mail"
++ import "github.com/goravel/framework/mail"

-- Content(mail.Content{Subject: "Subject", Html: "<h1>Hello Goravel</h1>"})
++ Content(mail.Html("<h1>Hello Goravel</h1>")).Subject("Subject")
```

å¦‚æœä½¿ç”¨äº† `From` æ–¹æ³•ï¼š

```go
-- import "github.com/goravel/framework/contracts/mail"
++ import "github.com/goravel/framework/mail"

-- From(mail.From{Address: testFromAddress, Name: testFromName}
++ From(mail.Address(testFromAddress, testFromName)
```

å¦‚æœä½¿ç”¨äº† `Queue` æ–¹æ³•ï¼š

```go
-- import "github.com/goravel/framework/contracts/mail"
++ import "github.com/goravel/framework/mail"

-- Queue(mail.Queue{Connection: "high", Queue: "mail"})
++ Queue(mail.Queue().Connection("high").Queue("mail"))
```

### 4. å¦‚æœæ­£åœ¨ä½¿ç”¨ Queue æ¨¡å—çš„ Worker æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Queue æ¨¡å—çš„ Worker æ–¹æ³•](#ä¼˜åŒ–-queue-æ¨¡å—çš„-worker-æ–¹æ³•)

### 5. å¦‚æœæ­£åœ¨ä½¿ç”¨ Postgres æ•°æ®åº“

éœ€ç›¸åº”ä¿®æ”¹ï¼š[Postgresql é©±åŠ¨åç§°æ›´æ”¹ä¸º Postgres](#postgresql-é©±åŠ¨åç§°æ›´æ”¹ä¸º-postgres)

### 6. å¦‚æœæ­£åœ¨ä½¿ç”¨ Orm.Transaction æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¿®æ”¹ Orm.Transaction æ–¹æ³•å›è°ƒå‚æ•°ç±»å‹](#ä¿®æ”¹-orm-transaction-æ–¹æ³•å›è°ƒå‚æ•°ç±»å‹)

### 7. å¦‚æœæ­£åœ¨ä½¿ç”¨ Orm çš„ Delete æˆ– ForceDelete æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Orm çš„ Delete ä¸ ForceDelete æ–¹æ³•](#ä¼˜åŒ–-orm-çš„-delete-ä¸-forcedelete-æ–¹æ³•)

### 8. å¦‚æœæ­£åœ¨ä½¿ç”¨ Route çš„ Shutdown æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[Route çš„ Shutdown æ–¹æ³•é‡å‘½åä¸º Stop](#route-çš„-shutdown-æ–¹æ³•é‡å‘½åä¸º-stop)

### 9. å¦‚æœæ­£åœ¨ä½¿ç”¨ Cache çš„ Decrement æˆ– Increment æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Cache çš„ Decrement ä¸ Increment æ–¹æ³•](#ä¼˜åŒ–-cache-çš„-decrement-ä¸-increment-æ–¹æ³•)

### 10. å¦‚æœæ­£åœ¨ä½¿ç”¨ Artisan çš„ Call æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Artisan çš„ Call æ–¹æ³•](#ä¼˜åŒ–-artisan-çš„-call-æ–¹æ³•)

### 11. å¦‚æœæ­£åœ¨ä½¿ç”¨ Route çš„ Shutdown æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[Route åºŸå¼ƒ Shutdown æ–¹æ³•](#route-åºŸå¼ƒ-shutdown-æ–¹æ³•)

### 12. å¦‚ä½•æ­£åœ¨ä½¿ç”¨ Testing.Database çš„ Clear æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[Testing.Database çš„ Clear æ–¹æ³•é‡å‘½åä¸º Stop](#testing-database-çš„-clear-æ–¹æ³•é‡å‘½åä¸º-stop)

### 13. å¦‚æœæ­£åœ¨ä½¿ç”¨ Testing.Database çš„ Build æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Testing.Database çš„ Build æ–¹æ³•](#ä¼˜åŒ–-testing-database-çš„-build-æ–¹æ³•)

### 14. å¦‚æœæ­£åœ¨ä½¿ç”¨ Migration æ¨¡å—

ä¿®æ”¹ `config/database.go` ä¸­çš„é…ç½®ï¼š

```go
-- "migrations": "migrations",
++ "migrations": map[string]any{
++    "driver": "sql",
++    "table":  "migrations",
++ },
```

### 15. å¦‚æœæ­£åœ¨ä½¿ç”¨ Request.Input* æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– Request.Input* æ–¹æ³•](#ä¼˜åŒ–-request-input-æ–¹æ³•)

### 16. å¦‚æœæ­£åœ¨ä½¿ç”¨ validation.PrepareForValidation æ–¹æ³•

éœ€ç›¸åº”ä¿®æ”¹ï¼š[ä¼˜åŒ– validation.PrepareForValidation æ–¹æ³•](#ä¼˜åŒ–-validationprepareforvalidation-æ–¹æ³•)

## åŠŸèƒ½ä»‹ç»

### Migration æ”¯æŒä½¿ç”¨ Go è¯­è¨€è¿ç§»

ä¹‹å‰æ¡†æ¶ä»…æ”¯æŒ SQL è¿ç§»ï¼Œå½“æƒ³è¦åˆ‡æ¢æ•°æ®åº“æ—¶ï¼Œç”±äºä¸åŒæ•°æ®åº“é—´çš„ SQL è¯­æ³•å·®å¼‚ï¼Œå°†ä½¿è¿ç§»è¿‡ç¨‹æå…¶å›°éš¾ã€‚æ­¤å¤–ï¼Œè¿ç§»æ–‡ä»¶ä¸­ä¹Ÿæ— æ³•æ‰§è¡Œä»£ç ï¼Œåœ¨è¿›è¡Œæ•°æ®ä¿®å¤æ—¶ï¼Œæ— æ³•è¿›è¡Œé€»è¾‘åˆ¤æ–­ã€‚

ç°åœ¨æ¡†æ¶æ”¯æŒç›´æ¥ä½¿ç”¨ Go è¯­è¨€ç”Ÿæˆè¿ç§»æ–‡ä»¶ï¼Œæ–¹ä¾¿å¼€å‘è€…ç¼–å†™å¤æ‚çš„è¿ç§»é€»è¾‘ã€‚ä½†åœ¨å½“å‰ç‰ˆæœ¬ä¸­ï¼Œå°šæœªå®ç°å¯¹è¡¨å­—æ®µçš„ä¿®æ”¹åŠŸèƒ½ï¼Œä»…æ”¯æŒåˆ›å»ºè¡¨ã€åˆ é™¤è¡¨ã€åˆ›å»ºç´¢å¼•ç­‰æ“ä½œã€‚å¦‚æœæƒ³è¿›è¡Œä¿®æ”¹ï¼Œéœ€è¦ä½¿ç”¨ `Sql` æ–¹æ³•ç›´æ¥æ‰§è¡Œ SQL è¯­å¥ã€‚ä¿®æ”¹è¡¨å­—æ®µçš„åŠŸèƒ½å°†åœ¨åç»­ç‰ˆæœ¬ä¸­æ”¯æŒã€‚

åœ¨ v1.15 ç‰ˆæœ¬ä¸­ï¼Œæ¡†æ¶åŒæ—¶æ”¯æŒ Go è¯­è¨€è¿ç§»ï¼ˆé»˜è®¤ï¼‰å’Œ SQL è¿ç§»ï¼Œä½† SQL è¿ç§»å°†åœ¨ v1.16 ç‰ˆæœ¬ä¸­ç§»é™¤ã€‚

#### ç”± SQL è¿ç§»åˆ‡æ¢åˆ° Go è¯­è¨€è¿ç§»

å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ SQL è¿ç§»ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤åˆ‡æ¢åˆ° Go è¯­è¨€è¿ç§»ï¼š

1. ä¿®æ”¹ `config/database.go` ä¸­çš„é…ç½®

```go
-- "migrations": "migrations",
++ "migrations": map[string]any{
++    "driver": "default",
++    "table":  "migrations",
++ },
```

2. ä½¿ç”¨ `go run . artisan make:migration {NAME}` å‘½ä»¤åˆ›å»ºè¿ç§»æ–‡ä»¶

åœ¨ç”Ÿæˆçš„æ–‡ä»¶çš„ `Up`, `Down` æ–¹æ³•ä¸­ï¼Œåˆ†åˆ«æ‰§è¡ŒåŸ SQL è¿ç§»æ–‡ä»¶ä¸­çš„è¿ç§»ã€å›æ»šè¯­å¥ï¼š

```go
return facades.Schema().Sql({SQL})
```

3. æ³¨å†Œè¿ç§»æ–‡ä»¶åˆ° `database/kernel.go` æ–‡ä»¶

æ–°å»º `database/kernel.go` æ–‡ä»¶ï¼Œå¹¶æ³¨å†Œè¿ç§»æ–‡ä»¶ä¸ Seederï¼š

```go
package database

import (
  "github.com/goravel/framework/contracts/database/schema"
  "github.com/goravel/framework/contracts/database/seeder"

  "goravel/database/migrations"
  "goravel/database/seeders"
)

type Kernel struct {
}

func (kernel Kernel) Migrations() []schema.Migration {
  return []schema.Migration{
    &migrations.M20241207095921CreateUsersTable{},
  }
}

func (kernel Kernel) Seeders() []seeder.Seeder {
  return []seeder.Seeder{
    &seeders.DatabaseSeeder{},
  }
}
```

4. ä¿®æ”¹ `app/providers/database_service_provider.go` æ–‡ä»¶å®Œæˆæ³¨å†Œï¼Œè¯·å°†åŸæœ¬åœ¨æ­¤æ³¨å†Œçš„ `Seeder` ç§»åŠ¨åˆ° `database/kernel.go::Seeders`

```go
-- func (receiver *DatabaseServiceProvider) Boot(app foundation.Application) {
--   facades.Seeder().Register([]seeder.Seeder{
--     &seeders.DatabaseSeeder{},
--   })
-- }
++ func (receiver *DatabaseServiceProvider) Boot(app foundation.Application) {
++   kernel := database.Kernel{}
++   facades.Schema().Register(kernel.Migrations())
++   facades.Seeder().Register(kernel.Seeders())
++ }
```

[æŸ¥çœ‹æ–‡æ¡£](../orm/migrations.md)

### Testing æ”¯æŒ HTTP æµ‹è¯•

goravel/framework: v1.15.0

æ¡†æ¶æ–°å¢ `Testing.Http` æ¨¡å—ï¼Œæ”¯æŒå¯¹ HTTP è¯·æ±‚è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥æ¨¡æ‹Ÿè¯·æ±‚ã€è·å–å“åº”ã€æ–­è¨€å“åº”ç­‰ã€‚

[æŸ¥çœ‹æ–‡æ¡£](../testing/http-tests.md)

### Request æ”¯æŒè®¾ç½® Filter

goravel/framework: v1.15.0

[æŸ¥çœ‹æ–‡æ¡£](../the-basics/validation.md#è¿‡æ»¤è¾“å…¥æ•°æ®)

### Request å¢åŠ  BindQuery æ–¹æ³•

goravel/framework: v1.15.0

æ”¯æŒä½¿ç”¨ `ctx.Request().BindQuery()` ç›´æ¥ç»‘å®šé“¾æ¥ä¸­çš„å‚æ•°ã€‚

[æŸ¥çœ‹æ–‡æ¡£](../the-basics/request.md#ç»‘å®š-query)

### æ”¯æŒæ§åˆ¶ Schedule æ—¥å¿—è¾“å‡º

goravel/framework: v1.15.0

å½“ `app.debug` ä¸º `false` æ—¶ï¼Œå°†åªè¾“å‡º `error` çº§åˆ«æ—¥å¿—ã€‚

### Mail æ”¯æŒ Mailable æ¨¡ç‰ˆ

goravel/framework: v1.15.0

[æŸ¥çœ‹æ–‡æ¡£](../digging-deeper/mail.md#ä½¿ç”¨-mailable)

### HTTP æ”¯æŒè¿”å› Stream

goravel/framework: v1.15.0

[æŸ¥çœ‹æ–‡æ¡£](../the-basics/response.md#è¿”å›-stream)

### Auth æ–°å¢ ID æ–¹æ³•

goravel/framework: v1.15.0

```go
id, err := facades.Auth(ctx).ID()
```

### Validation æ”¯æŒ Regex è§„åˆ™

goravel/framework: v1.15.0

```go
validator, err := ctx.Request().Validate(map[string]string{
  "code": "required|regex:\d{4,6}",
})
```

### Orm çš„ Create æ–¹æ³•æ”¯æŒä½¿ç”¨ map åˆ›å»º

goravel/framework: v1.15.0

[æŸ¥çœ‹æ–‡æ¡£](../orm/getting-started.md#åˆ›å»º)

### Schedule æ–°å¢ Stop æ–¹æ³•

goravel/framework: v1.15.0

[æŸ¥çœ‹æ–‡æ¡£](../digging-deeper/task-scheduling.md#å…³é—­è°ƒåº¦ç¨‹åº)

### HTTP æ”¯æŒè®¾ç½®è¶…æ—¶æ—¶é—´

goravel/framework: v1.15.0

å¯ä»¥é€šè¿‡åœ¨ `config/http.go` æ–‡ä»¶ä¸­é…ç½® `http.request_timeout` è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º 3 ç§’ã€‚

### é”™è¯¯æ—¥å¿—è¾“å‡ºçš„ trace æ”¯æŒç‚¹å‡»è·³è½¬

goravel/framework: v1.15.0

åœ¨é”™è¯¯æ—¥å¿—è¾“å‡ºä¸­ï¼Œç‚¹å‡» trace å¯ä»¥è·³è½¬åˆ°é”™è¯¯å‘ç”Ÿçš„ä»£ç è¡Œã€‚

### å¤šä¸ª Auth.Guard å¯ä»¥è®¾ç½®è‡ªå·±çš„ TTL

goravel/framework: v1.15.0

ä¹‹å‰å¤šä¸ª Guard å…¬ç”¨ `jwt.ttl` é…ç½®ï¼Œç°åœ¨ä½ å¯ä»¥é€šè¿‡åœ¨ `config/auth.go` æ–‡ä»¶ä¸­ä¸ºæ¯ä¸ª Guard å•ç‹¬è®¾ç½® TTLï¼Œå¦‚æœä¸è®¾ç½®ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ `jwt.ttl` é…ç½®ã€‚

```go
// config/auth.go
"guards": map[string]any{
  "user": map[string]any{
    "driver": "jwt",
++  "ttl": 60,
  },
},
```

### Log æ”¯æŒæ‰“å° Context ä¸­çš„é”®å€¼

goravel/framework: v1.15.0

```go
ctx.WithValue("a", "b")
facades.Log().WithContext(ctx).Info("Hello Goravel")

// Output: 
[2024-12-15 16:36:58] local.info: Hello Goravel 
Context: map[a:b]
```

### æ”¯æŒç›´æ¥è®¾ç½® DSN è¿æ¥æ•°æ®åº“

goravel/framework: v1.15.0

[æŸ¥çœ‹æ–‡æ¡£](../orm/getting-started.md#dsn)

### ä¼˜åŒ– Queue æ¨¡å—çš„ Worker æ–¹æ³•

goravel/framework: v1.15.0

å½“ `Worker` æ–¹æ³•ä¸éœ€è¦è®¾ç½®å‚æ•°æ—¶ï¼Œå¯ä»¥ä¿æŒä¸ºç©ºï¼š

```go
-- facades.Queue().Worker(nil).Run()
++ facades.Queue().Worker().Run()
```

å½“éœ€è¦è®¾ç½®å‚æ•°æ—¶ï¼Œå‚æ•°ç”±æŒ‡é’ˆæ”¹ä¸ºå®ä¾‹ï¼š

```go
-- facades.Queue().Worker(&queue.Args{Connection: "redis").Run()
++ facades.Queue().Worker(queue.Args{Connection: "redis").Run()
```

### Postgresql é©±åŠ¨åç§°æ›´æ”¹ä¸º Postgres

goravel/framework: v1.15.0

Postgresql é©±åŠ¨çš„åç§°å·²æ›´æ”¹ä¸º `postgres`ï¼Œå¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ Postgresql é©±åŠ¨ç¨‹åºï¼Œåˆ™éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š

```go
// config/database.go
"postgres": map[string]any{
  -- "driver":   "postgresql",
  ++ "driver":   "postgres",
  "host":     config.Env("DB_HOST", "127.0.0.1"),
}
```

### ä¿®æ”¹ Orm.Transaction æ–¹æ³•å›è°ƒå‚æ•°ç±»å‹

goravel/framework: v1.15.0

`facades.Orm().Transaction()` æ–¹æ³•çš„å›è°ƒå‚æ•°ç±»å‹ç”± `func(tx orm.Transaction) error` æ”¹ä¸º `func(tx orm.Query) error`ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œè¯·ç›¸åº”ä¿®æ”¹ã€‚

```go
-- facades.Orm().Transaction(func(tx orm.Transaction) error {
++ facades.Orm().Transaction(func(tx orm.Query) error {
  var user models.User

  return tx.Find(&user, user.ID)
})
```

### ä¼˜åŒ– Orm çš„ Delete ä¸ ForceDelete æ–¹æ³•

goravel/framework: v1.15.0

å¦‚æœä½ æ­£åœ¨å‘ `Delete` æˆ– `ForceDelete` æ–¹æ³•ä¼ å…¥ ID åˆ é™¤æ•°æ®ï¼Œè¯·æ”¹ä¸ºä½¿ç”¨ `Where` æ–¹æ³•ï¼š

```go
-- facades.Orm().Query().Delete(&models.User{}, 10)
++ facades.Orm().Query().Where("id", 10).Delete(&models.User{})

-- facades.Orm().Query().Delete(&models.User{}, []uint{1, 2, 3})
++ facades.Orm().Query().WhereIn("id", []uint{1, 2, 3}).Delete(&models.User{})

-- facades.Orm().Query().ForceDelete(&models.User{}, 10)
++ facades.Orm().Query().ForceDelete("id", 10).Delete(&models.User{})
```

`Delete` å’Œ `ForceDelete` æ–¹æ³•æ”¯æŒä¸ä¼ å…¥å‚æ•°åˆ é™¤æ•°æ®ï¼š

```go
res, err := facades.Orm().Query().Model(&models.User{}).Where("id", 1).Delete()
res, err := facades.Orm().Query().Table("users").Where("id", 1).Delete()
```

### Route çš„ Shutdown æ–¹æ³•é‡å‘½åä¸º Stop

goravel/framework: v1.15.0

ä¸ºäº†ä¿æŒ `Stop` æ–¹æ³•åç§°ä¸å…¶ä»–æ¨¡å—ä¸€è‡´ï¼Œæˆ‘ä»¬å°† `Shutdown` æ–¹æ³•é‡å‘½åä¸º `Stop`ã€‚

```go
-- facades.Route().Shutdown()
++ facades.Route().Stop()
```

### ä¼˜åŒ– Cache çš„ Decrement ä¸ Increment æ–¹æ³•

goravel/framework: v1.15.0

`Decrement` å’Œ `Increment` æ–¹æ³•çš„å…¥å‚ä¸å‡ºå‚ç±»å‹ç”± `int` ä¿®æ”¹ä¸º `int64`ï¼š

```go
-- Decrement(key string, value ...int) (int, error)
++ Decrement(key string, value ...int64) (int64, error)

-- Increment(key string, value ...int) (int, error)
++ Increment(key string, value ...int64) (int64, error)
```

### ä¼˜åŒ– Artisan çš„ Call æ–¹æ³•

goravel/framework: v1.15.0

ä¹‹å‰ `facades.Artisan().Call()` æ–¹æ³•æ‰§è¡Œæ—¶é‡åˆ°é”™è¯¯å°†ä¼šç›´æ¥ panicï¼Œç°åœ¨å°†è¿”å›é”™è¯¯ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œè¯·å¤„ç†è¯¥é”™è¯¯è¿”å›ã€‚

```go
err := facades.Artisan().Call("command:name")
```

### Testing.Database çš„ Clear æ–¹æ³•é‡å‘½åä¸º Stop

goravel/framework: v1.15.0

ä¸ºäº†ä¿æŒ `Stop` æ–¹æ³•åç§°ä¸å…¶ä»–æ¨¡å—ä¸€è‡´ï¼Œæˆ‘ä»¬å°† `Clear` æ–¹æ³•é‡å‘½åä¸º `Stop`ã€‚

```go
database, err := facades.Testing().Docker().Database()
-- err := database.Clear()
++ err := database.Stop()
```

### ä¼˜åŒ– Testing.Database çš„ Build æ–¹æ³•

goravel/framework: v1.15.0

ä¹‹å‰åœ¨è°ƒç”¨ `Build` æ–¹æ³•æ—¶ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œæ•°æ®åº“è¿ç§»ï¼Œå‡çº§åï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨ `Migrate` æ–¹æ³•è¿›è¡Œè¿ç§»ï¼Œæ•°æ®åº“æ§åˆ¶æ›´åŠ çµæ´»ã€‚

```go
database, err := facades.Testing().Docker().Database()
err := database.Build()
++ err := database.Migrate()
```

### ä¼˜åŒ– Request.Input* æ–¹æ³•

goravel/framework: v1.15.0

goravel/gin: v1.3.0

goravel/fiber: v1.3.0

ä¹‹å‰ `Request.Input*` æ–¹æ³•ä»…èƒ½è·å– `Body` ä¸­çš„æ•°æ®ï¼Œç°åœ¨å°†ä¾æ¬¡æŸ¥æ‰¾ `Body`ã€ `Query`ã€`Param`ã€‚å¹¶ä¸”ä¹‹å‰å‘ `Request.Input*` æ–¹æ³•ä¼ é€’ç¬¬äºŒä¸ªå‚æ•°(é»˜è®¤å€¼)æ—¶ï¼Œå¦‚æœ `key` å­˜åœ¨ï¼Œä½†ç½®ä¸ºç©ºï¼Œå°†è¿”å›é»˜è®¤å€¼ï¼Œç°åœ¨å°†è¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œå› ä¸ºç©ºå­—ç¬¦ä¸²ä¹Ÿæ˜¯ä¸€ç§æœ‰æ•ˆå€¼ã€‚

### ä¼˜åŒ– validation.PrepareForValidation æ–¹æ³•

goravel/framework: v1.15.0

ä¿®æ”¹å…¥å‚çš„ç±»å‹ï¼Œå¢åŠ  `http.Context` å‚æ•°ï¼š

```go
import github.com/goravel/framework/validation

-- validator, err := facades.Validation().Make(input, rules, validation.PrepareForValidation(func(data validationcontract.Data) error {
++ validator, err := facades.Validation().Make(input, rules, validation.PrepareForValidation(func(ctx http.Context, data validationcontract.Data) error {
  if name, exist := data.Get("name"); exist {
  return data.Set("name", name)
  }

  return nil
}))
```
