# 从 v1.7 升级到 v1.8

[[toc]]

## 高影响变化

- [Orm 新增模型关联](#Orm-新增模型关联)
- [Request 新增方法](#Request-新增方法)
- [Response 新增方法](#Response-新增方法)
- [mock.Validator 改名](#mock.Validator-改名)
- [优化 import 顺序](#优化-import-顺序)

## 低影响变化

- [优化数据库迁移](#优化数据库迁移)
- [support.Mysql 改名](support.Mysql-改名)
- [下一个大版本将废弃 database.NewGormInstance](#下一个大版本将废弃-database.NewGormInstance)

## 升级指南

**预计升级时间：1 分钟**

### 更新依赖

**影响可能性：高**

`go.mod` 中更新依赖：

```go
github.com/goravel/framework v1.8.0
```

### Orm 新增模型关联

**影响可能性：高**

Orm 新增 `With`, `Load`, `LoadMissing`, `Omit` 方法，以处理模型关联操作；

[查看文档](../ORM/relationship.md)

### Request 新增方法

**影响可能性：高**

`ctx.Request()` 新增 `QueryArray`, `QueryMap` 方法，以丰富 Query 传参的格式；

[查看文档](../the-basics/request.md)

### Response 新增方法

**影响可能性：高**

`ctx.Response()` 新增 `Origin`，可在 HTTP 中间件中获取 `Response` 的所有信息；

[查看文档](../the-basics/response.md)

### mock.Validator 改名

**影响可能性：高**

如果您使用了 `mock.Validator` 来编写单元测试，需要进行下面修改：

```
import "github.com/goravel/framework/testing/mock"

mock.Validator

// 修改为

import "github.com/goravel/framework/testing/mock"

mock.Validation
```

[查看文档](../digging-deeper/mock.md)

### 优化 import 顺序

**影响可能性：高**

`bootstrap/app.go` 文件中 import 顺序修改为：

```
package bootstrap

import (
	"github.com/goravel/framework/foundation"

	"goravel/config"
)
```

[查看文件](https://github.com/goravel/goravel/blob/v1.8.0/bootstrap/app.go)

### 优化数据库迁移

**影响可能性：低**

运行生成数据库迁移文件命令 `go run . artisan make:migration create_users_table`，将根据当前使用的默认数据库驱动 `facades.Config.GetString("database.default")` 生成对应的迁移文件。

### support.Mysql 改名

**影响可能性：低**

如果您使用了 `support.Mysql` 等框架常量来进行数据库驱动的判断，需要进行如下修改：

```
import "github.com/goravel/framework/database/support"

support.Mysql
support.Postgresql
support.Sqlite
support.Sqlserver

// 修改为

import "github.com/goravel/framework/contracts/database/orm"

orm.Mysql
orm.Postgresql
orm.Sqlite
orm.Sqlserver
```

`orm.Mysql` 等新的常量为 `orm.Driver` 类型，可以使用 `orm.Mysql.String()` 方法转换为字符类型。

### 下一个大版本将废弃 database.NewGormInstance

**影响可能性：低**

`database.NewGormInstance` 方法将在 v1.9.0 被废弃，当前版本尚可使用，如果您使用了该方法获取 `gorm` 实例，需要进行如下修改：

```
import "github.com/goravel/framework/database"

gorm, err := database.NewGormInstance(connection)

// 修改为

import "github.com/goravel/framework/database/gorm"

gorm, err := gorm.New(connection)
```
