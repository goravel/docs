# 从 v1.7 升级到 v1.8

[[toc]]

## 高影响变化

- [Orm 新增模型关联](#Orm-新增模型关联)
- [Request 新增方法](#Request-新增方法)
- [Response 新增方法](#Response-新增方法)
- [mock.Validator 改名](#mock.Validator-改名)
- [优化 import 顺序](#优化-import-顺序)

## 低影响变化

- [优化数据库迁移](#优化数据库迁移)
- [support.Mysql 改名](#support.Mysql-改名)
- [即将废弃 database.NewGormInstance](#即将废弃-database.NewGormInstance)

## 升级指南

**预计升级时间：5 分钟**

### 更新依赖

**影响可能性：高**

`go.mod` 中更新依赖：

```go
github.com/goravel/framework v1.8.0
```

### Orm 新增模型关联

**影响可能性：高**

Orm 新增方法，以处理模型关联等操作：

| 方法名        | 作用                              |
| -----------  | --------------------------------- |
| Association  | [关联操作](../ORM/association.md#关联操作) |
| DB           | [获取通用数据库接口](../ORM/getting-started.md#获取通用数据库接口) |
| Load         | [延迟预加载](../ORM/association.md#延迟预加载) |
| LoadMissing  | [延迟预加载(不存在)](../ORM/association.md#延迟预加载)           |
| Omit         | [忽略关联](../ORM/association.md#创建/更新关联)     |
| With         | [预加载](../ORM/association.md#预加载)     |

### Request 新增方法

**影响可能性：高**

`ctx.Request()` 新增方法，以丰富 `Query` 传参的格式：

| 方法名        | 作用                              |
| -----------  | --------------------------------- |
| `QueryArray` | [获取链接传入的数组参数](../the-basics/request.md#获取链接传入的参数) |
| `QueryMap`   | [获取链接传入的 Map 参数](../the-basics/request.md#获取链接传入的参数) |

### Response 新增方法

**影响可能性：高**

`ctx.Response()` 新增 `Origin` 方法，可以在 HTTP 中间件中获取 `Response` 的所有信息。

[查看文档](../the-basics/response.md#获取响应)

### mock.Validator 改名

**影响可能性：高**

如果您使用了 `mock.Validator` 来编写单元测试，需要进行下面修改：

```
import "github.com/goravel/framework/testing/mock"

mock.Validator

// 修改为

import "github.com/goravel/framework/testing/mock"

mock.Validation
```

[查看文档](../digging-deeper/mock.md#Mock-facades.Validation)

### 优化 import 顺序

**影响可能性：高**

`bootstrap/app.go` 文件中 import 顺序修改为：

```go
package bootstrap

import (
	"github.com/goravel/framework/foundation"

	"goravel/config"
)
```

[查看文件](https://github.com/goravel/goravel/blob/v1.8.0/bootstrap/app.go)

### 优化数据库迁移

**影响可能性：低**

运行生成数据库迁移文件命令 `go run . artisan make:migration create_users_table`，将根据当前使用的默认数据库驱动 `facades.Config.GetString("database.default")` 生成对应的迁移文件。

### support.Mysql 改名

**影响可能性：低**

如果您使用了 `support.Mysql` 等框架常量来进行数据库驱动的判断，需要进行如下修改：

```go
import "github.com/goravel/framework/database/support"

support.Mysql
support.Postgresql
support.Sqlite
support.Sqlserver

// 修改为

import "github.com/goravel/framework/contracts/database/orm"

orm.Mysql
orm.Postgresql
orm.Sqlite
orm.Sqlserver
```

`orm.Mysql` 等新的常量为 `orm.Driver` 类型，可以使用 `orm.Mysql.String()` 方法转换为字符类型。

### 即将废弃 database.NewGormInstance

**影响可能性：低**

`database.NewGormInstance` 方法将在 v1.9.0 被废弃，当前版本尚可使用，如果您使用了该方法获取 `gorm` 实例，需要进行如下修改：

```go
import "github.com/goravel/framework/database"

gorm, err := database.NewGormInstance(connection)

// 修改为

import "github.com/goravel/framework/database/gorm"

gorm, err := gorm.New(connection)
```
