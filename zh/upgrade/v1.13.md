# ä» v1.12 å‡çº§åˆ° v1.13

[[toc]]

### ä»¤äººå…´å¥‹çš„æ–°åŠŸèƒ½ ğŸ‰

- [æ•°æ®å¡«å……](#æ•°æ®å¡«å……)
- [æ¨¡å‹å·¥å‚](#æ¨¡å‹å·¥å‚)
- [é›†æˆæµ‹è¯•](#é›†æˆæµ‹è¯•)
- [è§†å›¾](#è§†å›¾)

### åŠŸèƒ½å¢å¼º ğŸš€

- [Go é»˜è®¤ç‰ˆæœ¬å‡çº§ä¸º 1.20](#go-é»˜è®¤ç‰ˆæœ¬å‡çº§ä¸º-1-20)
- [ä»»åŠ¡è°ƒåº¦æ”¯æŒæ¨ªå‘ä¼¸ç¼©](#ä»»åŠ¡è°ƒåº¦æ”¯æŒæ¨ªå‘ä¼¸ç¼©)
- [æ–°å¢ debug æ–¹æ³•](#æ–°å¢-debug-æ–¹æ³•)
- [make:controller å‘½ä»¤æ–°å¢å‚æ•°](#make-controller-å‘½ä»¤æ–°å¢å‚æ•°)
- [Response æ–°å¢ Status æ–¹æ³•](#response-æ–°å¢-status-æ–¹æ³•)
- [Orm æ–°å¢ Sum å’Œ Cursor æ–¹æ³•](#orm-æ–°å¢-sum-å’Œ-cursor-æ–¹æ³•)
- [Route æ¨¡å—æ”¯æŒé…ç½®é©±åŠ¨](#route-æ¨¡å—æ”¯æŒé…ç½®é©±åŠ¨)
- [Request æ–°å¢ InputArray å’Œ InputMap æ–¹æ³•](#request-æ–°å¢-inputarray-å’Œ-inputmap-æ–¹æ³•)
- [Orm æ¨¡å‹æ”¯æŒè‡ªå®šä¹‰é“¾æ¥](#orm-æ¨¡å‹æ”¯æŒè‡ªå®šä¹‰é“¾æ¥)
- [Filesystem æ¨¡å—æ–°å¢ Cloudinary é©±åŠ¨](#filesystem-æ¨¡å—æ–°å¢-cloudinary-é©±åŠ¨)
- [Log æ–°å¢é“¾å¼æ–¹æ³•](#log-æ–°å¢é“¾å¼æ–¹æ³•)

### ç ´åæ€§å˜åŒ– ğŸ› 

- [ç§»é™¤é»˜è®¤åŠ è½½çš„ HTTP å…¨å±€ä¸­é—´ä»¶](#5--ç§»é™¤é»˜è®¤åŠ è½½çš„-http-å…¨å±€ä¸­é—´ä»¶)
- [ä¼˜åŒ– Controller è¿”å›](#6-ä¼˜åŒ–-controller-è¿”å›)
- [ä¼˜åŒ– facades.Cache() ä¸­ Remember ä¸ RememberForever æ–¹æ³•](#7--ä¿®æ”¹-facades-cache-ä¸­-remember-ä¸-rememberforever-æ–¹æ³•ï¼ˆå¦‚æœç”¨åˆ°ï¼‰)
- [ç§»é™¤åºŸå¼ƒæ–¹æ³•](#8-ç§»é™¤åºŸå¼ƒæ–¹æ³•ï¼ˆå¦‚æœç”¨åˆ°ï¼‰)

### Bug ä¿®å¤ ğŸ›

- [ä¿®å¤ facades.Auth().User() çš„é—®é¢˜](#ä¿®å¤-facades-auth-user-çš„é—®é¢˜)
- [ä¿®å¤è‡ªå®šä¹‰ .env è·¯ç”±æŸäº›æƒ…å†µä¸‹ä¸ç”Ÿæ•ˆçš„é—®é¢˜](#ä¿®å¤è‡ªå®šä¹‰-env-è·¯ç”±æŸäº›æƒ…å†µä¸‹ä¸ç”Ÿæ•ˆçš„é—®é¢˜)
- [ä¿®å¤ JWT ä¸­è®¾ç½® ttl == 0 æ—¶ token ç«‹å³è¿‡æœŸçš„é—®é¢˜](#ä¿®å¤-jwt-ä¸­è®¾ç½®-ttl-==-0-æ—¶-token-ç«‹å³è¿‡æœŸçš„é—®é¢˜)

## å‡çº§æŒ‡å—

è¯·æ ¹æ®æœ¬èŠ‚å†…å®¹ï¼Œä¸€æ­¥æ­¥è¿›è¡Œæ¡†æ¶å‡çº§ã€‚

**é¢„è®¡å‡çº§æ—¶é—´ï¼š5 åˆ†é’Ÿ**

### 1. æ›´æ–°ä¾èµ–

`go.mod` ä¸­æ›´æ–°ä¾èµ–ï¼š

```
go get -u github.com/goravel/framework@v1.13.0 && go get -u github.com/goravel/gin && go mod tidy
```

### 2. æ–°å¢æ–‡ä»¶

[tests](https://github.com/goravel/goravel/tree/v1.13.x/tests)
[database/seeders/database_seeder.go](https://github.com/goravel/goravel/tree/v1.13.x/database/seeders/database_seeder.go)
[app/providers/database_service_provider.go](https://github.com/goravel/goravel/tree/v1.13.x/app/providers/database_service_provider.go)

### 3. æ³¨å†Œæ–°çš„ Provider

æ³¨æ„é¡ºåºï¼š

```go
import (
  "github.com/goravel/framework/testing"
	"github.com/goravel/gin"
)

// config/app.go
"providers": []foundation.ServiceProvider{
  ...
  &validation.ServiceProvider{},
	&testing.ServiceProvider{}, // New
	&providers.AppServiceProvider{},
  ...
  &providers.ValidationServiceProvider{},
  &providers.DatabaseServiceProvider{}, // New
  &gin.ServiceProvider{}, // New
}
```

### 4. æ–°å¢é…ç½®

ä¿®æ”¹ [config/http.go](https://github.com/goravel/goravel/tree/v1.13.x/config/http.go)

```go
import ginfacades "github.com/goravel/gin/facades"

config.Add("http", map[string]any{
  // HTTP Driver
  "default": "gin",
  // HTTP Drivers
  "drivers": map[string]any{
    "gin": map[string]any{
      "route": func() (route.Route, error) {
        return ginfacades.Route("gin"), nil
      },
    },
  },
  ...
}
```

ä¿®æ”¹ [config/cors.go](https://github.com/goravel/goravel/tree/v1.13.x/config/cors.go)

```go
config.Add("cors", map[string]any{
  ...
  "paths":                []string{"*"}, // New
  "allowed_methods":      []string{"*"},
  ...
}
```

### 5. ç§»é™¤é»˜è®¤åŠ è½½çš„ HTTP å…¨å±€ä¸­é—´ä»¶

1. `tls` ä¸ `cors` ä¸­é—´ä»¶å·²é›†æˆè‡³é»˜è®¤ HTTP é©±åŠ¨ä¸­ï¼Œå› æ­¤ `app/http/kernel.go` æ–‡ä»¶ä¸­çš„ `middleware.Cors()` ä¸ `middleware.Tls()` éœ€è¢«ç§»é™¤ã€‚

2. `app/providers/route_service_provider.go` æ–‡ä»¶ä¸­ `facades.Route().GlobalMiddleware(http.Kernel{}.Middleware()...)` æ–¹æ³•ä» `Register` ç§»åŠ¨è‡³ `Boot`:

```go
package providers

...

type RouteServiceProvider struct {
}

func (receiver *RouteServiceProvider) Register(app foundation.Application) {
}

func (receiver *RouteServiceProvider) Boot(app foundation.Application) {
	//Add HTTP middleware
	facades.Route().GlobalMiddleware(http.Kernel{}.Middleware()...)

	receiver.configureRateLimiting()

	routes.Web()
}

func (receiver *RouteServiceProvider) configureRateLimiting() {

}
```

### 6. ä¼˜åŒ– Controller è¿”å›

`Controller` å¢åŠ è¿”å›å€¼ `http.Response`ï¼Œ`ctx.Response()` å¯ç›´æ¥è¿”å›ï¼Œä¸éœ€è¦å†å•ç‹¬ `return`ï¼Œä½¿é€»è¾‘æ›´åŠ æµç•…ï¼š

```go
// Before
func (r *UserController) Show(ctx http.Context) {
  ctx.Response().Success().Json(http.Json{
    "Hello": "Goravel",
  })
  return
}

// After
func (r *UserController) Show(ctx http.Context) http.Response {
  return ctx.Response().Success().Json(http.Json{
    "Hello": "Goravel",
  })
}
```

### 7. ä¿®æ”¹ facades.Cache() ä¸­ Remember ä¸ RememberForever æ–¹æ³•ï¼ˆå¦‚æœç”¨åˆ°ï¼‰

`callback` ç±»å‹ç”± `func() any` ä¿®æ”¹ä¸º `func() (any, error)`ï¼š

```go
// ä¿®æ”¹å‰
Remember(key string, ttl time.Duration, callback func() any) (any, error)
RememberForever(key string, callback func() any) (any, error)

// ä¿®æ”¹å
Remember(key string, ttl time.Duration, callback func() (any, error)) (any, error)
RememberForever(key string, callback func() (any, error)) (any, error)
```

### 8. ç§»é™¤åºŸå¼ƒæ–¹æ³•ï¼ˆå¦‚æœç”¨åˆ°ï¼‰

1. `Request` çš„ `Form` å’Œ `Json` æ–¹æ³•ï¼Œä½¿ç”¨ `Input` æ–¹æ³•æ›¿ä»£ï¼›

2. `Log` è‡ªå®šä¹‰é©±åŠ¨çš„ `GetLevel`, `GetTime`, `GetMessage` æ–¹æ³•ï¼Œä½¿ç”¨ `Level`, `Time`, `Message` æ–¹æ³•æ›¿ä»£ï¼›

3. `gorm.New` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºç›´æ¥è·å– `gorm` å®ä¾‹ï¼Œå·²ä¸æ¨èä½¿ç”¨ï¼Œå¦‚æœ‰å¿…è¦ï¼Œè¯·ä½¿ç”¨ `gorm.NewGormImpl` æ–¹æ³•æ›¿ä»£ï¼›

## åŠŸèƒ½ä»‹ç»

### æ•°æ®å¡«å……

Version: v1.13.0

[æŸ¥çœ‹æ–‡æ¡£](../orm/seeding.md)

### æ¨¡å‹å·¥å‚

Version: v1.13.0

[æŸ¥çœ‹æ–‡æ¡£](../orm/factories.md)

### é›†æˆæµ‹è¯•

Version: v1.13.0

[æŸ¥çœ‹æ–‡æ¡£](../testing/getting-started.md)

### è§†å›¾

Version: v1.13.0

[æŸ¥çœ‹æ–‡æ¡£](../the-basics/views.md)

### Go é»˜è®¤ç‰ˆæœ¬å‡çº§ä¸º 1.20

Version: v1.13.0

go 1.18 å’Œ 1.19 å·²åœæ­¢ç»´æŠ¤ï¼Œæ¡†æ¶ç›¸åº”å‡çº§åˆ° 1.20ï¼Œ[æŸ¥çœ‹è¯¦æƒ…](https://endoflife.date/go)ã€‚å¦‚æœæƒ³ç»§ç»­ä½¿ç”¨ 1.18 å’Œ 1.19 ç‰ˆæœ¬ï¼Œä¿®æ”¹ `go.mod` ä¸­çš„ç‰ˆæœ¬å·å³å¯ï¼Œç›®å‰å®ƒä»¬åŠŸèƒ½å®Œå…¨å…¼å®¹ã€‚

### ä»»åŠ¡è°ƒåº¦æ”¯æŒæ¨ªå‘ä¼¸ç¼©

Version: v1.13.0

[æŸ¥çœ‹æ–‡æ¡£](../digging-deeper/task-scheduling.md#ä»»åŠ¡åªè¿è¡Œåœ¨ä¸€å°æœåŠ¡å™¨ä¸Š)

### æ–°å¢ debug æ–¹æ³•

Version: v1.13.0

[æŸ¥çœ‹æ–‡æ¡£](../digging-deeper/helpers.md#debug)

### make:controller å‘½ä»¤æ–°å¢å‚æ•°

Version: v1.13.0

`make:controller` å‘½ä»¤æ–°å¢ `--resource` å‚æ•°ï¼Œå¯ä»¥ä¾¿æ·çš„ç”Ÿæˆ CURD structï¼š

```
go run . artisan make:controller --resource UserController
```

### Response æ–°å¢ Status æ–¹æ³•

Version: v1.13.0

[æŸ¥çœ‹æ–‡æ¡£](../the-basics/response.md#è‡ªå®šä¹‰-code)

### Orm æ–°å¢ Sum å’Œ Cursor æ–¹æ³•

Version: v1.13.0

[æŸ¥çœ‹æ–‡æ¡£](../orm/getting-started.md#facadesormquery--facadesormtransaction-å¯ç”¨æ–¹æ³•)

### Route æ¨¡å—æ”¯æŒé…ç½®é©±åŠ¨

Version: v1.13.0

å°† Route æ¨¡å—åŸé»˜è®¤é©±åŠ¨ Gin ç‹¬ç«‹æˆåŒ…ï¼Œé€šè¿‡é…ç½®çš„æ–¹å¼æ³¨å…¥åˆ° Goravel ä¸­ã€‚æœ¬æ¬¡ä¼˜åŒ–åï¼Œä¸ºå…¶ä»– HTTP åŒ…æ³¨å…¥åˆ° Goravel æä¾›äº†ä¾¿æ·çš„é€šé“ï¼Œç›®å‰å®˜æ–¹æ”¯æŒä¸¤ä¸ª HTTP åŒ…ï¼š

| é©±åŠ¨          | åœ°å€           |
| -----------  | -------------- |
| Gin          | (https://github.com/goravel/gin)[https://github.com/goravel/gin]     |
| Fiber        | (https://github.com/goravel/fiber)[https://github.com/goravel/fiber]     |

### Request æ–°å¢ InputArray å’Œ InputMap æ–¹æ³•

Version: v1.13.0

[æŸ¥çœ‹æ–‡æ¡£](../the-basics/request.md)

### Orm æ¨¡å‹æ”¯æŒè‡ªå®šä¹‰é“¾æ¥

Version: v1.13.0

[æŸ¥çœ‹æ–‡æ¡£](../orm/getting-started.md#æ•°æ®åº“è¿æ¥)

### Filesystem æ¨¡å—æ–°å¢ Cloudinary é©±åŠ¨

Version: v1.13.0

[æŸ¥çœ‹æ–‡æ¡£](https://github.com/goravel/cloudinary)

### Log æ–°å¢é“¾å¼æ–¹æ³•

Version: v1.13.0

[æŸ¥çœ‹æ–‡æ¡£](../the-basics/logging.md)

### ä¿®å¤ facades.Auth().User() çš„é—®é¢˜

Version: v1.13.0

1. ä¿®å¤ä½¿ç”¨ `facades.Auth().User(ctx, &user)` æ–¹æ³•æ—¶ï¼Œå¦‚æœ `user` ä¸å­˜åœ¨ä¸æŠ›å‡ºé”™è¯¯çš„é—®é¢˜ã€‚

2. ä¿®å¤å½“ä¸»é”®é `int` ç±»å‹æ—¶ï¼Œæ— æ³•æ‰¾åˆ° `user` çš„é—®é¢˜ï¼›

### ä¿®å¤è‡ªå®šä¹‰ .env è·¯ç”±æŸäº›æƒ…å†µä¸‹ä¸ç”Ÿæ•ˆçš„é—®é¢˜

Version: v1.13.0

### ä¿®å¤ JWT ä¸­è®¾ç½® ttl == 0 æ—¶ token ç«‹å³è¿‡æœŸçš„é—®é¢˜

Version: v1.13.0

é¢„æœŸå½“ `ttl == 0` æ—¶ï¼Œtoken æ°¸ä¸è¿‡æœŸã€‚ 
