import{_ as e,f as i,o as t,an as s}from"./chunks/framework.CFMQV-X7.js";const k=JSON.parse('{"title":"從 v1.9 升級到 v1.10","description":"","frontmatter":{},"headers":[],"relativePath":"zh_TW/upgrade/v1.10.md","filePath":"zh_TW/upgrade/v1.10.md","lastUpdated":1761445110000}'),r={name:"zh_TW/upgrade/v1.10.md"};function l(h,a,o,d,n,p){return t(),i("div",null,a[0]||(a[0]=[s(`<h1 id="從-v1-9-升級到-v1-10" tabindex="-1">從 v1.9 升級到 v1.10 <a class="header-anchor" href="#從-v1-9-升級到-v1-10" aria-label="Permalink to “從 v1.9 升級到 v1.10”">​</a></h1><nav class="table-of-contents"><ul><li><a href="#令人興奮的新功能-🎉">令人興奮的新功能 🎉</a></li><li><a href="#功能增強-🚀">功能增強 🚀</a></li><li><a href="#破壞性變化-🛠">破壞性變化 🛠</a></li><li><a href="#升級指南">升級指南</a><ul><li><a href="#更新依賴">更新依賴</a></li><li><a href="#加密解密">加密解密</a></li><li><a href="#哈希">哈希</a></li><li><a href="#新增路由限流器">新增路由限流器</a></li><li><a href="#優化-http-啟動方式">優化 HTTP 啟動方式</a></li><li><a href="#優化-grpc-啟動方式">優化 GRPC 啟動方式</a></li><li><a href="#增加控制日誌輸出到控制台的配置">增加控制日誌輸出到控制台的配置</a></li><li><a href="#request-修改、新增方法">Request 修改、新增方法</a></li><li><a href="#隊列支持延遲調度">隊列支持延遲調度</a></li><li><a href="#orm-連接支持配置表名前綴與單復數">ORM 連接支持配置表名前綴與單復數</a></li><li><a href="#新增-docker-compose-yml-文件">新增 docker-compose.yml 文件</a></li><li><a href="#優化-orm">優化 Orm</a></li><li><a href="#遷移文件中支持執行多條-sql-語句">遷移文件中支持執行多條 SQL 語句</a></li><li><a href="#文件系統新增-minio-驅動">文件系統新增 minio 驅動</a></li><li><a href="#contracts-http-增加-net-http-的-status-映射">contracts/http 增加 net/http 的 Status 映射</a></li><li><a href="#必須填寫-app-key">必須填寫 APP_KEY</a></li><li><a href="#在表單請求的各個方法中新增-ctx-參數">在表單請求的各個方法中新增 ctx 參數</a></li><li><a href="#facades-auth-parse-新增-payload-返回">facades.Auth.Parse 新增 payload 返回</a></li><li><a href="#orm-的部分方法新增返回值">Orm 的部分方法新增返回值</a></li></ul></li></ul></nav><h2 id="令人興奮的新功能-🎉" tabindex="-1">令人興奮的新功能 🎉 <a class="header-anchor" href="#令人興奮的新功能-🎉" aria-label="Permalink to “令人興奮的新功能 🎉”">​</a></h2><ul><li><a href="#加密">新增 facades.Crypt(1.10.0)</a></li><li><a href="#哈希">新增 facades.Hash(1.10.0)</a></li><li><a href="#新增路由限流器">新增路由限流器(1.10.0)</a></li></ul><h2 id="功能增強-🚀" tabindex="-1">功能增強 🚀 <a class="header-anchor" href="#功能增強-🚀" aria-label="Permalink to “功能增強 🚀”">​</a></h2><ul><li><a href="#優化-http-啟動方式">優化 HTTP 啟動方式(1.10.0)</a></li><li><a href="#優化-grpc-啟動方式">優化 GPRC 啟動方式(1.10.0)</a></li><li><a href="#增加控制日誌輸出到控制台的配置">增加控制日誌輸出到控制台的配置(1.10.0)</a></li><li><a href="#request-修改、新增方法">Request 修改、新增方法(1.10.0)</a></li><li><a href="#隊列支持延遲調度">隊列支持延遲調度(1.10.0)</a></li><li><a href="#orm-連接支持配置表名前綴與單數">ORM 連接支持配置表名前綴與單數(1.10.0)</a></li><li><a href="#新增-docker-compose-yml-文件">新增 docker-compose.yml 文件(1.10.0)</a></li><li><a href="#優化-orm">優化 Orm(1.10.0)</a></li><li><a href="#遷移文件中支持執行多條-sql-語句">遷移文件中支持執行多條 SQL 語句(1.10.0)</a></li><li><a href="#文件系統新增-minio-驅動">文件系統新增 minio 驅動(1.10.0)</a></li><li><a href="#contracts-http-增加-net-http-的-status-映射">contracts/http 增加 net/http 的 Status 映射(1.10.0)</a></li></ul><h2 id="破壞性變化-🛠" tabindex="-1">破壞性變化 🛠 <a class="header-anchor" href="#破壞性變化-🛠" aria-label="Permalink to “破壞性變化 🛠”">​</a></h2><ul><li><a href="#app-key-必填">APP_KEY 必填(1.10.0)</a></li><li><a href="#表單驗證中方法新增-ctx-參數">表單驗證中方法新增 ctx 參數(1.10.0)</a></li><li><a href="#facades-auth-parse-新增-payload-返回">facades.Auth.Parse 新增 payload 返回(1.10.0)</a></li><li><a href="#orm-的部分方法新增返回值">Orm 的部分方法新增返回值(1.10.0)</a></li></ul><h2 id="升級指南" tabindex="-1">升級指南 <a class="header-anchor" href="#升級指南" aria-label="Permalink to “升級指南”">​</a></h2><p><strong>預計升級時間：20 分鐘</strong></p><h3 id="更新依賴" tabindex="-1">更新依賴 <a class="header-anchor" href="#更新依賴" aria-label="Permalink to “更新依賴”">​</a></h3><p>在 <code>go.mod</code> 中更新依賴：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span>go get -u github.com/goravel/framework@v1.10.0 &amp;&amp; go mod tidy</span></span></code></pre></div><h3 id="加密解密" tabindex="-1">加密解密 <a class="header-anchor" href="#加密解密" aria-label="Permalink to “加密解密”">​</a></h3><p>Version: v1.10.0</p><p>新增 <code>facades.Crypt</code>：</p><ol><li>將 <code>&amp;crypt.ServiceProvider{}</code> 新增到 <a href="https://github.com/goravel/goravel/blob/v1.10.x/config/app.go" target="_blank" rel="noreferrer">config/app.go</a> 文件的 <code>providers</code> 項中；</li></ol><p><a href="./../security/encryption.html">查看文檔</a></p><h3 id="哈希" tabindex="-1">哈希 <a class="header-anchor" href="#哈希" aria-label="Permalink to “哈希”">​</a></h3><p>Version: v1.10.0</p><p>新增 <code>facades.Hash</code>：</p><ol><li><p>將 <code>&amp;hash.ServiceProvider{}</code> 新增到 <a href="https://github.com/goravel/goravel/blob/v1.10.x/config/app.go" target="_blank" rel="noreferrer">config/app.go</a> 文件的 <code>providers</code> 項中；</p></li><li><p>新增 <a href="https://github.com/goravel/goravel/blob/v1.10.x/config/hashing.go" target="_blank" rel="noreferrer">config/hashing.go</a> 文件；</p></li></ol><p><a href="./../security/hashing.html">查看文檔</a></p><h3 id="新增路由限流器" tabindex="-1">新增路由限流器 <a class="header-anchor" href="#新增路由限流器" aria-label="Permalink to “新增路由限流器”">​</a></h3><p>Version: v1.10.0</p><p><a href="./../the-basics/routing.html#Rate-Limiting">查看文檔</a></p><h3 id="優化-http-啟動方式" tabindex="-1">優化 HTTP 啟動方式 <a class="header-anchor" href="#優化-http-啟動方式" aria-label="Permalink to “優化 HTTP 啟動方式”">​</a></h3><p>Version: v1.10.0</p><ol><li>新增 <code>config/http.go</code> 配置文件，<a href="https://github.com/goravel/goravel/blob/v1.10.x/config/http.go" target="_blank" rel="noreferrer">詳見文件</a>；</li><li><code>facades.Route.Run</code> 方法不再需要傳參，默認使用 <code>http.host</code> 和 <code>http.port</code>（你無需修改代碼，向下兼容）；</li><li><code>facades.Route.RunTLS</code> 方法不再需要傳參，默認使用 <code>http.tls.host</code>、<code>http.tls.port</code>、<code>http.tls.ssl.cert</code> 和 <code>http.tls.ssl.key</code>，如使用，需修改代碼；</li><li>新增 <code>facades.Route.RunTLSWithCert</code> 方法，<a href="./../the-basics/routing.html#start-server">詳見文檔</a>；</li><li>將配置 <code>app.url</code>、<code>app.host</code> 移到 <code>http.url</code>、<code>http.host</code>；</li></ol><h3 id="優化-grpc-啟動方式" tabindex="-1">優化 GRPC 啟動方式 <a class="header-anchor" href="#優化-grpc-啟動方式" aria-label="Permalink to “優化 GRPC 啟動方式”">​</a></h3><p>Version: v1.10.0</p><p><code>facades.Grpc.Run</code> 方法不再需要傳參，默認使用 <code>grpc.host</code> 和 <code>grpc.port</code>（你無需修改代碼，向下兼容）；</p><h3 id="增加控制日誌輸出到控制台的配置" tabindex="-1">增加控制日誌輸出到控制台的配置 <a class="header-anchor" href="#增加控制日誌輸出到控制台的配置" aria-label="Permalink to “增加控制日誌輸出到控制台的配置”">​</a></h3><p>Version: v1.10.0</p><p>在 <code>config/logging.go</code> 文件的 <code>single</code>、<code>daily</code> 通道中新增 <code>print</code> 配置，可以控制日誌是否輸出到控制台，<a href="https://github.com/goravel/goravel/blob/v1.10.x/config/logging.go" target="_blank" rel="noreferrer">詳見文件</a>；</p><h3 id="request-修改、新增方法" tabindex="-1">Request 修改、新增方法 <a class="header-anchor" href="#request-修改、新增方法" aria-label="Permalink to “Request 修改、新增方法”">​</a></h3><p>Version: v1.10.0</p><ol><li><code>Input</code> 方法由僅獲取路由參數，修改為根據以下順序獲取數據：<code>json</code>、<code>form</code>、<code>query</code>、<code>route</code>。注意：<code>json</code> 只能獲取一維數據，否則將返回空；</li><li>新增 <code>Route</code> 方法替代原有 <code>Input</code> 方法；</li><li><code>Query</code> 和 <code>Form</code> 方法的默認值修改為不必填；</li><li>新增以下方法：</li></ol><table tabindex="0"><thead><tr><th>方法</th><th>操作</th></tr></thead><tbody><tr><td>Route</td><td><a href="./../the-basics/request.html#獲取路由中的參數">獲取路由中的參數</a></td></tr><tr><td>RouteInt</td><td><a href="./../the-basics/request.html#獲取路由中的參數">獲取路由中的參數</a></td></tr><tr><td>RouteInt64</td><td><a href="./../the-basics/request.html#獲取路由中的參數">獲取路由中的參數</a></td></tr><tr><td>QueryInt</td><td><a href="./../the-basics/request.html#從查詢字符串中獲取輸入">從查詢字符串中獲取輸入</a></td></tr><tr><td>QueryInt64</td><td><a href="./../the-basics/request.html#從查詢字符串中獲取輸入">從查詢字符串中獲取輸入</a></td></tr><tr><td>QueryBool</td><td><a href="./../the-basics/request.html#從查詢字符串中獲取輸入">從查詢字符串中獲取輸入</a></td></tr><tr><td>InputInt</td><td><a href="./../the-basics/request.html#Retrieving-An-Input-Value">檢索輸入值</a></td></tr><tr><td>InputInt64</td><td><a href="./../the-basics/request.html#Retrieving-An-Input-Value">檢索輸入值</a></td></tr><tr><td>InputBool</td><td><a href="./../the-basics/request.html#Retrieving-An-Input-Value">檢索輸入值</a></td></tr><tr><td>Json</td><td><a href="./../the-basics/request.html#Retrieving-Json">檢索 Json</a></td></tr></tbody></table><h3 id="隊列支持延遲調度" tabindex="-1">隊列支持延遲調度 <a class="header-anchor" href="#隊列支持延遲調度" aria-label="Permalink to “隊列支持延遲調度”">​</a></h3><p>Version: v1.10.0</p><p>新增 <code>Delay</code> 方法，<a href="./../digging-deeper/queues.html#延遲調度">詳見文檔</a></p><h3 id="orm-連接支持配置表名前綴與單復數" tabindex="-1">ORM 連接支持配置表名前綴與單復數 <a class="header-anchor" href="#orm-連接支持配置表名前綴與單復數" aria-label="Permalink to “ORM 連接支持配置表名前綴與單復數”">​</a></h3><p>Version: v1.10.0</p><ol><li><code>Model</code> 支持指定表名，<a href="./../orm/getting-started.html#指定表名">詳見文檔</a>；</li><li><code>config/database.go</code> 中的 <code>connection</code> 新增鍵值：</li></ol><p><code>prefix</code>：設置表名前綴； <code>singular</code>：設置表名使用單數還是複數；</p><p><a href="https://github.com/goravel/goravel/blob/v1.10.x/config/database.go" target="_blank" rel="noreferrer">詳見文件</a></p><h3 id="新增-docker-compose-yml-文件" tabindex="-1">新增 docker-compose.yml 文件 <a class="header-anchor" href="#新增-docker-compose-yml-文件" aria-label="Permalink to “新增 docker-compose.yml 文件”">​</a></h3><p>Version: v1.10.0</p><p>你現在可以使用以下命令快速啟動服務：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span>docker-compose build</span></span>
<span class="line"><span>docker-compose up</span></span></code></pre></div><h3 id="優化-orm" tabindex="-1">優化 Orm <a class="header-anchor" href="#優化-orm" aria-label="Permalink to “優化 Orm”">​</a></h3><p>Version: v1.10.0</p><ol><li>新增以下方法：</li></ol><table tabindex="0"><thead><tr><th>函數</th><th>操作</th></tr></thead><tbody><tr><td>第一個或</td><td><a href="#Query-one-line">通過回調查詢或返回數據</a></td></tr><tr><td>第一個或新建</td><td><a href="#Retrieving-Or-Creating-Models">檢索或創建模型</a></td></tr><tr><td>第一個或失敗</td><td><a href="#Not-Found-Error">未找到錯誤</a></td></tr><tr><td>UpdateOrCreate</td><td><a href="#Update-or-create">更新或創建</a></td></tr></tbody></table><ol start="2"><li>之前這樣寫報錯，但現在支持：</li></ol><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">query </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> facades.Orm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">query </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> query.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><h3 id="遷移文件中支持執行多條-sql-語句" tabindex="-1">遷移文件中支持執行多條 SQL 語句 <a class="header-anchor" href="#遷移文件中支持執行多條-sql-語句" aria-label="Permalink to “遷移文件中支持執行多條 SQL 語句”">​</a></h3><p>Version: v1.10.0</p><p>之前遷移文件中僅支持執行一條 SQL 語句，現在支持多條。</p><h3 id="文件系統新增-minio-驅動" tabindex="-1">文件系統新增 minio 驅動 <a class="header-anchor" href="#文件系統新增-minio-驅動" aria-label="Permalink to “文件系統新增 minio 驅動”">​</a></h3><p>Version: v1.10.0</p><p>新增 minio 配置，<a href="https://github.com/goravel/goravel/blob/v1.10.x/config/filesystems.go" target="_blank" rel="noreferrer">詳見文件</a>.</p><h3 id="contracts-http-增加-net-http-的-status-映射" tabindex="-1">contracts/http 增加 net/http 的 Status 映射 <a class="header-anchor" href="#contracts-http-增加-net-http-的-status-映射" aria-label="Permalink to “contracts/http 增加 net/http 的 Status 映射”">​</a></h3><p>Version: v1.10.0</p><p>可以在控制器中直接使用 <code>http.StatusOK</code> 等狀態碼，而不需要再導入 <code>net/http</code>。</p><p><a href="https://github.com/goravel/framework/blob/v1.10.0/contracts/http/status.go" target="_blank" rel="noreferrer">詳見文件</a></p><h3 id="必須填寫-app-key" tabindex="-1">必須填寫 APP_KEY <a class="header-anchor" href="#必須填寫-app-key" aria-label="Permalink to “必須填寫 APP_KEY”">​</a></h3><p>Version: v1.10.0</p><p><code>.env</code> 文件中的 <code>APP_KEY</code> 修改為必填項，可以執行命令來生成 APP_KEY: <code>go run . artisan key:generate</code>。</p><h3 id="在表單請求的各個方法中新增-ctx-參數" tabindex="-1">在表單請求的各個方法中新增 ctx 參數 <a class="header-anchor" href="#在表單請求的各個方法中新增-ctx-參數" aria-label="Permalink to “在表單請求的各個方法中新增 ctx 參數”">​</a></h3><p>Version: v1.10.0</p><p>在表單請求的 <code>Rules</code>, <code>Messages</code>, <code>Attributes</code>, <code>PrepareForValidation</code> 方法中，新增 <code>ctx http.Context</code> 參數，允許你進行更多自定義配置。</p><p><a href="./../the-basics/validation.html#創建表單請求驗證">詳見文檔</a></p><h3 id="facades-auth-parse-新增-payload-返回" tabindex="-1">facades.Auth.Parse 新增 payload 返回 <a class="header-anchor" href="#facades-auth-parse-新增-payload-返回" aria-label="Permalink to “facades.Auth.Parse 新增 payload 返回”">​</a></h3><p>Version: v1.10.0</p><p><code>err := facades.Auth.Parse(ctx, token)</code> 修改為 <code>payload, err := facades.Auth.Parse(ctx, token)</code>，通過 <code>payload</code> 你可以獲得：</p><ol><li><code>Guard</code>: 當前 Guard；</li><li><code>Key</code>: 用戶標識；</li><li><code>ExpireAt</code>: 過期時間；</li><li><code>IssuedAt</code>: 發行時間；</li></ol><p><a href="./../security/authentication.html#解析-token">詳見文檔</a></p><h3 id="orm-的部分方法新增返回值" tabindex="-1">Orm 的部分方法新增返回值 <a class="header-anchor" href="#orm-的部分方法新增返回值" aria-label="Permalink to “Orm 的部分方法新增返回值”">​</a></h3><p>Version: v1.10.0</p><p>以下方法新增 <code>*Result</code> 返回值，以獲取受影響的行數：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> query.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> query.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Exec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Sprintf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DELETE FROM users where id = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, user.ID))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> query.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ForceDelete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> query.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Updates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{Avatar: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;avatar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 獲取受影響行數</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">num </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res.RowsAffected</span></span></code></pre></div>`,83)]))}const g=e(r,[["render",l]]);export{k as __pageData,g as default};
