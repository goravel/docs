import{_ as s,f as i,o as e,an as t}from"./chunks/framework.CFMQV-X7.js";const k=JSON.parse('{"title":"從 v1.7 升級到 v1.8","description":"","frontmatter":{},"headers":[],"relativePath":"zh_TW/upgrade/v1.8.md","filePath":"zh_TW/upgrade/v1.8.md","lastUpdated":1761449547000}'),n={name:"zh_TW/upgrade/v1.8.md"};function l(r,a,h,p,o,d){return e(),i("div",null,a[0]||(a[0]=[t(`<h1 id="從-v1-7-升級到-v1-8" tabindex="-1">從 v1.7 升級到 v1.8 <a class="header-anchor" href="#從-v1-7-升級到-v1-8" aria-label="Permalink to “從 v1.7 升級到 v1.8”">​</a></h1><nav class="table-of-contents"><ul><li><a href="#令人興奮的新功能-🎉">令人興奮的新功能 🎉</a></li><li><a href="#功能增強-🚀">功能增強 🚀</a></li><li><a href="#破壞性變化-🛠">破壞性變化 🛠</a></li><li><a href="#bug-修復-🐛">Bug 修復 🐛</a></li><li><a href="#升級指南">升級指南</a><ul><li><a href="#更新依賴">更新依賴</a></li><li><a href="#orm-新增模型關聯">Orm 新增模型關聯</a></li><li><a href="#request-新增方法">Request 新增方法</a></li><li><a href="#為響應新增方法">為響應新增方法</a></li><li><a href="#優化導入順序">優化導入順序</a></li><li><a href="#優化資料庫遷移">優化資料庫遷移</a></li><li><a href="#mock-validator-改名">mock.Validator 改名</a></li><li><a href="#support-mysql-改名">support.Mysql 改名</a></li><li><a href="#database-newgorminstance-即將被棄用">database.NewGormInstance 即將被棄用</a></li><li><a href="#修復-orm-並發安全問題">修復 Orm 並發安全問題</a></li><li><a href="#修復-mail-模塊無法通過-25-和-465-埠發送郵件的問題">修復 Mail 模塊無法通過 25 和 465 埠發送郵件的問題</a></li><li><a href="#路由支持-https">路由支持 HTTPS</a></li></ul></li></ul></nav><h2 id="令人興奮的新功能-🎉" tabindex="-1">令人興奮的新功能 🎉 <a class="header-anchor" href="#令人興奮的新功能-🎉" aria-label="Permalink to “令人興奮的新功能 🎉”">​</a></h2><ul><li><a href="#add-model-association-for-orm">Orm 新增模型關聯(1.8.0)</a></li></ul><h2 id="功能增強-🚀" tabindex="-1">功能增強 🚀 <a class="header-anchor" href="#功能增強-🚀" aria-label="Permalink to “功能增強 🚀”">​</a></h2><ul><li><a href="#add-methods-for-request">Request 新增方法(1.8.0)</a></li><li><a href="#add-methods-for-response">Response 新增方法(1.8.0)</a></li><li><a href="#optimize-database-migrate">優化資料庫遷移(1.8.0)</a></li><li><a href="#route-supports-https">Route 支持 HTTPS(1.8.3)</a></li></ul><h2 id="破壞性變化-🛠" tabindex="-1">破壞性變化 🛠 <a class="header-anchor" href="#破壞性變化-🛠" aria-label="Permalink to “破壞性變化 🛠”">​</a></h2><ul><li><a href="#optimize-import-order">優化 import 順序(1.8.0)</a></li><li><a href="#mock-validator-change-name">mock.Validator 改名(1.8.0)</a></li><li><a href="#support-mysql-change-name">support.Mysql 改名(1.8.0)</a></li><li><a href="#database-newgorminstance-is-about-to-be-deprecated">即將廢棄 database.NewGormInstance(1.8.0)</a></li></ul><h2 id="bug-修復-🐛" tabindex="-1">Bug 修復 🐛 <a class="header-anchor" href="#bug-修復-🐛" aria-label="Permalink to “Bug 修復 🐛”">​</a></h2><ul><li><a href="#fix-orm-concurrency-safety-issue">修復 Orm 並發安全的問題(1.8.1)</a></li><li><a href="#fix-mail-module-can-t-send-mail-by-25-and-465-ports">修復 Mail 不能使用 25，465 端口發送郵件的問題(1.8.2)</a></li></ul><h2 id="升級指南" tabindex="-1">升級指南 <a class="header-anchor" href="#升級指南" aria-label="Permalink to “升級指南”">​</a></h2><p><strong>預估升級時間：1 分鐘</strong></p><h3 id="更新依賴" tabindex="-1">更新依賴 <a class="header-anchor" href="#更新依賴" aria-label="Permalink to “更新依賴”">​</a></h3><p>在 <code>go.mod</code> 文件中更新依賴：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span>go get -u github.com/goravel/framework@v1.8.3</span></span></code></pre></div><h3 id="orm-新增模型關聯" tabindex="-1">Orm 新增模型關聯 <a class="header-anchor" href="#orm-新增模型關聯" aria-label="Permalink to “Orm 新增模型關聯”">​</a></h3><p>版本：v1.8.0</p><p>Orm 新增方法，以處理模型關聯等操作：</p><table tabindex="0"><thead><tr><th>方法</th><th>操作</th></tr></thead><tbody><tr><td>關聯</td><td><a href="./../orm/relationships.html#querying-associations">關聯操作</a></td></tr><tr><td>DB</td><td><a href="./../orm/getting-started.html#generic-database-interface-sqldb">獲取通用資料庫接口 sql.DB</a></td></tr><tr><td>負載</td><td><a href="./../orm/relationships.html#lazy-eager-loading">延遲預加載</a></td></tr><tr><td>LoadMissing</td><td><a href="./../orm/relationships.html#lazy-eager-loading">延遲預加載(不存在)</a></td></tr><tr><td>Omit</td><td><a href="./../orm/relationships.html#create-or-update-associations">忽略關聯</a></td></tr><tr><td>With</td><td><a href="./../orm/relationships.html#eager-loading">預加載</a></td></tr></tbody></table><h3 id="request-新增方法" tabindex="-1">Request 新增方法 <a class="header-anchor" href="#request-新增方法" aria-label="Permalink to “Request 新增方法”">​</a></h3><p>版本：v1.8.0</p><p><code>ctx.Request()</code> 新增方法，以豐富 <code>Query</code> 參數的格式：</p><table tabindex="0"><thead><tr><th>方法</th><th>操作</th></tr></thead><tbody><tr><td><code>QueryArray</code></td><td><a href="./../the-basics/request.html#retrieving-input-from-the-query-string">獲取鏈接傳入的數組參數</a></td></tr><tr><td><code>QueryMap</code></td><td><a href="./../the-basics/request.html#Retrieving-Input-From-The-Query-String">獲取地圖參數</a></td></tr></tbody></table><h3 id="為響應新增方法" tabindex="-1">為響應新增方法 <a class="header-anchor" href="#為響應新增方法" aria-label="Permalink to “為響應新增方法”">​</a></h3><p>版本：v1.8.0</p><p>向 <code>ctx.Response()</code> 新增 <code>Origin</code> 方法，你可以在 HTTP 中介軟件中獲取 <code>Response</code> 的所有信息。</p><p><a href="./../the-basics/response.html#Get-Response">詳情</a></p><h3 id="優化導入順序" tabindex="-1">優化導入順序 <a class="header-anchor" href="#優化導入順序" aria-label="Permalink to “優化導入順序”">​</a></h3><p>版本：v1.8.0</p><p><code>bootstrap/app.go</code> 文件中的導入順序變更為：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bootstrap</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/goravel/framework/foundation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">goravel/config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><a href="https://github.com/goravel/goravel/blob/v1.8.0/bootstrap/app.go" target="_blank" rel="noreferrer">文件鏈接</a></p><h3 id="優化資料庫遷移" tabindex="-1">優化資料庫遷移 <a class="header-anchor" href="#優化資料庫遷移" aria-label="Permalink to “優化資料庫遷移”">​</a></h3><p>版本：v1.8.0</p><p>運行生成遷移文件的命令：<code>go run . artisan make:migration create_users_table</code>，將根據當前使用的預設資料庫驅動(<code>facades.Config.GetString(&quot;database.default&quot;)</code>)生成對應的遷移文件。</p><h3 id="mock-validator-改名" tabindex="-1">mock.Validator 改名 <a class="header-anchor" href="#mock-validator-改名" aria-label="Permalink to “mock.Validator 改名”">​</a></h3><p>版本：v1.8.0</p><p>如果你使用 <code>mock.Validator</code> 來編寫單元測試，需要進行以下修改：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span>import &quot;github.com/goravel/framework/testing/mock&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>mock.Validator</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// 修改為</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import &quot;github.com/goravel/framework/testing/mock&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>mock.Validation</span></span></code></pre></div><p><a href="./../testing/mock.html#Mock-facades.Validation">詳情</a></p><h3 id="support-mysql-改名" tabindex="-1">support.Mysql 改名 <a class="header-anchor" href="#support-mysql-改名" aria-label="Permalink to “support.Mysql 改名”">​</a></h3><p>版本：v1.8.0</p><p>如果你使用 <code>support.Mysql</code> 等框架常量來判斷資料庫驅動，需要進行以下修改：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/goravel/framework/database/support</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">support.Mysql</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">support.Postgresql</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">support.Sqlite</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">support.Sqlserver</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 修改為</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/goravel/framework/contracts/database/orm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">orm.Mysql</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">orm.Postgresql</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">orm.Sqlite</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">orm.Sqlserver</span></span></code></pre></div><p>新的常量如 <code>orm.Mysql</code> 是 <code>orm.Driver</code> 類型，並可以使用 <code>orm.Mysql.String()</code> 方法將其轉換為字符串類型。</p><h3 id="database-newgorminstance-即將被棄用" tabindex="-1">database.NewGormInstance 即將被棄用 <a class="header-anchor" href="#database-newgorminstance-即將被棄用" aria-label="Permalink to “database.NewGormInstance 即將被棄用”">​</a></h3><p>版本：v1.8.0</p><p><code>database.NewGormInstance</code> 方法將在 v1.9.0 版本中被棄用，目前版本仍可使用，如果你使用該方法來獲取 <code>gorm</code> 實例，請進行以下修改：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/goravel/framework/database</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gorm, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> database.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewGormInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(connection)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 修改為</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/goravel/framework/database/gorm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gorm, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gorm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">New</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(connection)</span></span></code></pre></div><h3 id="修復-orm-並發安全問題" tabindex="-1">修復 Orm 並發安全問題 <a class="header-anchor" href="#修復-orm-並發安全問題" aria-label="Permalink to “修復 Orm 並發安全問題”">​</a></h3><p>版本：v1.8.1</p><p>在高併發訪問的情況下，第一次讀取 <code>facades.Orm</code> 可能會返回 nil。</p><h3 id="修復-mail-模塊無法通過-25-和-465-埠發送郵件的問題" tabindex="-1">修復 Mail 模塊無法通過 25 和 465 埠發送郵件的問題 <a class="header-anchor" href="#修復-mail-模塊無法通過-25-和-465-埠發送郵件的問題" aria-label="Permalink to “修復 Mail 模塊無法通過 25 和 465 埠發送郵件的問題”">​</a></h3><p>版本：v1.8.2</p><p>現在你可以通過 25、465、587 埠發送郵件。</p><h3 id="路由支持-https" tabindex="-1">路由支持 HTTPS <a class="header-anchor" href="#路由支持-https" aria-label="Permalink to “路由支持 HTTPS”">​</a></h3><p>版本：v1.8.3</p><p><code>facades.Route</code> 新增 <code>RunTLS</code> 方法，支持啟動 HTTPS 伺服器，<a href="./../the-basics/routing.html#start-https-server">詳情</a>。</p>`,58)]))}const g=s(n,[["render",l]]);export{k as __pageData,g as default};
