import{_ as s,f as i,o as e,an as t}from"./chunks/framework.CFMQV-X7.js";const k=JSON.parse('{"title":"从 v1.7 升级到 v1.8","description":"","frontmatter":{},"headers":[],"relativePath":"zh_CN/upgrade/v1.8.md","filePath":"zh_CN/upgrade/v1.8.md","lastUpdated":1761449547000}'),n={name:"zh_CN/upgrade/v1.8.md"};function l(r,a,h,p,o,d){return e(),i("div",null,a[0]||(a[0]=[t(`<h1 id="从-v1-7-升级到-v1-8" tabindex="-1">从 v1.7 升级到 v1.8 <a class="header-anchor" href="#从-v1-7-升级到-v1-8" aria-label="Permalink to “从 v1.7 升级到 v1.8”">​</a></h1><nav class="table-of-contents"><ul><li><a href="#令人兴奋的新功能-🎉">令人兴奋的新功能 🎉</a></li><li><a href="#功能增强-🚀">功能增强 🚀</a></li><li><a href="#破坏性变化-🛠">破坏性变化 🛠</a></li><li><a href="#bug-修复-🐛">Bug 修复 🐛</a></li><li><a href="#升级指南">升级指南</a><ul><li><a href="#更新依赖">更新依赖</a></li><li><a href="#orm-新增模型关联">Orm 新增模型关联</a></li><li><a href="#request-新增方法">Request 新增方法</a></li><li><a href="#response-新增方法">Response 新增方法</a></li><li><a href="#优化-import-顺序">优化 import 顺序</a></li><li><a href="#优化数据库迁移">优化数据库迁移</a></li><li><a href="#mock-validator-改名">mock.Validator 改名</a></li><li><a href="#support-mysql-改名">support.Mysql 改名</a></li><li><a href="#即将废弃-database-newgorminstance">即将废弃 database.NewGormInstance</a></li><li><a href="#修复-orm-并发安全的问题">修复 Orm 并发安全的问题</a></li><li><a href="#修复-mail-不能使用-25-465-端口发送邮件的问题">修复 Mail 不能使用 25，465 端口发送邮件的问题</a></li><li><a href="#route-支持-https">Route 支持 HTTPS</a></li></ul></li></ul></nav><h2 id="令人兴奋的新功能-🎉" tabindex="-1">令人兴奋的新功能 🎉 <a class="header-anchor" href="#令人兴奋的新功能-🎉" aria-label="Permalink to “令人兴奋的新功能 🎉”">​</a></h2><ul><li><a href="#orm-新增模型关联">Orm 新增模型关联(1.8.0)</a></li></ul><h2 id="功能增强-🚀" tabindex="-1">功能增强 🚀 <a class="header-anchor" href="#功能增强-🚀" aria-label="Permalink to “功能增强 🚀”">​</a></h2><ul><li><a href="#request-新增方法">Request 新增方法(1.8.0)</a></li><li><a href="#response-新增方法">Response 新增方法(1.8.0)</a></li><li><a href="#优化数据库迁移">优化数据库迁移(1.8.0)</a></li><li><a href="#route-支持-https">Route 支持 HTTPS(1.8.3)</a></li></ul><h2 id="破坏性变化-🛠" tabindex="-1">破坏性变化 🛠 <a class="header-anchor" href="#破坏性变化-🛠" aria-label="Permalink to “破坏性变化 🛠”">​</a></h2><ul><li><a href="#优化-import-顺序">优化 import 顺序(1.8.0)</a></li><li><a href="#mock-validator-改名">mock.Validator 改名(1.8.0)</a></li><li><a href="#support-mysql-改名">support.Mysql 改名(1.8.0)</a></li><li><a href="#即将废弃-database-newgorminstance">即将废弃 database.NewGormInstance(1.8.0)</a></li></ul><h2 id="bug-修复-🐛" tabindex="-1">Bug 修复 🐛 <a class="header-anchor" href="#bug-修复-🐛" aria-label="Permalink to “Bug 修复 🐛”">​</a></h2><ul><li><a href="#修复-orm-并发安全的问题">修复 Orm 并发安全的问题(1.8.1)</a></li><li><a href="#修复-mail-不能使用-25-465-端口发送邮件的问题">修复 Mail 不能使用 25，465 端口发送邮件的问题(1.8.2)</a></li></ul><h2 id="升级指南" tabindex="-1">升级指南 <a class="header-anchor" href="#升级指南" aria-label="Permalink to “升级指南”">​</a></h2><p><strong>预计升级时间：1 分钟</strong></p><h3 id="更新依赖" tabindex="-1">更新依赖 <a class="header-anchor" href="#更新依赖" aria-label="Permalink to “更新依赖”">​</a></h3><p><code>go.mod</code> 中更新依赖：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span>go get -u github.com/goravel/framework@v1.8.3</span></span></code></pre></div><h3 id="orm-新增模型关联" tabindex="-1">Orm 新增模型关联 <a class="header-anchor" href="#orm-新增模型关联" aria-label="Permalink to “Orm 新增模型关联”">​</a></h3><p>Version: v1.8.0</p><p>Orm 新增方法，以处理模型关联等操作：</p><table tabindex="0"><thead><tr><th>方法名</th><th>作用</th></tr></thead><tbody><tr><td>Association</td><td><a href="./../orm/relationships.html#querying-associations">关联操作</a></td></tr><tr><td>DB</td><td><a href="./../orm/getting-started.html#generic-database-interface-sqldb">获取通用数据库接口</a></td></tr><tr><td>Load</td><td><a href="./../orm/relationships.html#lazy-eager-loading">延迟预加载</a></td></tr><tr><td>LoadMissing</td><td><a href="./../orm/relationships.html#lazy-eager-loading">延迟预加载(不存在)</a></td></tr><tr><td>Omit</td><td><a href="./../orm/relationships.html#create-or-update-associations">忽略关联</a></td></tr><tr><td>With</td><td><a href="./../orm/relationships.html#Eager-Loading">预加载</a></td></tr></tbody></table><h3 id="request-新增方法" tabindex="-1">Request 新增方法 <a class="header-anchor" href="#request-新增方法" aria-label="Permalink to “Request 新增方法”">​</a></h3><p>Version: v1.8.0</p><p><code>ctx.Request()</code> 新增方法，以丰富 <code>Query</code> 传参的格式：</p><table tabindex="0"><thead><tr><th>方法名</th><th>作用</th></tr></thead><tbody><tr><td><code>QueryArray</code></td><td><a href="./../the-basics/request.html#获取链接传入的参数">获取链接传入的数组参数</a></td></tr><tr><td><code>QueryMap</code></td><td><a href="./../the-basics/request.html#获取链接传入的参数">获取链接传入的 Map 参数</a></td></tr></tbody></table><h3 id="response-新增方法" tabindex="-1">Response 新增方法 <a class="header-anchor" href="#response-新增方法" aria-label="Permalink to “Response 新增方法”">​</a></h3><p>Version: v1.8.0</p><p><code>ctx.Response()</code> 新增 <code>Origin</code> 方法，可以在 HTTP 中间件中获取 <code>Response</code> 的所有信息。</p><p><a href="./../the-basics/response.html#获取响应">查看文档</a></p><h3 id="优化-import-顺序" tabindex="-1">优化 import 顺序 <a class="header-anchor" href="#优化-import-顺序" aria-label="Permalink to “优化 import 顺序”">​</a></h3><p>Version: v1.8.0</p><p><code>bootstrap/app.go</code> 文件中 import 顺序修改为：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bootstrap</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/goravel/framework/foundation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">goravel/config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><a href="https://github.com/goravel/goravel/blob/v1.8.0/bootstrap/app.go" target="_blank" rel="noreferrer">查看文件</a></p><h3 id="优化数据库迁移" tabindex="-1">优化数据库迁移 <a class="header-anchor" href="#优化数据库迁移" aria-label="Permalink to “优化数据库迁移”">​</a></h3><p>Version: v1.8.0</p><p>运行生成数据库迁移文件命令 <code>go run . artisan make:migration create_users_table</code>，将根据当前使用的默认数据库驱动 <code>facades.Config.GetString(&quot;database.default&quot;)</code> 生成对应的迁移文件。</p><h3 id="mock-validator-改名" tabindex="-1">mock.Validator 改名 <a class="header-anchor" href="#mock-validator-改名" aria-label="Permalink to “mock.Validator 改名”">​</a></h3><p>Version: v1.8.0</p><p>如果你使用了 <code>mock.Validator</code> 来编写单元测试，需要进行下面修改：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span>import &quot;github.com/goravel/framework/testing/mock&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>mock.Validator</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// 修改为</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import &quot;github.com/goravel/framework/testing/mock&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>mock.Validation</span></span></code></pre></div><p><a href="./../testing/mock.html#Mock-facades.Validation">查看文档</a></p><h3 id="support-mysql-改名" tabindex="-1">support.Mysql 改名 <a class="header-anchor" href="#support-mysql-改名" aria-label="Permalink to “support.Mysql 改名”">​</a></h3><p>Version: v1.8.0</p><p>如果你使用了 <code>support.Mysql</code> 等框架常量来进行数据库驱动的判断，需要进行如下修改：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/goravel/framework/database/support</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">support.Mysql</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">support.Postgresql</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">support.Sqlite</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">support.Sqlserver</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 修改为</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/goravel/framework/contracts/database/orm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">orm.Mysql</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">orm.Postgresql</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">orm.Sqlite</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">orm.Sqlserver</span></span></code></pre></div><p><code>orm.Mysql</code> 等新的常量为 <code>orm.Driver</code> 类型，可以使用 <code>orm.Mysql.String()</code> 方法转换为字符类型。</p><h3 id="即将废弃-database-newgorminstance" tabindex="-1">即将废弃 database.NewGormInstance <a class="header-anchor" href="#即将废弃-database-newgorminstance" aria-label="Permalink to “即将废弃 database.NewGormInstance”">​</a></h3><p>Version: v1.8.0</p><p><code>database.NewGormInstance</code> 方法将在 v1.9.0 被废弃，当前版本尚可使用，如果你使用了该方法获取 <code>gorm</code> 实例，需要进行如下修改：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/goravel/framework/database</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gorm, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> database.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewGormInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(connection)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 修改为</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/goravel/framework/database/gorm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gorm, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gorm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">New</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(connection)</span></span></code></pre></div><h3 id="修复-orm-并发安全的问题" tabindex="-1">修复 Orm 并发安全的问题 <a class="header-anchor" href="#修复-orm-并发安全的问题" aria-label="Permalink to “修复 Orm 并发安全的问题”">​</a></h3><p>Version: v1.8.1</p><p>修复当高并发访问时，第一次读取 <code>facades.Orm</code> 有可能返回 Nil。</p><h3 id="修复-mail-不能使用-25-465-端口发送邮件的问题" tabindex="-1">修复 Mail 不能使用 25，465 端口发送邮件的问题 <a class="header-anchor" href="#修复-mail-不能使用-25-465-端口发送邮件的问题" aria-label="Permalink to “修复 Mail 不能使用 25，465 端口发送邮件的问题”">​</a></h3><p>Version: v1.8.2</p><p>现在可以使用 25，465，587 发送邮件了。</p><h3 id="route-支持-https" tabindex="-1">Route 支持 HTTPS <a class="header-anchor" href="#route-支持-https" aria-label="Permalink to “Route 支持 HTTPS”">​</a></h3><p>Version: v1.8.3</p><p><code>facades.Route</code> 新增 <code>RunTLS</code> 方法，支持启动 HTTPS 服务器，详见<a href="./../the-basics/routing.html#启动-https-服务器">文档</a>。</p>`,58)]))}const g=s(n,[["render",l]]);export{k as __pageData,g as default};
